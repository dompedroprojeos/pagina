
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Solicitações CFOP - Rede Dom Pedro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #1a237e;
            --secondary-color: #0d47a1;
            --accent-color: #2196f3;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --danger-color: #f44336;
            --info-color: #00bcd4;
            --light-bg: #f8fafc;
            --card-bg: #ffffff;
            --text-primary: #1a237e;
            --text-secondary: #546e7a;
            --text-light: #78909c;
            --border-color: #e3f2fd;
            --shadow-sm: 0 2px 4px rgba(26, 35, 126, 0.1);
            --shadow-md: 0 4px 8px rgba(26, 35, 126, 0.15);
            --shadow-lg: 0 8px 16px rgba(26, 35, 126, 0.2);
            --shadow-xl: 0 12px 24px rgba(26, 35, 126, 0.25);
            --gradient-primary: linear-gradient(135deg, #1a237e 0%, #0d47a1 100%);
            --gradient-secondary: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
            --gradient-success: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
            --gradient-warning: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            --gradient-danger: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            width: 100%;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 95vh;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .header {
            background: var(--gradient-primary);
            color: white;
            padding: 24px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            animation: moveBackground 20s linear infinite;
        }
        
        @keyframes moveBackground {
            0% { transform: translate(0, 0); }
            100% { transform: translate(20px, 20px); }
        }
        
        .header-content {
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
            z-index: 1;
        }
        
        .logo-container {
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .logo-container i {
            font-size: 32px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .header h1 {
            font-size: 28px;
            font-weight: 800;
            letter-spacing: -0.02em;
            background: linear-gradient(135deg, #fff 0%, #e3f2fd 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
            overflow: hidden;
        }
        
        /* Efeito de animação no título */
        .header h1::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .time-display {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 16px;
            border-radius: 50px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 14px;
            font-weight: 500;
        }
        
        .nav-tabs {
            display: flex;
            gap: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50px;
            padding: 4px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            z-index: 1;
        }
        
        .nav-tab {
            padding: 12px 24px;
            border: none;
            background: transparent;
            color: rgba(255, 255, 255, 0.9);
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }
        
        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            transform: translateY(-1px);
        }
        
        .nav-tab.active {
            background: white;
            color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .main-content {
            flex: 1;
            overflow: hidden;
            display: flex;
            background: var(--light-bg);
        }
        
        .tab-content {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content.active {
            display: block;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        
        .stat-card {
            background: white;
            padding: 24px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 20px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--accent-color);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--accent-color);
            animation: pulse 0.5s ease;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .stat-card.solucionado::before { background: var(--success-color); }
        .stat-card.enviado::before { background: var(--info-color); }
        .stat-card.aberto::before { background: var(--warning-color); }
        .stat-card.hoje::before { background: var(--primary-color); }
        
        .stat-icon {
            width: 56px;
            height: 56px;
            border-radius: 12px;
            background: var(--gradient-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }
        
        .stat-icon.solucionado { background: var(--gradient-success); }
        .stat-icon.enviado { background: var(--gradient-secondary); }
        .stat-icon.aberto { background: var(--gradient-warning); }
        .stat-icon.hoje { background: var(--gradient-primary); }
        
        .stat-info h4 {
            font-size: 12px;
            color: var(--text-light);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 6px;
        }
        
        .stat-info p {
            font-size: 28px;
            font-weight: 800;
            color: var(--text-primary);
            line-height: 1;
        }
        
        .form-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 32px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            margin-bottom: 32px;
            position: relative;
            overflow: hidden;
        }
        
        .form-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, transparent 50%, rgba(33, 150, 243, 0.05) 50%);
            border-radius: 0 0 0 100px;
        }
        
        .form-group {
            margin-bottom: 24px;
            position: relative;
        }
        
        .form-group label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 10px;
            font-size: 15px;
        }
        
        .form-group label i {
            color: var(--accent-color);
            width: 20px;
            font-size: 18px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 15px;
            transition: all 0.3s;
            background-color: white;
            color: var(--text-primary);
            font-weight: 500;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
            font-family: 'Inter', sans-serif;
            line-height: 1.5;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: var(--accent-color);
            outline: none;
            box-shadow: 0 0 0 4px rgba(33, 150, 243, 0.1);
        }
        
        .search-container {
            position: relative;
        }
        
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid var(--border-color);
            border-top: none;
            border-radius: 0 0 var(--radius-md) var(--radius-md);
            max-height: 300px;
            overflow-y: auto;
            z-index: 100;
            display: none;
            box-shadow: var(--shadow-lg);
        }
        
        .search-result-item {
            padding: 14px 18px;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
            transition: all 0.2s;
            font-weight: 500;
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .search-result-item:hover {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding-left: 22px;
        }
        
        .search-result-item strong {
            font-size: 15px;
            color: var(--text-primary);
        }
        
        .search-result-item small {
            font-size: 13px;
            color: var(--text-light);
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }
        
        @media (max-width: 768px) {
            .comparison-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .system-card {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 24px;
            transition: all 0.3s;
            position: relative;
        }
        
        .system-card:hover {
            border-color: var(--accent-color);
            box-shadow: var(--shadow-sm);
        }
        
        .system-card h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 17px;
            font-weight: 700;
        }
        
        .system-card h3 i {
            width: 32px;
            height: 32px;
            background: var(--gradient-primary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
        }
        
        .system-card.prodac h3 i { background: var(--gradient-secondary); }
        .system-card.autosystem h3 i { background: var(--gradient-success); }
        
        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 8px;
        }
        
        .radio-item {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: var(--radius-sm);
            transition: all 0.2s;
        }
        
        .radio-item:hover {
            background: var(--border-color);
        }
        
        .radio-item input[type="radio"] {
            width: 18px;
            height: 18px;
            accent-color: var(--accent-color);
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            background: var(--gradient-secondary);
            color: white;
            border: none;
            padding: 16px 28px;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 15px;
            font-weight: 700;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(33, 150, 243, 0.4);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #78909c, #546e7a);
            box-shadow: 0 4px 12px rgba(120, 144, 156, 0.3);
        }
        
        .btn-success {
            background: var(--gradient-success);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }
        
        .btn-warning {
            background: var(--gradient-warning);
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);
        }
        
        .btn-danger {
            background: var(--gradient-danger);
            box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);
        }
        
        .btn-info {
            background: linear-gradient(135deg, #00bcd4, #0097a7);
            box-shadow: 0 4px 12px rgba(0, 188, 212, 0.3);
        }
        
        .btn-group {
            display: flex;
            gap: 16px;
            margin-top: 24px;
            flex-wrap: wrap;
        }
        
        .btn-group .btn {
            flex: 1;
            min-width: 200px;
        }
        
        @media (max-width: 768px) {
            .btn-group {
                flex-direction: column;
            }
            
            .btn-group .btn {
                min-width: 100%;
            }
        }
        
        .table-container {
            overflow-x: auto;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            margin-bottom: 24px;
            background: white;
            box-shadow: var(--shadow-sm);
        }
        
        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            min-width: 1200px;
        }
        
        .data-table th {
            background: var(--gradient-primary);
            color: white;
            padding: 18px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            position: sticky;
            top: 0;
        }
        
        .data-table th:first-child {
            border-radius: var(--radius-md) 0 0 0;
        }
        
        .data-table th:last-child {
            border-radius: 0 var(--radius-md) 0 0;
        }
        
        .data-table td {
            padding: 16px 18px;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
            font-size: 14px;
        }
        
        .data-table tr:hover {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        }
        
        .data-table tr:last-child td {
            border-bottom: none;
        }
        
        .status-badge {
            padding: 8px 16px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            min-width: 100px;
            justify-content: center;
        }
        
        .status-badge i {
            font-size: 10px;
        }
        
        .status-rascunho {
            background: linear-gradient(135deg, #eceff1, #cfd8dc);
            color: #455a64;
            border-left: 4px solid #78909c;
        }
        
        .status-aberto {
            background: linear-gradient(135deg, #fff3e0, #ffe0b2);
            color: #e65100;
            border-left: 4px solid #ff9800;
        }
        
        .status-enviado {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            color: #0d47a1;
            border-left: 4px solid #2196f3;
        }
        
        .status-solucionado {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            color: #1b5e20;
            border-left: 4px solid #4caf50;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: white;
            color: var(--text-secondary);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--border-color);
        }
        
        .action-btn:hover {
            background: var(--accent-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(33, 150, 243, 0.2);
            border-color: var(--accent-color);
        }
        
        .action-btn.danger:hover {
            background: var(--danger-color);
            box-shadow: 0 4px 8px rgba(244, 67, 54, 0.2);
            border-color: var(--danger-color);
        }
        
        .action-btn.success:hover {
            background: var(--success-color);
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.2);
            border-color: var(--success-color);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(26, 35, 126, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: var(--radius-lg);
            padding: 40px;
            max-width: 900px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            position: relative;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .modal-close {
            width: 40px;
            height: 40px;
            background: var(--light-bg);
            border: none;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-close:hover {
            background: var(--danger-color);
            color: white;
            transform: rotate(90deg);
        }
        
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 32px;
            margin-bottom: 32px;
        }
        
        @media (max-width: 768px) {
            .charts-container {
                grid-template-columns: 1fr;
            }
        }
        
        .chart-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 32px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            transition: all 0.3s;
        }
        
        .chart-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .chart-card h3 {
            color: var(--primary-color);
            margin-bottom: 24px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
        }
        
        .chart-card h3 i {
            width: 40px;
            height: 40px;
            background: var(--gradient-primary);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }
        
        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 32px;
        }
        
        .config-section {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 28px;
            transition: all 0.3s;
        }
        
        .config-section:hover {
            border-color: var(--accent-color);
            box-shadow: var(--shadow-sm);
        }
        
        .config-section h4 {
            color: var(--primary-color);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 17px;
            font-weight: 700;
        }
        
        .config-item {
            margin-bottom: 20px;
        }
        
        .config-item label {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
            color: var(--text-primary);
            display: block;
        }
        
        .full-width {
            width: 100%;
        }
        
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        
        .loading.show {
            display: flex;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--accent-color);
            border-right: 4px solid var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            box-shadow: 0 0 10px rgba(33, 150, 243, 0.5);
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: var(--radius-md);
            background: white;
            box-shadow: var(--shadow-lg);
            border-left: 4px solid var(--accent-color);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateX(120%);
            transition: transform 0.3s;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success { border-left-color: var(--success-color); }
        .notification.error { border-left-color: var(--danger-color); }
        .notification.warning { border-left-color: var(--warning-color); }
        .notification.info { border-left-color: var(--info-color); }
        
        @media (max-width: 768px) {
            .container {
                height: auto;
                min-height: 95vh;
                margin: 10px;
            }
            
            .header {
                flex-direction: column;
                gap: 20px;
                padding: 20px;
            }
            
            .nav-tabs {
                width: 100%;
                overflow-x: auto;
                padding: 2px;
            }
            
            .nav-tab {
                padding: 10px 16px;
                font-size: 13px;
            }
            
            .tab-content {
                padding: 20px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
                gap: 12px;
            }
            
            .stat-card {
                padding: 16px;
            }
            
            .stat-icon {
                width: 44px;
                height: 44px;
                font-size: 22px;
            }
            
            .form-card {
                padding: 20px;
            }
            
            .modal-content {
                padding: 20px;
                width: 95%;
            }
            
            .config-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-wrap: wrap;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Spinner -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <!-- Notificação -->
    <div class="notification" id="notification"></div>

    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="logo-container">
                    <i class="fas fa-exchange-alt"></i>
                </div>
                <div>
                    <h1>Gestão de Solicitações CFOP</h1>
                    <div class="time-display" id="timeDisplay"></div>
                </div>
            </div>
            
            <div class="nav-tabs">
                <button class="nav-tab active" data-tab="nova">
                    <i class="fas fa-plus-circle"></i> Nova Solicitação
                </button>
                <button class="nav-tab" data-tab="historico">
                    <i class="fas fa-history"></i> Histórico
                </button>
                <button class="nav-tab" data-tab="relatorios">
                    <i class="fas fa-chart-bar"></i> Relatórios
                </button>
                <button class="nav-tab" data-tab="postos">
                    <i class="fas fa-store"></i> Controle de Postos
                </button>
                <button class="nav-tab" data-tab="config">
                    <i class="fas fa-cogs"></i> Configurações
                </button>
            </div>
        </div>
        
        <div class="main-content">
            <!-- TAB: NOVA SOLICITAÇÃO -->
            <div class="tab-content active" id="tab-nova">
                <div class="stats-grid">
                    <div class="stat-card hoje">
                        <div class="stat-icon hoje">
                            <i class="fas fa-calendar-day"></i>
                        </div>
                        <div class="stat-info">
                            <h4>Solicitações Hoje</h4>
                            <p id="statsHoje">0</p>
                        </div>
                    </div>
                    <div class="stat-card aberto">
                        <div class="stat-icon aberto">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h4>Em Aberto</h4>
                            <p id="statsAberto">0</p>
                        </div>
                    </div>
                    <div class="stat-card enviado">
                        <div class="stat-icon enviado">
                            <i class="fas fa-paper-plane"></i>
                        </div>
                        <div class="stat-info">
                            <h4>Enviados</h4>
                            <p id="statsEnviado">0</p>
                        </div>
                    </div>
                    <div class="stat-card solucionado">
                        <div class="stat-icon solucionado">
                            <i class="fas fa-check-double"></i>
                        </div>
                        <div class="stat-info">
                            <h4>Solucionados</h4>
                            <p id="statsSolucionado">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="form-card">
                    <form id="solicitacaoForm">
                        <div class="form-group">
                            <label for="postoSearch"><i class="fas fa-store"></i> Selecione o Posto:</label>
                            <div class="search-container">
                                <input type="text" id="postoSearch" placeholder="Digite nome, cidade ou CNPJ do posto..." autocomplete="off" required>
                                <div class="search-results" id="searchResults"></div>
                            </div>
                            <input type="hidden" id="postoId">
                        </div>
                        
                        <div class="form-group">
                            <label for="mesReferencia"><i class="fas fa-calendar-alt"></i> Mês/Ano de Referência:</label>
                            <input type="month" id="mesReferencia" required>
                        </div>
                        
                        <div class="comparison-grid">
                            <div class="system-card prodac">
                                <h3><i class="fas fa-database"></i> Sistema Prodac</h3>
                                <div class="form-group">
                                    <label>CFOP Prodac:</label>
                                    <input type="text" id="cfopProdac" placeholder="Ex: 1407">
                                </div>
                                <div class="form-group">
                                    <label>Valor Prodac:</label>
                                    <input type="text" id="valorProdac" placeholder="R$ 0,00">
                                </div>
                            </div>
                            
                            <div class="system-card autosystem">
                                <h3><i class="fas fa-cogs"></i> Sistema AutoSystem</h3>
                                <div class="form-group">
                                    <label>CFOP AutoSystem:</label>
                                    <input type="text" id="cfopAutoSystem" placeholder="Ex: 5102">
                                </div>
                                <div class="form-group">
                                    <label>Valor AutoSystem:</label>
                                    <input type="text" id="valorAutoSystem" placeholder="R$ 0,00">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="dadosComparacao"><i class="fas fa-file-excel"></i> Dados da Comparação:</label>
                            <textarea id="dadosComparacao" placeholder="Cole aqui os dados da comparação (Ctrl+V)..."></textarea>
                            <small style="color: var(--text-light); margin-top: 5px; display: block;">
                                <i class="fas fa-info-circle"></i> Formato esperado: Nota | Data | Série | CFOP | Terceiro | UF | Valor Prodac | Valor AutoSystem
                            </small>
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-exclamation-triangle"></i> Origem do Problema:</label>
                            <div class="radio-group">
                                <label class="radio-item">
                                    <input type="radio" name="origemProblema" value="prodac" required>
                                    <span>Erro no Prodac</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="origemProblema" value="autosystem">
                                    <span>Erro no AutoSystem</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="descricao"><i class="fas fa-search"></i> Descrição Detalhada:</label>
                            <textarea id="descricao" placeholder="Descreva detalhadamente a divergência encontrada..." required></textarea>
                        </div>
                        
                        <div class="btn-group">
                            <button type="button" id="salvarRascunho" class="btn btn-secondary">
                                <i class="fas fa-save"></i> Salvar Solicitação
                            </button>
                            <button type="button" id="enviarEmail" class="btn btn-success">
                                <i class="fas fa-paper-plane"></i> Enviar Email
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- TAB: HISTÓRICO -->
            <div class="tab-content" id="tab-historico">
                <div class="form-card">
                    <div class="btn-group" style="margin-bottom: 20px;">
                        <button id="btnFiltrar" class="btn btn-secondary">
                            <i class="fas fa-filter"></i> Filtrar Histórico
                        </button>
                        <button id="btnExportar" class="btn btn-secondary">
                            <i class="fas fa-file-export"></i> Exportar CSV
                        </button>
                        <button id="btnBackup" class="btn btn-info">
                            <i class="fas fa-database"></i> Backup Completo
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table" id="tabelaHistorico">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Data Criação</th>
                                    <th>Posto</th>
                                    <th>Mês/Ano</th>
                                    <th>Origem Problema</th>
                                    <th>Status</th>
                                    <th>Destinatário</th>
                                    <th>Data Envio</th>
                                    <th>Data Solução</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="tabelaCorpoHistorico">
                                <!-- Dados serão carregados aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- TAB: RELATÓRIOS -->
            <div class="tab-content" id="tab-relatorios">
                <div class="form-card">
                    <h3 style="margin-bottom: 20px; color: var(--primary-color); display: flex; align-items: center; gap: 12px;">
                        <i class="fas fa-chart-line"></i> Relatórios e Estatísticas
                    </h3>
                    
                    <div class="charts-container">
                        <div class="chart-card">
                            <h3><i class="fas fa-chart-pie"></i> Status das Solicitações</h3>
                            <canvas id="chartStatus"></canvas>
                        </div>
                        
                        <div class="chart-card">
                            <h3><i class="fas fa-chart-bar"></i> Emails por Mês</h3>
                            <canvas id="chartEmails"></canvas>
                        </div>
                    </div>
                    
                    <div class="charts-container">
                        <div class="chart-card">
                            <h3><i class="fas fa-chart-line"></i> Evolução Mensal</h3>
                            <canvas id="chartEvolucao"></canvas>
                        </div>
                        
                        <div class="chart-card">
                            <h3><i class="fas fa-exclamation-triangle"></i> Problemas por Origem</h3>
                            <canvas id="chartProblemas"></canvas>
                        </div>
                    </div>
                    
                    <div class="comparison-grid" style="margin-top: 30px;">
                        <div class="system-card">
                            <h3><i class="fas fa-sliders-h"></i> Filtros do Relatório</h3>
                            <div class="form-group">
                                <label>Período:</label>
                                <select id="relatorioPeriodo">
                                    <option value="30">Últimos 30 dias</option>
                                    <option value="90" selected>Últimos 90 dias</option>
                                    <option value="180">Últimos 6 meses</option>
                                    <option value="365">Último ano</option>
                                    <option value="custom">Personalizado</option>
                                </select>
                            </div>
                            <div class="form-group" id="periodoCustom" style="display: none;">
                                <label>Data Inicial:</label>
                                <input type="date" id="dataInicial">
                                <label style="margin-top: 10px;">Data Final:</label>
                                <input type="date" id="dataFinal">
                            </div>
                            <div class="form-group">
                                <label>Status:</label>
                                <select id="relatorioStatus">
                                    <option value="todos">Todos</option>
                                    <option value="aberto">Em Aberto</option>
                                    <option value="enviado">Enviado</option>
                                    <option value="solucionado">Solucionado</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Origem Problema:</label>
                                <select id="relatorioOrigem">
                                    <option value="todos">Todos</option>
                                    <option value="prodac">Prodac</option>
                                    <option value="autosystem">AutoSystem</option>
                                </select>
                            </div>
                            <button id="gerarRelatorio" class="btn" style="width: 100%; margin-top: 10px;">
                                <i class="fas fa-chart-bar"></i> Gerar Relatório
                            </button>
                        </div>
                        
                        <div class="system-card">
                            <h3><i class="fas fa-print"></i> Relatórios Personalizados</h3>
                            <div style="margin-top: 20px;">
                                <button id="btnRelatorioEmAberto" class="btn btn-warning" style="width: 100%; margin-bottom: 10px;">
                                    <i class="fas fa-clock"></i> Relatório em Aberto
                                </button>
                                <button id="btnRelatorioSolucionados" class="btn btn-success" style="width: 100%; margin-bottom: 10px;">
                                    <i class="fas fa-check"></i> Relatório Solucionados
                                </button>
                                <button id="btnRelatorioProdac" class="btn btn-info" style="width: 100%; margin-bottom: 10px;">
                                    <i class="fas fa-database"></i> Para Prodac
                                </button>
                                <button id="btnRelatorioJuliana" class="btn btn-secondary" style="width: 100%; margin-bottom: 10px;">
                                    <i class="fas fa-user"></i> Para Juliana
                                </button>
                                <button id="btnImprimir" class="btn" style="width: 100%;">
                                    <i class="fas fa-print"></i> Imprimir Relatório
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="relatorioResultado" style="display: none; margin-top: 30px;">
                        <h3 style="margin-bottom: 20px; color: var(--primary-color); display: flex; align-items: center; gap: 12px;">
                            <i class="fas fa-file-alt"></i> Resultado do Relatório
                        </h3>
                        <div class="table-container">
                            <table class="data-table" id="tabelaRelatorio">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Data</th>
                                        <th>Posto</th>
                                        <th>Mês/Ano</th>
                                        <th>Origem</th>
                                        <th>Status</th>
                                        <th>Destinatário</th>
                                        <th>Data Envio</th>
                                        <th>Data Solução</th>
                                    </tr>
                                </thead>
                                <tbody id="corpoRelatorio">
                                    <!-- Dados do relatório aqui -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- TAB: CONTROLE DE POSTOS -->
            <div class="tab-content" id="tab-postos">
                <div class="form-card">
                    <h3 style="margin-bottom: 20px; color: var(--primary-color); display: flex; align-items: center; gap: 12px;">
                        <i class="fas fa-store"></i> Controle de Postos - Guilherme
                    </h3>
                    
                    <div class="btn-group" style="margin-bottom: 20px;">
                        <button id="btnAddPosto" class="btn btn-info">
                            <i class="fas fa-plus"></i> Adicionar Posto
                        </button>
                        <button id="btnMarcarTodos" class="btn btn-secondary">
                            <i class="fas fa-check-double"></i> Marcar Todos como Verificados
                        </button>
                        <button id="btnExportarPostos" class="btn btn-secondary">
                            <i class="fas fa-file-export"></i> Exportar Controle
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table" id="tabelaPostos">
                            <thead>
                                <tr>
                                    <th>Posto</th>
                                    <th>Cidade/UF</th>
                                    <th>CNPJ</th>
                                    <th>Mês/Ano Referência</th>
                                    <th>Status Arquivo</th>
                                    <th>Data Verificação</th>
                                    <th>Verificado por</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="tabelaCorpoPostos">
                                <!-- Dados serão carregados aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- TAB: CONFIGURAÇÕES -->
            <div class="tab-content" id="tab-config">
                <div class="form-card">
                    <h3 style="margin-bottom: 20px; color: var(--primary-color); display: flex; align-items: center; gap: 12px;">
                        <i class="fas fa-cogs"></i> Configurações do Sistema
                    </h3>
                    
                    <div class="config-grid">
                        <div class="config-section">
                            <h4><i class="fas fa-envelope"></i> Configurações de Email</h4>
                            <div class="config-item">
                                <label>Email da Juliana:</label>
                                <input type="email" id="configEmailJuliana" value="juliana.alves@rededompedro.com" class="full-width">
                            </div>
                            <div class="config-item">
                                <label>Email da Prodac:</label>
                                <input type="email" id="configEmailProdac" value="fiscal@prodac.com.br" class="full-width">
                            </div>
                            <div class="config-item">
                                <label>Assunto Padrão:</label>
                                <input type="text" id="configAssuntoPadrao" value="Solicitação de Ajuste CFOP - Rede Dom Pedro" class="full-width">
                            </div>
                        </div>
                        
                        <div class="config-section">
                            <h4><i class="fas fa-bell"></i> Notificações</h4>
                            <div class="config-item">
                                <label>
                                    <input type="checkbox" id="configNotificacoes" checked>
                                    Notificações no sistema
                                </label>
                            </div>
                        </div>
                        
                        <div class="config-section">
                            <h4><i class="fas fa-database"></i> Gerenciamento de Dados</h4>
                            <div class="config-item">
                                <p><i class="fas fa-database"></i> Total de Solicitações: <strong id="totalSolicitacoes">0</strong></p>
                                <p><i class="fas fa-hdd"></i> Espaço utilizado: <strong id="espacoUtilizado">0 KB</strong></p>
                                <p><i class="fas fa-history"></i> Último backup: <strong id="ultimoBackup">Nenhum</strong></p>
                            </div>
                            <div class="config-item">
                                <label>Manter dados por:</label>
                                <select id="configRetencaoDados" class="full-width">
                                    <option value="180">6 meses</option>
                                    <option value="365" selected>1 ano</option>
                                    <option value="730">2 anos</option>
                                </select>
                            </div>
                            <div style="display: grid; gap: 10px; margin-top: 20px;">
                                <button id="btnLimparDados" class="btn btn-warning">
                                    <i class="fas fa-trash"></i> Limpar Dados Antigos
                                </button>
                                <button id="btnRestaurar" class="btn btn-danger">
                                    <i class="fas fa-undo"></i> Restaurar Backup
                                </button>
                            </div>
                        </div>
                        
                        <div class="config-section">
                            <h4><i class="fas fa-trash"></i> Limpeza Total</h4>
                            <div class="config-item">
                                <p><i class="fas fa-exclamation-triangle" style="color: var(--danger-color);"></i> 
                                   Esta ação removerá TODOS os dados do sistema e o reiniciará.</p>
                            </div>
                            <button id="btnLimparTotal" class="btn btn-danger" style="width: 100%;">
                                <i class="fas fa-broom"></i> Limpar Tudo e Reiniciar Sistema
                            </button>
                        </div>
                        
                        <div class="config-section">
                            <h4><i class="fas fa-file-export"></i> Exportação de Dados</h4>
                            <div class="config-item">
                                <label>Formato de exportação:</label>
                                <select id="configFormatoExportacao" class="full-width">
                                    <option value="csv">CSV</option>
                                    <option value="excel">Excel</option>
                                    <option value="pdf">PDF</option>
                                </select>
                            </div>
                            <button id="salvarConfig" class="btn" style="width: 100%; margin-top: 20px;">
                                <i class="fas fa-save"></i> Salvar Todas as Configurações
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL DETALHES SOLICITAÇÃO -->
    <div class="modal" id="modalDetalhes">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-file-alt"></i> Detalhes da Solicitação</h3>
                <button class="modal-close" id="closeDetalhes">&times;</button>
            </div>
            <div id="detalhesContent"></div>
        </div>
    </div>

    <!-- MODAL SOLUCIONAR -->
    <div class="modal" id="modalSolucao">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-check-circle"></i> Marcar como Solucionado</h3>
                <button class="modal-close" id="closeSolucao">&times;</button>
            </div>
            <div id="solucaoContent">
                <div class="form-group">
                    <label><i class="fas fa-check"></i> Solução Aplicada:</label>
                    <textarea id="solucaoAplicada" rows="4" placeholder="Descreva a solução aplicada..." required></textarea>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-user"></i> Responsável pela Solução:</label>
                    <select id="responsavelSolucao" class="full-width">
                        <option value="waldeci">Waldeci Ramos</option>
                        <option value="juliana">Juliana Alves</option>
                        <option value="produc">Prodac</option>
                    </select>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-calendar"></i> Data da Solução:</label>
                    <input type="date" id="dataSolucao" class="full-width" value="<?php echo date('Y-m-d'); ?>">
                </div>
                <div class="btn-group">
                    <button class="btn btn-success" id="confirmarSolucao">
                        <i class="fas fa-check"></i> Confirmar Solução
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL EMAIL -->
    <div class="modal" id="modalEmail">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-envelope"></i> Enviar Email</h3>
                <button class="modal-close" id="closeEmail">&times;</button>
            </div>
            <div id="emailContent">
                <div class="form-group">
                    <label>Destinatário:</label>
                    <select id="emailDestinatario" class="full-width">
                        <option value="juliana">Juliana Alves (AutoSystem)</option>
                        <option value="prodac">Prodac</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Assunto:</label>
                    <input type="text" id="emailAssunto" class="full-width">
                </div>
                <div class="form-group">
                    <label>Conteúdo:</label>
                    <textarea id="emailConteudo" rows="10" class="full-width" readonly></textarea>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" id="copiarEmail">
                        <i class="fas fa-copy"></i> Copiar Email
                    </button>
                    <button class="btn btn-success" id="enviarEmailModal">
                        <i class="fas fa-paper-plane"></i> Enviar Email
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL ADICIONAR POSTO -->
    <div class="modal" id="modalAddPosto">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-store"></i> Adicionar Novo Posto</h3>
                <button class="modal-close" id="closeAddPosto">&times;</button>
            </div>
            <div id="addPostoContent">
                <div class="form-group">
                    <label><i class="fas fa-signature"></i> Nome do Posto:</label>
                    <input type="text" id="novoPostoNome" class="full-width" placeholder="Ex: DP 1 - ESTIVA" required>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-city"></i> Cidade:</label>
                    <input type="text" id="novoPostoCidade" class="full-width" placeholder="Ex: ESTIVA" required>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-map-marker-alt"></i> Estado:</label>
                    <input type="text" id="novoPostoEstado" class="full-width" placeholder="Ex: MG" maxlength="2" required>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-id-card"></i> CNPJ (opcional):</label>
                    <input type="text" id="novoPostoCnpj" class="full-width" placeholder="Ex: 20.415.295/0001-74">
                </div>
                <div class="btn-group">
                    <button class="btn btn-success" id="confirmarAddPosto">
                        <i class="fas fa-plus"></i> Adicionar Posto
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        class Database {
            constructor() {
                this.STORAGE_KEY = 'cfop_solicitacoes_db_v6';
                this.CONFIG_KEY = 'cfop_config_db_v6';
                this.POSTOS_KEY = 'cfop_postos_db_v3';
                this.HISTORICO_KEY = 'cfop_historico_db_v3';
                this.init();
            }
            
            init() {
                const firstRun = !localStorage.getItem(this.STORAGE_KEY);
                
                const defaults = {
                    [this.STORAGE_KEY]: JSON.stringify({ solicitacoes: [], nextId: 1 }),
                    [this.CONFIG_KEY]: JSON.stringify(this.getDefaultConfig()),
                    [this.POSTOS_KEY]: JSON.stringify(this.getDefaultPostos()),
                    [this.HISTORICO_KEY]: JSON.stringify([])
                };
                
                Object.keys(defaults).forEach(key => {
                    if (!localStorage.getItem(key)) {
                        localStorage.setItem(key, defaults[key]);
                    }
                });
                
                return firstRun;
            }
            
            getDefaultConfig() {
                return {
                    emailJuliana: 'juliana.alves@rededompedro.com',
                    emailProdac: 'fiscal@prodac.com.br',
                    assuntoPadrao: 'Solicitação de Ajuste CFOP - Rede Dom Pedro',
                    notificacoes: true,
                    retencaoDados: 365,
                    formatoExportacao: 'csv',
                    ultimoBackup: null,
                    dataInstalacao: new Date().toISOString()
                };
            }
            
           getDefaultPostos() {
    return [
        {
            id: '2',
            nome: 'DP 1',
            cidade: 'ESTIVA',
            estado: 'MG',
            cnpj: '20.415.295/0001-74',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '3',
            nome: 'DP ITATIAIUCU',
            cidade: 'ITATIAIUCU',
            estado: 'MG',
            cnpj: '20.415.295/0009-21',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '4',
            nome: 'DP LEME',
            cidade: 'LEME',
            estado: 'SP',
            cnpj: '44.740.967/0001-85',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '5',
            nome: 'DP PINDA',
            cidade: 'PINDAMONHANGABA',
            estado: 'SP',
            cnpj: '20.415.295/0083-10',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '6',
            nome: 'DP 2',
            cidade: 'POUSO ALEGRE',
            estado: 'MG',
            cnpj: '20.415.295/0011-46',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '7',
            nome: 'DP POUSO ALEGRE',
            cidade: 'POUSO ALEGRE',
            estado: 'MG',
            cnpj: '20.415.295/0013-08',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '8',
            nome: 'DP ATIBAIA',
            cidade: 'ATIBAIA',
            estado: 'SP',
            cnpj: '20.415.295/0029-75',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '9',
            nome: 'DP ITAPEVA',
            cidade: 'ITAPEVA',
            estado: 'MG',
            cnpj: '20.415.295/0017-31',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '10',
            nome: 'DP CAETANOPOLIS',
            cidade: 'CAETANOPOLIS',
            estado: 'MG',
            cnpj: '20.415.295/0021-18',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '11',
            nome: 'DP BETIM',
            cidade: 'BETIM',
            estado: 'MG',
            cnpj: '20.415.295/0015-70',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '13',
            nome: 'DP TURIM',
            cidade: 'BETIM',
            estado: 'MG',
            cnpj: '20.415.295/0014-99',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '14',
            nome: 'DP SANTA LUZIA',
            cidade: 'SANTA LUZIA',
            estado: 'MG',
            cnpj: '20.415.295/0008-40',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '15',
            nome: 'DP SALINAS',
            cidade: 'SALINAS',
            estado: 'MG',
            cnpj: '20.415.295/0007-60',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '17',
            nome: 'DP APARECIDA',
            cidade: 'APARECIDA',
            estado: 'SP',
            cnpj: '20.415.295/0030-09',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '18',
            nome: 'DP MURIAE',
            cidade: 'MURIAE',
            estado: 'MG',
            cnpj: '20.415.295/0018-12',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '19',
            nome: 'DP PARAOPEBA',
            cidade: 'PARAOPEBA',
            estado: 'MG',
            cnpj: '20.415.295/0020-37',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '20',
            nome: 'DP CONTAGEM NORTE- MATRIZ',
            cidade: 'CONTAGEM',
            estado: 'MG',
            cnpj: '20.415.295/0025-41',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '21',
            nome: 'DP CONTAGEM SUL',
            cidade: 'CONTAGEM',
            estado: 'MG',
            cnpj: '20.415.295/0023-80',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '22',
            nome: 'DP CAMBUI',
            cidade: 'CAMBUI',
            estado: 'MG',
            cnpj: '20.415.295/0016-50',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '24',
            nome: 'DP GUARATINGUETA',
            cidade: 'GUARATINGUETA',
            estado: 'SP',
            cnpj: '20.415.295/0031-90',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '25',
            nome: 'DP JOIA',
            cidade: 'PINDAMONHANGABA',
            estado: 'SP',
            cnpj: '53.163.580/0001-02',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '26',
            nome: 'DP MIRACATU ROTA NORTE',
            cidade: 'MIRACATU',
            estado: 'SP',
            cnpj: '20.415.295/0032-70',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '27',
            nome: 'DP JK ESTIVA ROTA SUL',
            cidade: 'ESTIVA',
            estado: 'MG',
            cnpj: '20.415.295/0010-65',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '28',
            nome: 'DP ALIANCA',
            cidade: 'SAO SEBASTIAO DA BEL',
            estado: 'MG',
            cnpj: '20.415.295/0012-27',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '29',
            nome: 'DP OLIVEIRA',
            cidade: 'OLIVEIRA',
            estado: 'MG',
            cnpj: '20.415.295/0019-01',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '30',
            nome: 'DP CAMBUI - URBANO',
            cidade: 'CAMBUI',
            estado: 'MG',
            cnpj: '20.415.295/0004-17',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '31',
            nome: 'DP JAGUAQUARA',
            cidade: 'JAGUAQUARA',
            estado: 'BA',
            cnpj: '20.415.295/0033-51',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '32',
            nome: 'DP SAO GONCALO DO SAPUCAI',
            cidade: 'SAO GONÇALO DO SAPUC',
            estado: 'MG',
            cnpj: '20.415.295/0035-13',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '33',
            nome: 'DP NOVA SERRANA',
            cidade: 'NOVA SERRANA',
            estado: 'MG',
            cnpj: '20.415.295/0026-22',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '34',
            nome: 'DP IGARATINGA',
            cidade: 'IGARATINGA',
            estado: 'MG',
            cnpj: '20.415.295/0024-60',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '35',
            nome: 'DP CARMOPOLIS',
            cidade: 'CARMOPOLIS DE MINAS',
            estado: 'MG',
            cnpj: '20.415.295/0022-07',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '36',
            nome: 'DP BETIM - 2',
            cidade: 'BETIM',
            estado: 'MG',
            cnpj: '20.415.295/0043-23',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '41',
            nome: 'DP DIVISA ALEGRE 1',
            cidade: 'DIVISA ALEGRE',
            estado: 'MG',
            cnpj: '20.415.295/0005-06',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '42',
            nome: 'DP CAMBUI - URBANO 2',
            cidade: 'CAMBUI',
            estado: 'MG',
            cnpj: '20.415.295/0034-32',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '43',
            nome: 'DP CONTAGEM FERNAO DIAS',
            cidade: 'CONTAGEM',
            estado: 'MG',
            cnpj: '20.415.295/0036-02',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '44',
            nome: 'DP CACHOEIRA DE PAJEU',
            cidade: 'CACHOEIRA DE PAJEU',
            estado: 'MG',
            cnpj: '20.415.295/0038-66',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '47',
            nome: '***CENTRAL ADMINISTRATIVA RE',
            cidade: 'ESTIVA',
            estado: 'MG',
            cnpj: '20.415.295/0037-85',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '48',
            nome: 'DP SANTO ESTEVAO',
            cidade: 'RAFAEL JAMBEIRO',
            estado: 'BA',
            cnpj: '20.415.295/0041-61',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '49',
            nome: 'DP SAO GONCALO URBANO 1',
            cidade: 'SAO GONÇALO DO SAPUC',
            estado: 'MG',
            cnpj: '09.047.306/0001-78',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '50',
            nome: 'DP ITAGUARA',
            cidade: 'ITATIAIUCU',
            estado: 'MG',
            cnpj: '20.415.295/0006-89',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '51',
            nome: 'DP SENADOR AMARAL',
            cidade: 'SENADOR AMARAL',
            estado: 'MG',
            cnpj: '20.415.295/0045-95',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '53',
            nome: 'DP SAO GONCALO URBANO 2',
            cidade: 'SAO GONÇALO DO SAPUC',
            estado: 'MG',
            cnpj: '20.415.295/0044-04',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '54',
            nome: 'DP LORENA',
            cidade: 'LORENA',
            estado: 'SP',
            cnpj: '20.415.295/0042-42',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '55',
            nome: 'DP DIVISA ALEGRE 2',
            cidade: 'DIVISA ALEGRE',
            estado: 'MG',
            cnpj: '20.415.295/0040-80',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '56',
            nome: 'DP INCONFIDENTES',
            cidade: 'INCONFIDENTES',
            estado: 'MG',
            cnpj: '20.415.295/0055-67',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '57',
            nome: 'DP JUIZ DE FORA URBANO',
            cidade: 'JUIZ DE FORA',
            estado: 'MG',
            cnpj: '20.415.295/0068-81',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '58',
            nome: 'DP BUENO BRANDAO',
            cidade: 'BUENO BRANDAO',
            estado: 'MG',
            cnpj: '20.415.295/0054-86',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '59',
            nome: 'DP POUSO ALEGRE URBANO',
            cidade: 'POUSO ALEGRE',
            estado: 'MG',
            cnpj: '20.415.295/0048-38',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '60',
            nome: 'DP CAMANDUCAIA URBANO',
            cidade: 'CAMANDUCAIA',
            estado: 'MG',
            cnpj: '20.415.295/0053-03',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '61',
            nome: 'DP OURO FINO URBANO',
            cidade: 'OURO FINO',
            estado: 'MG',
            cnpj: '20.415.295/0049-19',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '63',
            nome: 'DP CAMANDUCAIA URBANO 2',
            cidade: 'CAMANDUCAIA',
            estado: 'MG',
            cnpj: '20.415.295/0052-14',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '64',
            nome: 'DP GUARATINGUETA URBANO 2',
            cidade: 'GUARATINGUETA',
            estado: 'SP',
            cnpj: '20.415.295/0046-76',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '65',
            nome: 'DP GUARATINGUETA URBANO 3',
            cidade: 'GUARATINGUETA',
            estado: 'SP',
            cnpj: '20.415.295/0047-57',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '66',
            nome: 'DP BRAGANCA URBANO',
            cidade: 'BRAGANÇA PAULISTA',
            estado: 'SP',
            cnpj: '20.415.295/0070-04',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '68',
            nome: 'DP ATIBAIA URBANO',
            cidade: 'ATIBAIA',
            estado: 'SP',
            cnpj: '20.415.295/0077-72',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '69',
            nome: 'DP POUSO ALEGRE URBANO 2',
            cidade: 'POUSO ALEGRE',
            estado: 'MG',
            cnpj: '20.415.295/0056-48',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '70',
            nome: 'DP EXTREMA URBANO',
            cidade: 'EXTREMA',
            estado: 'MG',
            cnpj: '20.415.295/0050-52',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '75',
            nome: 'DP ITATIBA URBANO 1',
            cidade: 'ITATIBA',
            estado: 'SP',
            cnpj: '20.415.295/0093-92',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '76',
            nome: 'DP ITATIBA URBANO 2',
            cidade: 'ITATIBA',
            estado: 'SP',
            cnpj: '25.188.461/0001-60',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '77',
            nome: 'DP POUSO ALEGRE URBANO 3',
            cidade: 'POUSO ALEGRE',
            estado: 'MG',
            cnpj: '20.415.295/0062-96',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '79',
            nome: 'DP VITORIA DA CONQUISTA',
            cidade: 'VITORIA DA CONQUISTA',
            estado: 'BA',
            cnpj: '20.415.295/0058-00',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '80',
            nome: 'DP JUIZ DE FORA RODOVIA',
            cidade: 'JUIZ DE FORA',
            estado: 'MG',
            cnpj: '20.415.295/0066-10',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '81',
            nome: 'DP MONTES CLAROS',
            cidade: 'FRANCISCO SA',
            estado: 'MG',
            cnpj: '20.415.295/0069-62',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '83',
            nome: 'DP SAO JORGE',
            cidade: 'VITORIA DA CONQUISTA',
            estado: 'BA',
            cnpj: '20.415.295/0060-24',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '86',
            nome: 'DP SAO JOSE DOS CAMPOS URBAN',
            cidade: 'SAO JOSE DOS CAMPOS',
            estado: 'SP',
            cnpj: '20.415.295/0065-39',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '87',
            nome: 'DP FREI INOCENCIO',
            cidade: 'FREI INOCENCIO',
            estado: 'MG',
            cnpj: '20.415.295/0059-90',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '88',
            nome: 'DP BRAGANÇA RODOVIA',
            cidade: 'BRAGANCA PAULISTA',
            estado: 'SP',
            cnpj: '20.415.295/0064-58',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '89',
            nome: 'DP BARRA MANSA 1 NORTE',
            cidade: 'BARRA MANSA',
            estado: 'RJ',
            cnpj: '20.415.295/0072-68',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '90',
            nome: 'DP BARRA MANSA 2 SUL',
            cidade: 'BARRA MANSA',
            estado: 'RJ',
            cnpj: '20.415.295/0067-09',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '91',
            nome: 'DP LAFAIETE',
            cidade: 'CONSELHEIRO LAFAIETE',
            estado: 'MG',
            cnpj: '20.415.295/0071-87',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '92',
            nome: 'DP PLANALTO',
            cidade: 'PLANALTO',
            estado: 'BA',
            cnpj: '20.415.295/0074-20',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '93',
            nome: 'DP SANTO ESTEVÃO 2',
            cidade: 'SANTO ESTEVAO',
            estado: 'BA',
            cnpj: '20.415.295/0080-78',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '94',
            nome: 'DP SANTO ESTEVÃO 3',
            cidade: 'SANTO ESTEVAO',
            estado: 'BA',
            cnpj: '20.415.295/0081-59',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '95',
            nome: 'DP SAO CRISTOVAO',
            cidade: 'SAO CRISTOVAO',
            estado: 'SE',
            cnpj: '20.415.295/0090-40',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '96',
            nome: 'DP BARREIRAS',
            cidade: 'BARREIRAS',
            estado: 'BA',
            cnpj: '20.415.295/0087-44',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '97',
            nome: 'DP ITABERABA',
            cidade: 'ITABERABA',
            estado: 'BA',
            cnpj: '20.415.295/0086-63',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '98',
            nome: 'DP VALENCA',
            cidade: 'VALENÇA',
            estado: 'BA',
            cnpj: '20.415.295/0085-82',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '99',
            nome: 'DP SAO GONCALO RODOVIA 2',
            cidade: 'SAO GONÇALO DO SAPUC',
            estado: 'MG',
            cnpj: '20.415.295/0088-25',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '100',
            nome: 'DP SAO GONCALO RODOVIA 3',
            cidade: 'SAO GONÇALO DO SAPUC',
            estado: 'MG',
            cnpj: '20.415.295/0089-06',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '102',
            nome: 'DP RUSSAS',
            cidade: 'RUSSAS',
            estado: 'CE',
            cnpj: '20.415.295/0091-20',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '103',
            nome: 'DP INHAPIM',
            cidade: 'INHAPIM',
            estado: 'MG',
            cnpj: '20.415.295/0092-01',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        },
        {
            id: '104',
            nome: 'DP LUZ',
            cidade: 'LUZ',
            estado: 'MG',
            cnpj: '20.415.295/0094-73',
            verificacao: {
                status: 'pendente',
                data: null,
                responsavel: null,
                mesReferencia: null
            }
        }
    ];
}
            
            addPosto(posto) {
                const postos = this.getPostos();
                const newId = postos.length > 0 ? Math.max(...postos.map(p => parseInt(p.id))) + 1 : 1;
                
                const novoPosto = {
                    id: newId.toString(),
                    nome: posto.nome,
                    cidade: posto.cidade,
                    estado: posto.estado,
                    cnpj: posto.cnpj || '',
                    verificacao: {
                        status: 'pendente',
                        data: null,
                        responsavel: null,
                        mesReferencia: null
                    }
                };
                
                postos.push(novoPosto);
                localStorage.setItem(this.POSTOS_KEY, JSON.stringify(postos));
                return novoPosto;
            }
            
            updatePosto(postoId, updates) {
                const postos = this.getPostos();
                const index = postos.findIndex(p => p.id === postoId);
                
                if (index !== -1) {
                    if (updates.verificacao) {
                        postos[index].verificacao = { 
                            ...postos[index].verificacao, 
                            ...updates.verificacao 
                        };
                    } else {
                        postos[index] = { ...postos[index], ...updates };
                    }
                    
                    localStorage.setItem(this.POSTOS_KEY, JSON.stringify(postos));
                    return true;
                }
                
                return false;
            }
            
            deletePosto(postoId) {
                const postos = this.getPostos();
                const index = postos.findIndex(p => p.id === postoId);
                
                if (index !== -1) {
                    postos.splice(index, 1);
                    localStorage.setItem(this.POSTOS_KEY, JSON.stringify(postos));
                    return true;
                }
                
                return false;
            }
            
            getPostos() {
                return JSON.parse(localStorage.getItem(this.POSTOS_KEY) || '[]');
            }
            
            getPosto(id) {
                const postos = this.getPostos();
                return postos.find(p => p.id === id);
            }
            
            getSolicitacoes() {
                const data = JSON.parse(localStorage.getItem(this.STORAGE_KEY) || '{"solicitacoes": []}');
                return data.solicitacoes || [];
            }
            
            getSolicitacao(id) {
                const solicitacoes = this.getSolicitacoes();
                return solicitacoes.find(s => s.id === id);
            }
            
            addSolicitacao(solicitacao) {
                const data = JSON.parse(localStorage.getItem(this.STORAGE_KEY));
                solicitacao.id = data.nextId++;
                solicitacao.dataCriacao = new Date().toISOString();
                solicitacao.ultimaAtualizacao = new Date().toISOString();
                solicitacao.status = 'aberto';
                
                data.solicitacoes.push(solicitacao);
                localStorage.setItem(this.STORAGE_KEY, JSON.stringify(data));
                
                this.registrarHistorico(solicitacao.id, 'criacao', 'Solicitação criada');
                return solicitacao.id;
            }
            
            updateSolicitacao(id, updates) {
                const data = JSON.parse(localStorage.getItem(this.STORAGE_KEY));
                const index = data.solicitacoes.findIndex(s => s.id === id);
                
                if (index !== -1) {
                    const original = data.solicitacoes[index];
                    const updated = { ...original, ...updates, ultimaAtualizacao: new Date().toISOString() };
                    
                    if (!updates.status) {
                        updated.status = 'aberto';
                    }
                    
                    if (updates.status === 'enviado' && !updated.dataEnvio) {
                        updated.dataEnvio = new Date().toISOString();
                    }
                    
                    if (updates.status === 'solucionado' && !updated.dataSolucao) {
                        updated.dataSolucao = new Date().toISOString();
                    }
                    
                    if (updates.status && updates.status !== original.status) {
                        this.registrarHistorico(id, 'status', `Status alterado para: ${updates.status}`);
                    }
                    
                    data.solicitacoes[index] = updated;
                    localStorage.setItem(this.STORAGE_KEY, JSON.stringify(data));
                    return true;
                }
                
                return false;
            }
            
            deleteSolicitacao(id) {
                const data = JSON.parse(localStorage.getItem(this.STORAGE_KEY));
                const index = data.solicitacoes.findIndex(s => s.id === id);
                
                if (index !== -1) {
                    this.registrarHistorico(id, 'exclusao', 'Solicitação excluída');
                    data.solicitacoes.splice(index, 1);
                    localStorage.setItem(this.STORAGE_KEY, JSON.stringify(data));
                    return true;
                }
                
                return false;
            }
            
            registrarHistorico(solicitacaoId, tipo, descricao) {
                const historico = JSON.parse(localStorage.getItem(this.HISTORICO_KEY) || '[]');
                historico.push({
                    solicitacaoId: solicitacaoId,
                    tipo: tipo,
                    descricao: descricao,
                    data: new Date().toISOString(),
                    usuario: 'Sistema'
                });
                localStorage.setItem(this.HISTORICO_KEY, JSON.stringify(historico));
            }
            
            getHistorico(solicitacaoId) {
                const historico = JSON.parse(localStorage.getItem(this.HISTORICO_KEY) || '[]');
                return historico.filter(h => h.solicitacaoId === solicitacaoId);
            }
            
            getConfig() {
                return JSON.parse(localStorage.getItem(this.CONFIG_KEY) || JSON.stringify(this.getDefaultConfig()));
            }
            
            updateConfig(updates) {
                const config = this.getConfig();
                const newConfig = { ...config, ...updates };
                localStorage.setItem(this.CONFIG_KEY, JSON.stringify(newConfig));
                return newConfig;
            }
            
            getStats() {
                const solicitacoes = this.getSolicitacoes();
                const hoje = new Date().setHours(0,0,0,0);
                
                return {
                    total: solicitacoes.length,
                    hoje: solicitacoes.filter(s => 
                        new Date(s.dataCriacao).setHours(0,0,0,0) === hoje
                    ).length,
                    aberto: solicitacoes.filter(s => s.status === 'aberto').length,
                    enviado: solicitacoes.filter(s => s.status === 'enviado').length,
                    solucionado: solicitacoes.filter(s => s.status === 'solucionado').length
                };
            }
            
            getStatsPostos() {
                const postos = this.getPostos();
                return {
                    total: postos.length,
                    pendentes: postos.filter(p => p.verificacao.status === 'pendente').length,
                    verificados: postos.filter(p => p.verificacao.status === 'verificado').length,
                    copiados: postos.filter(p => p.verificacao.status === 'copiado').length
                };
            }
            
            resetDatabase() {
                localStorage.removeItem(this.STORAGE_KEY);
                localStorage.removeItem(this.CONFIG_KEY);
                localStorage.removeItem(this.POSTOS_KEY);
                localStorage.removeItem(this.HISTORICO_KEY);
                
                this.init();
                
                return true;
            }
            
            clearOldData(days = 365) {
                const solicitacoes = this.getSolicitacoes();
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - days);
                
                const filtered = solicitacoes.filter(s => 
                    new Date(s.dataCriacao) > cutoffDate || 
                    s.status !== 'solucionado'
                );
                
                localStorage.setItem(this.STORAGE_KEY, JSON.stringify({
                    solicitacoes: filtered,
                    nextId: filtered.length > 0 ? Math.max(...filtered.map(s => s.id)) + 1 : 1
                }));
                
                return solicitacoes.length - filtered.length;
            }
            
            exportBackup() {
                const data = {
                    solicitacoes: this.getSolicitacoes(),
                    config: this.getConfig(),
                    postos: this.getPostos(),
                    historico: JSON.parse(localStorage.getItem(this.HISTORICO_KEY) || '[]'),
                    timestamp: new Date().toISOString(),
                    versao: '6.0'
                };
                
                this.updateConfig({ ultimoBackup: new Date().toISOString() });
                return JSON.stringify(data, null, 2);
            }
            
            importBackup(backupData) {
                try {
                    const data = JSON.parse(backupData);
                    
                    if (data.solicitacoes && data.config) {
                        localStorage.setItem(this.STORAGE_KEY, JSON.stringify({
                            solicitacoes: data.solicitacoes,
                            nextId: data.solicitacoes.length > 0 ? Math.max(...data.solicitacoes.map(s => s.id)) + 1 : 1
                        }));
                        
                        localStorage.setItem(this.CONFIG_KEY, JSON.stringify(data.config));
                        if (data.postos) localStorage.setItem(this.POSTOS_KEY, JSON.stringify(data.postos));
                        if (data.historico) localStorage.setItem(this.HISTORICO_KEY, JSON.stringify(data.historico));
                        
                        return true;
                    }
                } catch (error) {
                    console.error('Erro ao importar backup:', error);
                }
                
                return false;
            }
        }

        class CFOPApp {
            constructor() {
                this.db = new Database();
                this.currentSolicitacao = null;
                this.currentPosto = null;
                this.postos = this.db.getPostos();
                this.config = this.db.getConfig();
                this.charts = {};
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.updateStats();
                this.carregarHistorico();
                this.carregarPostos();
                this.updateTime();
                this.carregarConfiguracoes();
                
                const today = new Date();
                document.getElementById('mesReferencia').value = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;
                
                setInterval(() => this.updateTime(), 1000);
                setTimeout(() => this.initCharts(), 500);
            }
            
            setupEventListeners() {
                // Navegação entre tabs
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        const tabId = tab.getAttribute('data-tab');
                        this.switchTab(tabId);
                    });
                });
                
                // Busca de postos
                const postoSearch = document.getElementById('postoSearch');
                const searchResults = document.getElementById('searchResults');
                
                if (postoSearch) {
                    postoSearch.addEventListener('input', () => {
                        const query = postoSearch.value.toLowerCase();
                        const filtered = this.postos.filter(posto => 
                            posto.nome.toLowerCase().includes(query) ||
                            posto.cidade.toLowerCase().includes(query) ||
                            posto.estado.toLowerCase().includes(query) ||
                            posto.cnpj.toLowerCase().includes(query)
                        );
                        
                        this.showSearchResults(filtered);
                    });
                }
                
                if (searchResults) {
                    searchResults.addEventListener('click', (e) => {
                        if (e.target.classList.contains('search-result-item')) {
                            const postoId = e.target.getAttribute('data-id');
                            this.selectPosto(postoId);
                            searchResults.style.display = 'none';
                        }
                    });
                }
                
                document.addEventListener('click', (e) => {
                    if (postoSearch && searchResults && 
                        !postoSearch.contains(e.target) && !searchResults.contains(e.target)) {
                        searchResults.style.display = 'none';
                    }
                });
                
                // Botões principais
                document.getElementById('salvarRascunho')?.addEventListener('click', () => this.salvarSolicitacao());
                document.getElementById('enviarEmail')?.addEventListener('click', () => this.prepararEmail());
                
                // Botões do histórico
                document.getElementById('btnFiltrar')?.addEventListener('click', () => this.filtrarHistorico());
                document.getElementById('btnExportar')?.addEventListener('click', () => this.exportarDados());
                document.getElementById('btnBackup')?.addEventListener('click', () => this.criarBackup());
                document.getElementById('btnRestaurar')?.addEventListener('click', () => this.restaurarBackup());
                
                // Botões de relatórios
                document.getElementById('gerarRelatorio')?.addEventListener('click', () => this.gerarRelatorio());
                document.getElementById('btnRelatorioEmAberto')?.addEventListener('click', () => this.gerarRelatorioEmAberto());
                document.getElementById('btnRelatorioSolucionados')?.addEventListener('click', () => this.gerarRelatorioSolucionados());
                document.getElementById('btnRelatorioProdac')?.addEventListener('click', () => this.gerarRelatorioProdac());
                document.getElementById('btnRelatorioJuliana')?.addEventListener('click', () => this.gerarRelatorioJuliana());
                document.getElementById('btnImprimir')?.addEventListener('click', () => this.imprimirRelatorio());
                
                // Botões de postos
                document.getElementById('btnAddPosto')?.addEventListener('click', () => this.showModalAddPosto());
                document.getElementById('btnMarcarTodos')?.addEventListener('click', () => this.marcarTodosVerificados());
                document.getElementById('btnExportarPostos')?.addEventListener('click', () => this.exportarControlePostos());
                
                // Botões de configurações
                document.getElementById('salvarConfig')?.addEventListener('click', () => this.salvarConfig());
                document.getElementById('btnLimparDados')?.addEventListener('click', () => this.limparDadosAntigos());
                document.getElementById('btnLimparTotal')?.addEventListener('click', () => this.limparTotal());
                
                // Eventos de modais
                document.getElementById('closeDetalhes')?.addEventListener('click', () => this.closeModal('modalDetalhes'));
                document.getElementById('closeSolucao')?.addEventListener('click', () => this.closeModal('modalSolucao'));
                document.getElementById('closeEmail')?.addEventListener('click', () => this.closeModal('modalEmail'));
                document.getElementById('closeAddPosto')?.addEventListener('click', () => this.closeModal('modalAddPosto'));
                
                // Botões dentro de modais
                document.getElementById('confirmarSolucao')?.addEventListener('click', () => this.confirmarSolucao());
                document.getElementById('copiarEmail')?.addEventListener('click', () => this.copiarEmail());
                document.getElementById('enviarEmailModal')?.addEventListener('click', () => this.enviarEmailModal());
                document.getElementById('confirmarAddPosto')?.addEventListener('click', () => this.adicionarNovoPosto());
                
                // Formatação de valores
                ['valorProdac', 'valorAutoSystem'].forEach(id => {
                    const input = document.getElementById(id);
                    if (input) {
                        input.addEventListener('blur', () => this.formatarValor(input));
                    }
                });
                
                // Eventos de filtros
                const relatorioPeriodo = document.getElementById('relatorioPeriodo');
                if (relatorioPeriodo) {
                    relatorioPeriodo.addEventListener('change', (e) => {
                        const periodoCustom = document.getElementById('periodoCustom');
                        if (periodoCustom) {
                            periodoCustom.style.display = e.target.value === 'custom' ? 'block' : 'none';
                        }
                    });
                }
            }
            
            switchTab(tabId) {
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.classList.toggle('active', tab.getAttribute('data-tab') === tabId);
                });
                
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.toggle('active', content.id === `tab-${tabId}`);
                });
                
                if (tabId === 'historico') {
                    this.carregarHistorico();
                } else if (tabId === 'relatorios') {
                    setTimeout(() => this.atualizarGraficos(), 100);
                } else if (tabId === 'postos') {
                    this.carregarPostos();
                } else if (tabId === 'config') {
                    this.updateSpaceInfo();
                }
            }
            
            showSearchResults(postos) {
                const searchResults = document.getElementById('searchResults');
                if (!searchResults) return;
                
                if (postos.length === 0) {
                    searchResults.innerHTML = '<div class="search-result-item">Nenhum posto encontrado</div>';
                } else {
                    searchResults.innerHTML = postos.map(posto => `
                        <div class="search-result-item" data-id="${posto.id}">
                            <strong>${posto.nome}</strong>
                            <small>${posto.cidade}/${posto.estado} - ${posto.cnpj || 'CNPJ não informado'}</small>
                        </div>
                    `).join('');
                }
                
                searchResults.style.display = 'block';
            }
            
            selectPosto(postoId) {
                const posto = this.postos.find(p => p.id === postoId);
                if (!posto) return;
                
                document.getElementById('postoSearch').value = `${posto.nome} - ${posto.cidade}/${posto.estado}`;
                document.getElementById('postoId').value = posto.id;
            }
            
            formatarValor(input) {
                if (input.value) {
                    const valor = this.parseCurrency(input.value);
                    input.value = this.formatCurrency(valor);
                }
            }
            
            parseCurrency(value) {
                let cleanValue = value.toString().replace(/[^\d,.-]/g, '');
                cleanValue = cleanValue.replace('.', '').replace(',', '.');
                return parseFloat(cleanValue) || 0;
            }
            
            formatCurrency(value) {
                return new Intl.NumberFormat('pt-BR', {
                    style: 'currency',
                    currency: 'BRL',
                    minimumFractionDigits: 2
                }).format(value);
            }
            
            getFormData() {
                const postoId = document.getElementById('postoId').value;
                const posto = this.postos.find(p => p.id === postoId);
                
                if (!posto && !this.currentSolicitacao) {
                    this.showNotification('Por favor, selecione um posto válido.', 'warning');
                    return null;
                }
                
                const origemProblema = document.querySelector('input[name="origemProblema"]:checked');
                if (!origemProblema) {
                    this.showNotification('Por favor, selecione a origem do problema.', 'warning');
                    return null;
                }
                
                const dados = {
                    posto: posto || (this.currentSolicitacao ? this.currentSolicitacao.posto : null),
                    mesReferencia: document.getElementById('mesReferencia').value,
                    cfopProdac: document.getElementById('cfopProdac').value,
                    cfopAutoSystem: document.getElementById('cfopAutoSystem').value,
                    valorProdac: document.getElementById('valorProdac').value,
                    valorAutoSystem: document.getElementById('valorAutoSystem').value,
                    dadosComparacao: document.getElementById('dadosComparacao').value,
                    descricao: document.getElementById('descricao').value,
                    origemProblema: origemProblema.value,
                    status: 'aberto'
                };
                
                return dados;
            }
            
            salvarSolicitacao() {
                const data = this.getFormData();
                if (!data) return;
                
                if (!data.descricao || data.descricao.trim().length < 10) {
                    this.showNotification('Por favor, forneça uma descrição detalhada da divergência.', 'warning');
                    return;
                }
                
                let id;
                
                if (this.currentSolicitacao && this.currentSolicitacao.id) {
                    id = this.currentSolicitacao.id;
                    this.db.updateSolicitacao(id, data);
                } else {
                    id = this.db.addSolicitacao(data);
                }
                
                this.showNotification(`Solicitação ${id} salva com sucesso!`, 'success');
                this.updateStats();
                this.carregarHistorico();
                this.limparFormulario();
                this.currentSolicitacao = null;
            }
            
            prepararEmail() {
                const data = this.getFormData();
                if (!data) return;
                
                if (!data.descricao || data.descricao.trim().length < 10) {
                    this.showNotification('Por favor, forneça uma descrição detalhada da divergência.', 'warning');
                    return;
                }
                
                this.currentSolicitacao = data;
                
                const emailContent = this.generateEmailContent(data);
                const assunto = `${this.config.assuntoPadrao} - ${data.posto.nome} - ${data.mesReferencia.split('-')[1]}/${data.mesReferencia.split('-')[0]}`;
                
                document.getElementById('emailAssunto').value = assunto;
                document.getElementById('emailConteudo').value = emailContent;
                
                const destinatario = data.origemProblema === 'prodac' ? 'prodac' : 'juliana';
                document.getElementById('emailDestinatario').value = destinatario;
                
                this.showModal('modalEmail');
            }
            
            generateEmailContent(data) {
                const [year, month] = data.mesReferencia.split('-');
                const mesAno = `${month}/${year}`;
                
                let email = `Prezados,\n\n`;
                email += `Identificamos divergências nos registros do Posto ${data.posto.nome} (${data.posto.cidade}/${data.posto.estado}), referente a ${mesAno}.\n\n`;
                
                email += `DADOS DA DIVERGÊNCIA:\n`;
                email += `=====================\n`;
                
                if (data.cfopProdac && data.cfopAutoSystem) {
                    email += `CFOP Prodac: ${data.cfopProdac}\n`;
                    email += `CFOP AutoSystem: ${data.cfopAutoSystem}\n`;
                }
                
                if (data.valorProdac && data.valorAutoSystem) {
                    email += `Valor Prodac: ${data.valorProdac}\n`;
                    email += `Valor AutoSystem: ${data.valorAutoSystem}\n`;
                }
                
                email += `\n`;
                email += `ORIGEM DO PROBLEMA: ${data.origemProblema === 'prodac' ? 'PRODAC' : 'AUTOSYSTEM'}\n`;
                email += `=====================\n\n`;
                
                email += `DESCRIÇÃO DETALHADA:\n`;
                email += `=====================\n`;
                email += `${data.descricao}\n\n`;
                
                if (data.dadosComparacao) {
                    email += `DADOS DA COMPARAÇÃO:\n`;
                    email += `=====================\n`;
                    email += `${data.dadosComparacao}\n\n`;
                }
                
                email += `SOLICITAÇÃO:\n`;
                email += `=====================\n`;
                email += `Por gentileza, solicitamos que verifiquem esta divergência e nos orientem sobre a correção necessária.\n\n`;
                
                email += `Atenciosamente,\n`;
                email += `Waldeci Ramos\n`;
                email += `Rede Dom Pedro\n`;
                email += `CNPJ: ${data.posto.cnpj || 'Não informado'}`;
                
                return email;
            }
            
            copiarEmail() {
                const emailConteudo = document.getElementById('emailConteudo');
                if (emailConteudo) {
                    navigator.clipboard.writeText(emailConteudo.value).then(() => {
                        this.showNotification('Email copiado para a área de transferência!', 'success');
                    });
                }
            }
            
            enviarEmailModal() {
                const destinatario = document.getElementById('emailDestinatario').value;
                const assunto = document.getElementById('emailAssunto').value;
                const conteudo = document.getElementById('emailConteudo').value;
                
                const emailTo = destinatario === 'prodac' ? this.config.emailProdac : this.config.emailJuliana;
                
                let id;
                const data = this.currentSolicitacao;
                
                if (this.currentSolicitacao && this.currentSolicitacao.id) {
                    id = this.currentSolicitacao.id;
                    this.db.updateSolicitacao(id, {
                        ...data,
                        status: 'enviado',
                        dataEnvio: new Date().toISOString(),
                        destinatario: emailTo
                    });
                } else {
                    data.status = 'enviado';
                    data.dataEnvio = new Date().toISOString();
                    data.destinatario = emailTo;
                    id = this.db.addSolicitacao(data);
                }
                
                const mailtoLink = `mailto:${emailTo}?subject=${encodeURIComponent(assunto)}&body=${encodeURIComponent(conteudo)}`;
                window.open(mailtoLink, '_blank');
                
                this.showNotification(`Solicitação ${id} enviada para ${destinatario === 'prodac' ? 'Prodac' : 'Juliana'}!`, 'success');
                this.updateStats();
                this.carregarHistorico();
                this.limparFormulario();
                this.closeModal('modalEmail');
                this.currentSolicitacao = null;
            }
            
            limparFormulario() {
                const postoSearch = document.getElementById('postoSearch');
                const postoId = document.getElementById('postoId');
                const cfopProdac = document.getElementById('cfopProdac');
                const cfopAutoSystem = document.getElementById('cfopAutoSystem');
                const valorProdac = document.getElementById('valorProdac');
                const valorAutoSystem = document.getElementById('valorAutoSystem');
                const dadosComparacao = document.getElementById('dadosComparacao');
                const descricao = document.getElementById('descricao');
                
                if (postoSearch) postoSearch.value = '';
                if (postoId) postoId.value = '';
                if (cfopProdac) cfopProdac.value = '';
                if (cfopAutoSystem) cfopAutoSystem.value = '';
                if (valorProdac) valorProdac.value = '';
                if (valorAutoSystem) valorAutoSystem.value = '';
                if (dadosComparacao) dadosComparacao.value = '';
                if (descricao) descricao.value = '';
                
                const radios = document.querySelectorAll('input[name="origemProblema"]');
                radios.forEach(radio => radio.checked = false);
                
                this.currentSolicitacao = null;
            }
            
            carregarHistorico() {
                const solicitacoes = this.db.getSolicitacoes();
                const tbody = document.getElementById('tabelaCorpoHistorico');
                
                if (!tbody) return;
                
                tbody.innerHTML = '';
                
                solicitacoes.sort((a, b) => new Date(b.ultimaAtualizacao || b.dataCriacao) - new Date(a.ultimaAtualizacao || a.dataCriacao))
                .forEach(s => {
                    const [year, month] = s.mesReferencia.split('-');
                    const mesAno = `${month}/${year}`;
                    
                    const dataCriacao = new Date(s.dataCriacao).toLocaleDateString('pt-BR');
                    const dataEnvio = s.dataEnvio ? new Date(s.dataEnvio).toLocaleDateString('pt-BR') : '-';
                    const dataSolucao = s.dataSolucao ? new Date(s.dataSolucao).toLocaleDateString('pt-BR') : '-';
                    
                    const statusClass = `status-${s.status}`;
                    const statusText = this.getStatusText(s.status);
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${s.id}</td>
                        <td>${dataCriacao}</td>
                        <td>${s.posto.nome}</td>
                        <td>${mesAno}</td>
                        <td>${s.origemProblema === 'prodac' ? 'Prodac' : 'AutoSystem'}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>${s.destinatario ? (s.destinatario.includes('juliana') ? 'Juliana' : 'Prodac') : '-'}</td>
                        <td>${dataEnvio}</td>
                        <td>${dataSolucao}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn" onclick="app.verDetalhes(${s.id})" title="Ver detalhes">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="action-btn" onclick="app.editarSolicitacao(${s.id})" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                ${s.status !== 'solucionado' ? `
                                <button class="action-btn success" onclick="app.marcarSolucionado(${s.id})" title="Marcar como solucionado">
                                    <i class="fas fa-check"></i>
                                </button>
                                ` : ''}
                                <button class="action-btn danger" onclick="app.excluirSolicitacao(${s.id})" title="Excluir">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });
            }
            
            getStatusText(status) {
                const statusMap = {
                    'aberto': 'Em Aberto',
                    'enviado': 'Enviado',
                    'solucionado': 'Solucionado'
                };
                return statusMap[status] || status;
            }
            
            verDetalhes(id) {
                const solicitacao = this.db.getSolicitacao(id);
                
                if (!solicitacao) return;
                
                const [year, month] = solicitacao.mesReferencia.split('-');
                const mesAno = `${month}/${year}`;
                
                let detalhes = `
                    <h4 style="margin-bottom: 20px; color: var(--primary-color);">Solicitação #${solicitacao.id}</h4>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <strong><i class="fas fa-store"></i> Posto:</strong><br>
                            ${solicitacao.posto.nome}<br>
                            ${solicitacao.posto.cidade}/${solicitacao.posto.estado}<br>
                            CNPJ: ${solicitacao.posto.cnpj || 'Não informado'}
                        </div>
                        
                        <div>
                            <strong><i class="fas fa-calendar"></i> Referência:</strong><br>
                            ${mesAno}<br><br>
                            
                            <strong><i class="fas fa-flag"></i> Status:</strong><br>
                            <span class="status-badge status-${solicitacao.status}">
                                ${this.getStatusText(solicitacao.status)}
                            </span>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <strong><i class="fas fa-exclamation-triangle"></i> Origem do Problema:</strong><br>
                        ${solicitacao.origemProblema === 'prodac' ? 'Prodac' : 'AutoSystem'}
                    </div>
                `;
                
                if (solicitacao.cfopProdac || solicitacao.cfopAutoSystem) {
                    detalhes += `
                        <div style="margin-bottom: 20px;">
                            <strong><i class="fas fa-list"></i> CFOPs:</strong><br>
                            Prodac: ${solicitacao.cfopProdac || '-'}<br>
                            AutoSystem: ${solicitacao.cfopAutoSystem || '-'}
                        </div>
                    `;
                }
                
                if (solicitacao.valorProdac || solicitacao.valorAutoSystem) {
                    detalhes += `
                        <div style="margin-bottom: 20px;">
                            <strong><i class="fas fa-money-bill-wave"></i> Valores:</strong><br>
                            Prodac: ${solicitacao.valorProdac || '-'}<br>
                            AutoSystem: ${solicitacao.valorAutoSystem || '-'}
                        </div>
                    `;
                }
                
                if (solicitacao.descricao) {
                    detalhes += `
                        <div style="margin-bottom: 20px;">
                            <strong><i class="fas fa-file-alt"></i> Descrição:</strong><br>
                            ${solicitacao.descricao.replace(/\n/g, '<br>')}
                        </div>
                    `;
                }
                
                if (solicitacao.dadosComparacao) {
                    detalhes += `
                        <div style="margin-bottom: 20px;">
                            <strong><i class="fas fa-file-excel"></i> Dados da Comparação:</strong><br>
                            <pre style="background: #f5f5f5; padding: 10px; border-radius: 5px; overflow: auto; max-height: 200px;">${solicitacao.dadosComparacao}</pre>
                        </div>
                    `;
                }
                
                if (solicitacao.solucao) {
                    detalhes += `
                        <div style="margin-bottom: 20px;">
                            <strong><i class="fas fa-check-circle"></i> Solução Aplicada:</strong><br>
                            ${solicitacao.solucao.replace(/\n/g, '<br>')}
                        </div>
                    `;
                }
                
                detalhes += `
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid var(--border-color);">
                        <small>
                            <strong>Criado em:</strong> ${new Date(solicitacao.dataCriacao).toLocaleString('pt-BR')}<br>
                            ${solicitacao.dataEnvio ? `<strong>Enviado em:</strong> ${new Date(solicitacao.dataEnvio).toLocaleString('pt-BR')}<br>` : ''}
                            ${solicitacao.dataSolucao ? `<strong>Solucionado em:</strong> ${new Date(solicitacao.dataSolucao).toLocaleString('pt-BR')}<br>` : ''}
                            <strong>Destinatário:</strong> ${solicitacao.destinatario || 'Não enviado'}<br>
                            ${solicitacao.responsavelSolucao ? `<strong>Responsável pela solução:</strong> ${solicitacao.responsavelSolucao}<br>` : ''}
                        </small>
                    </div>
                `;
                
                document.getElementById('detalhesContent').innerHTML = detalhes;
                this.showModal('modalDetalhes');
            }
            
            marcarSolucionado(id) {
                this.currentSolicitacao = this.db.getSolicitacao(id);
                if (!this.currentSolicitacao) return;
                
                document.getElementById('solucaoAplicada').value = '';
                document.getElementById('dataSolucao').value = new Date().toISOString().split('T')[0];
                document.getElementById('responsavelSolucao').value = 'waldeci';
                
                this.showModal('modalSolucao');
            }
            
            confirmarSolucao() {
                const solucao = document.getElementById('solucaoAplicada').value;
                const responsavel = document.getElementById('responsavelSolucao').value;
                const dataSolucao = document.getElementById('dataSolucao').value;
                
                if (!solucao.trim()) {
                    this.showNotification('Por favor, descreva a solução aplicada.', 'warning');
                    return;
                }
                
                if (this.currentSolicitacao && this.currentSolicitacao.id) {
                    this.db.updateSolicitacao(this.currentSolicitacao.id, {
                        status: 'solucionado',
                        solucao: solucao,
                        responsavelSolucao: responsavel,
                        dataSolucao: dataSolucao
                    });
                    
                    this.showNotification('Solicitação marcada como solucionada!', 'success');
                    this.closeModal('modalSolucao');
                    this.updateStats();
                    this.carregarHistorico();
                }
            }
            
            editarSolicitacao(id) {
                const solicitacao = this.db.getSolicitacao(id);
                
                if (!solicitacao) return;
                
                this.currentSolicitacao = solicitacao;
                
                const posto = this.postos.find(p => p.id === solicitacao.posto.id);
                if (posto) {
                    document.getElementById('postoSearch').value = `${posto.nome} - ${posto.cidade}/${posto.estado}`;
                    document.getElementById('postoId').value = posto.id;
                }
                
                document.getElementById('mesReferencia').value = solicitacao.mesReferencia;
                document.getElementById('cfopProdac').value = solicitacao.cfopProdac || '';
                document.getElementById('cfopAutoSystem').value = solicitacao.cfopAutoSystem || '';
                document.getElementById('valorProdac').value = solicitacao.valorProdac || '';
                document.getElementById('valorAutoSystem').value = solicitacao.valorAutoSystem || '';
                document.getElementById('dadosComparacao').value = solicitacao.dadosComparacao || '';
                document.getElementById('descricao').value = solicitacao.descricao || '';
                
                const origemRadio = document.querySelector(`input[name="origemProblema"][value="${solicitacao.origemProblema}"]`);
                if (origemRadio) origemRadio.checked = true;
                
                this.switchTab('nova');
                
                this.showNotification('Solicitação carregada para edição!', 'info');
            }
            
            excluirSolicitacao(id) {
                if (confirm('Tem certeza que deseja excluir esta solicitação?')) {
                    this.db.deleteSolicitacao(id);
                    this.updateStats();
                    this.carregarHistorico();
                    this.showNotification('Solicitação excluída com sucesso!', 'success');
                }
            }
            
            carregarPostos() {
                const tbody = document.getElementById('tabelaCorpoPostos');
                if (!tbody) return;
                
                tbody.innerHTML = '';
                
                this.postos.forEach(posto => {
                    const hoje = new Date().toISOString().split('T')[0];
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${posto.nome}</td>
                        <td>${posto.cidade}/${posto.estado}</td>
                        <td>${posto.cnpj || '-'}</td>
                        <td>
                            <input type="month" value="${posto.verificacao.mesReferencia || new Date().getFullYear() + '-' + String(new Date().getMonth() + 1).padStart(2, '0')}" 
                                   onchange="app.atualizarMesPosto('${posto.id}', this.value)"
                                   style="width: 120px; padding: 6px;">
                        </td>
                        <td>
                            <select onchange="app.atualizarStatusPosto('${posto.id}', this.value)"
                                    style="padding: 6px; border-radius: 4px;">
                                <option value="pendente" ${posto.verificacao.status === 'pendente' ? 'selected' : ''}>Pendente</option>
                                <option value="verificado" ${posto.verificacao.status === 'verificado' ? 'selected' : ''}>Verificado</option>
                                <option value="copiado" ${posto.verificacao.status === 'copiado' ? 'selected' : ''}>Arquivo Copiado</option>
                            </select>
                        </td>
                        <td>${posto.verificacao.data ? new Date(posto.verificacao.data).toLocaleDateString('pt-BR') : '-'}</td>
                        <td>${posto.verificacao.responsavel || '-'}</td>
                        <td>
                            <button onclick="app.marcarVerificado('${posto.id}')" class="btn btn-success" style="padding: 6px 12px; font-size: 12px;">
                                <i class="fas fa-check"></i> Verificar
                            </button>
                            <button onclick="app.excluirPosto('${posto.id}')" class="btn btn-danger" style="padding: 6px 12px; font-size: 12px; margin-left: 5px;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });
            }
            
            atualizarMesPosto(postoId, mes) {
                this.db.updatePosto(postoId, {
                    verificacao: {
                        mesReferencia: mes
                    }
                });
            }
            
            atualizarStatusPosto(postoId, status) {
                this.db.updatePosto(postoId, {
                    verificacao: {
                        status: status,
                        data: new Date().toISOString(),
                        responsavel: 'Guilherme'
                    }
                });
                
                this.carregarPostos();
            }
            
            marcarVerificado(postoId) {
                this.db.updatePosto(postoId, {
                    verificacao: {
                        status: 'verificado',
                        data: new Date().toISOString(),
                        responsavel: 'Guilherme'
                    }
                });
                
                this.showNotification('Posto marcado como verificado!', 'success');
                this.carregarPostos();
            }
            
            marcarTodosVerificados() {
                if (confirm('Marcar todos os postos como verificados?')) {
                    this.postos.forEach(posto => {
                        this.db.updatePosto(posto.id, {
                            verificacao: {
                                status: 'verificado',
                                data: new Date().toISOString(),
                                responsavel: 'Guilherme'
                            }
                        });
                    });
                    
                    this.showNotification('Todos os postos marcados como verificados!', 'success');
                    this.carregarPostos();
                }
            }
            
            showModalAddPosto() {
                this.showModal('modalAddPosto');
            }
            
            adicionarNovoPosto() {
                const nome = document.getElementById('novoPostoNome').value;
                const cidade = document.getElementById('novoPostoCidade').value;
                const estado = document.getElementById('novoPostoEstado').value;
                const cnpj = document.getElementById('novoPostoCnpj').value;
                
                if (!nome || !cidade || !estado) {
                    this.showNotification('Por favor, preencha todos os campos obrigatórios.', 'warning');
                    return;
                }
                
                const novoPosto = this.db.addPosto({
                    nome: nome,
                    cidade: cidade,
                    estado: estado,
                    cnpj: cnpj
                });
                
                this.postos = this.db.getPostos();
                
                this.showNotification(`Posto "${nome}" adicionado com sucesso!`, 'success');
                this.closeModal('modalAddPosto');
                this.carregarPostos();
                
                document.getElementById('novoPostoNome').value = '';
                document.getElementById('novoPostoCidade').value = '';
                document.getElementById('novoPostoEstado').value = '';
                document.getElementById('novoPostoCnpj').value = '';
            }
            
            excluirPosto(postoId) {
                if (confirm('Tem certeza que deseja excluir este posto?')) {
                    const posto = this.db.getPosto(postoId);
                    if (posto) {
                        this.db.deletePosto(postoId);
                        this.postos = this.db.getPostos();
                        this.showNotification(`Posto "${posto.nome}" excluído!`, 'success');
                        this.carregarPostos();
                    }
                }
            }
            
            exportarControlePostos() {
                const postos = this.db.getPostos();
                const csv = this.convertPostosToCSV(postos);
                
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                link.setAttribute('href', url);
                link.setAttribute('download', `controle_postos_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                this.showNotification('Controle de postos exportado!', 'success');
            }
            
            convertPostosToCSV(postos) {
                const headers = ['Posto', 'Cidade', 'Estado', 'CNPJ', 'Status', 'Data Verificação', 'Responsável', 'Mês Referência'];
                
                const rows = postos.map(p => [
                    p.nome,
                    p.cidade,
                    p.estado,
                    p.cnpj || '',
                    p.verificacao.status === 'verificado' ? 'Verificado' : 
                    p.verificacao.status === 'copiado' ? 'Arquivo Copiado' : 'Pendente',
                    p.verificacao.data ? new Date(p.verificacao.data).toLocaleDateString('pt-BR') : '',
                    p.verificacao.responsavel || '',
                    p.verificacao.mesReferencia || ''
                ]);
                
                return [headers, ...rows].map(row => row.join(';')).join('\n');
            }
            
            initCharts() {
                this.initChartStatus();
                this.initChartEmails();
                this.initChartEvolucao();
                this.initChartProblemas();
            }
            
            initChartStatus() {
                const ctx = document.getElementById('chartStatus');
                if (!ctx) return;
                
                const stats = this.db.getStats();
                
                if (this.charts.status) {
                    this.charts.status.destroy();
                }
                
                this.charts.status = new Chart(ctx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Em Aberto', 'Enviados', 'Solucionados'],
                        datasets: [{
                            data: [stats.aberto, stats.enviado, stats.solucionado],
                            backgroundColor: ['#ff9800', '#2196f3', '#4caf50'],
                            borderWidth: 2,
                            borderColor: 'white'
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
            
            initChartEmails() {
                const ctx = document.getElementById('chartEmails');
                if (!ctx) return;
                
                const solicitacoes = this.db.getSolicitacoes();
                
                const emailsPorMes = {};
                solicitacoes.filter(s => s.dataEnvio).forEach(s => {
                    const mes = s.dataEnvio.substring(0, 7);
                    if (!emailsPorMes[mes]) emailsPorMes[mes] = 0;
                    emailsPorMes[mes]++;
                });
                
                const meses = Object.keys(emailsPorMes).sort();
                const ultimosMeses = meses.slice(-6);
                
                if (this.charts.emails) {
                    this.charts.emails.destroy();
                }
                
                this.charts.emails = new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ultimosMeses.map(m => `${m.split('-')[1]}/${m.split('-')[0]}`),
                        datasets: [{
                            label: 'Emails Enviados',
                            data: ultimosMeses.map(m => emailsPorMes[m] || 0),
                            backgroundColor: 'rgba(33, 150, 243, 0.7)',
                            borderColor: '#2196f3',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        }
                    }
                });
            }
            
            initChartEvolucao() {
                const ctx = document.getElementById('chartEvolucao');
                if (!ctx) return;
                
                const solicitacoes = this.db.getSolicitacoes();
                
                const dados = [];
                const hoje = new Date();
                
                for (let i = 11; i >= 0; i--) {
                    const data = new Date(hoje);
                    data.setMonth(data.getMonth() - i);
                    const mes = `${data.getFullYear()}-${String(data.getMonth() + 1).padStart(2, '0')}`;
                    
                    const aberto = solicitacoes.filter(s => 
                        s.dataCriacao.substring(0, 7) === mes && s.status === 'aberto'
                    ).length;
                    
                    const enviado = solicitacoes.filter(s => 
                        s.dataEnvio && s.dataEnvio.substring(0, 7) === mes
                    ).length;
                    
                    const solucionado = solicitacoes.filter(s => 
                        s.dataSolucao && s.dataSolucao.substring(0, 7) === mes
                    ).length;
                    
                    dados.push({
                        mes: `${String(data.getMonth() + 1).padStart(2, '0')}/${data.getFullYear()}`,
                        aberto,
                        enviado,
                        solucionado
                    });
                }
                
                if (this.charts.evolucao) {
                    this.charts.evolucao.destroy();
                }
                
                this.charts.evolucao = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: dados.map(d => d.mes),
                        datasets: [
                            {
                                label: 'Em Aberto',
                                data: dados.map(d => d.aberto),
                                borderColor: '#ff9800',
                                backgroundColor: 'rgba(255, 152, 0, 0.1)',
                                fill: true,
                                tension: 0.4
                            },
                            {
                                label: 'Enviados',
                                data: dados.map(d => d.enviado),
                                borderColor: '#2196f3',
                                backgroundColor: 'rgba(33, 150, 243, 0.1)',
                                fill: true,
                                tension: 0.4
                            },
                            {
                                label: 'Solucionados',
                                data: dados.map(d => d.solucionado),
                                borderColor: '#4caf50',
                                backgroundColor: 'rgba(76, 175, 80, 0.1)',
                                fill: true,
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        interaction: {
                            mode: 'index',
                            intersect: false
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
            
            initChartProblemas() {
                const ctx = document.getElementById('chartProblemas');
                if (!ctx) return;
                
                const solicitacoes = this.db.getSolicitacoes();
                
                const problemas = {
                    prodac: solicitacoes.filter(s => s.origemProblema === 'prodac').length,
                    autosystem: solicitacoes.filter(s => s.origemProblema === 'autosystem').length
                };
                
                if (this.charts.problemas) {
                    this.charts.problemas.destroy();
                }
                
                this.charts.problemas = new Chart(ctx.getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: ['Prodac', 'AutoSystem'],
                        datasets: [{
                            data: [problemas.prodac, problemas.autosystem],
                            backgroundColor: ['#2196f3', '#4caf50'],
                            borderWidth: 2,
                            borderColor: 'white'
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
            
            atualizarGraficos() {
                this.initChartStatus();
                this.initChartEmails();
                this.initChartEvolucao();
                this.initChartProblemas();
            }
            
            filtrarHistorico() {
                this.showNotification('Use os filtros na tabela para visualizar dados específicos.', 'info');
            }
            
            exportarDados() {
                const solicitacoes = this.db.getSolicitacoes();
                const csv = this.convertToCSV(solicitacoes);
                
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                link.setAttribute('href', url);
                link.setAttribute('download', `solicitacoes_cfop_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                this.showNotification('Dados exportados com sucesso!', 'success');
            }
            
            convertToCSV(solicitacoes) {
                const headers = ['ID', 'Data Criação', 'Posto', 'Cidade', 'Estado', 'Mês/Ano', 'Origem', 'Status', 'Destinatário', 'Data Envio', 'Data Solução', 'Descrição'];
                
                const rows = solicitacoes.map(s => {
                    const [year, month] = s.mesReferencia.split('-');
                    const mesAno = `${month}/${year}`;
                    
                    return [
                        s.id,
                        new Date(s.dataCriacao).toLocaleDateString('pt-BR'),
                        s.posto.nome,
                        s.posto.cidade,
                        s.posto.estado,
                        mesAno,
                        s.origemProblema === 'prodac' ? 'Prodac' : 'AutoSystem',
                        this.getStatusText(s.status),
                        s.destinatario ? (s.destinatario.includes('juliana') ? 'Juliana' : 'Prodac') : '',
                        s.dataEnvio ? new Date(s.dataEnvio).toLocaleDateString('pt-BR') : '',
                        s.dataSolucao ? new Date(s.dataSolucao).toLocaleDateString('pt-BR') : '',
                        s.descricao ? s.descricao.replace(/;/g, ',') : ''
                    ];
                });
                
                return [headers, ...rows].map(row => row.join(';')).join('\n');
            }
            
            criarBackup() {
                const backupData = this.db.exportBackup();
                const blob = new Blob([backupData], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `backup_cfop_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                URL.revokeObjectURL(url);
                
                this.showNotification('Backup completo criado com sucesso!', 'success');
                this.updateSpaceInfo();
            }
            
            restaurarBackup() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    
                    reader.onload = (event) => {
                        if (confirm('ATENÇÃO: Esta ação irá substituir todos os dados atuais. Deseja continuar?')) {
                            this.showLoading(true);
                            setTimeout(() => {
                                if (this.db.importBackup(event.target.result)) {
                                    this.showNotification('Backup restaurado com sucesso! O sistema será recarregado.', 'success');
                                    setTimeout(() => location.reload(), 2000);
                                } else {
                                    this.showNotification('Erro ao restaurar backup. O arquivo pode estar corrompido.', 'error');
                                }
                                this.showLoading(false);
                            }, 1000);
                        }
                    };
                    
                    reader.readAsText(file);
                };
                
                input.click();
            }
            
            gerarRelatorio() {
                const periodo = document.getElementById('relatorioPeriodo').value;
                const status = document.getElementById('relatorioStatus').value;
                const origem = document.getElementById('relatorioOrigem').value;
                
                let dataInicial, dataFinal;
                
                if (periodo === 'custom') {
                    const dataInicialInput = document.getElementById('dataInicial').value;
                    const dataFinalInput = document.getElementById('dataFinal').value;
                    
                    if (!dataInicialInput || !dataFinalInput) {
                        this.showNotification('Por favor, preencha ambas as datas para o período personalizado.', 'warning');
                        return;
                    }
                    
                    dataInicial = new Date(dataInicialInput);
                    dataFinal = new Date(dataFinalInput);
                } else {
                    dataFinal = new Date();
                    dataInicial = new Date();
                    dataInicial.setDate(dataInicial.getDate() - parseInt(periodo));
                }
                
                const solicitacoes = this.db.getSolicitacoes();
                const filtered = solicitacoes.filter(s => {
                    const dataSolicitacao = new Date(s.dataCriacao);
                    
                    if (dataInicial && dataSolicitacao < dataInicial) return false;
                    if (dataFinal && dataSolicitacao > dataFinal) return false;
                    
                    if (status !== 'todos' && s.status !== status) return false;
                    if (origem !== 'todos' && s.origemProblema !== origem) return false;
                    
                    return true;
                });
                
                this.exibirRelatorio(filtered, dataInicial, dataFinal);
            }
            
            gerarRelatorioEmAberto() {
                const solicitacoes = this.db.getSolicitacoes();
                const filtered = solicitacoes.filter(s => s.status === 'aberto');
                
                this.exibirRelatorio(filtered, null, null, 'Relatório de Solicitações em Aberto');
            }
            
            gerarRelatorioSolucionados() {
                const solicitacoes = this.db.getSolicitacoes();
                const filtered = solicitacoes.filter(s => s.status === 'solucionado');
                
                this.exibirRelatorio(filtered, null, null, 'Relatório de Solicitações Solucionadas');
            }
            
            gerarRelatorioProdac() {
                const solicitacoes = this.db.getSolicitacoes();
                const filtered = solicitacoes.filter(s => 
                    s.origemProblema === 'prodac' && s.status !== 'solucionado'
                );
                
                this.exibirRelatorio(filtered, null, null, 'Relatório para Prodac - Problemas Pendentes');
            }
            
            gerarRelatorioJuliana() {
                const solicitacoes = this.db.getSolicitacoes();
                const filtered = solicitacoes.filter(s => 
                    s.origemProblema === 'autosystem' && s.status !== 'solucionado'
                );
                
                this.exibirRelatorio(filtered, null, null, 'Relatório para Juliana - Problemas Pendentes');
            }
            
            exibirRelatorio(solicitacoes, dataInicial, dataFinal, titulo = 'Relatório') {
                const tbody = document.getElementById('corpoRelatorio');
                if (!tbody) return;
                
                tbody.innerHTML = '';
                
                solicitacoes.forEach(s => {
                    const [year, month] = s.mesReferencia.split('-');
                    const mesAno = `${month}/${year}`;
                    
                    const dataCriacao = new Date(s.dataCriacao).toLocaleDateString('pt-BR');
                    const dataEnvio = s.dataEnvio ? new Date(s.dataEnvio).toLocaleDateString('pt-BR') : '-';
                    const dataSolucao = s.dataSolucao ? new Date(s.dataSolucao).toLocaleDateString('pt-BR') : '-';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${s.id}</td>
                        <td>${dataCriacao}</td>
                        <td>${s.posto.nome}</td>
                        <td>${mesAno}</td>
                        <td>${s.origemProblema === 'prodac' ? 'Prodac' : 'AutoSystem'}</td>
                        <td><span class="status-badge status-${s.status}">
                            ${this.getStatusText(s.status)}
                        </span></td>
                        <td>${s.destinatario ? (s.destinatario.includes('juliana') ? 'Juliana' : 'Prodac') : '-'}</td>
                        <td>${dataEnvio}</td>
                        <td>${dataSolucao}</td>
                    `;
                    
                    tbody.appendChild(row);
                });
                
                const relatorioResultado = document.getElementById('relatorioResultado');
                if (relatorioResultado) {
                    relatorioResultado.style.display = 'block';
                }
                
                let periodoTexto = titulo;
                if (dataInicial && dataFinal) {
                    periodoTexto += ` - ${dataInicial.toLocaleDateString('pt-BR')} a ${dataFinal.toLocaleDateString('pt-BR')}`;
                }
                
                const tituloElement = document.querySelector('#tab-relatorios h3');
                if (tituloElement) {
                    tituloElement.innerHTML = `<i class="fas fa-chart-line"></i> ${periodoTexto}`;
                }
            }
            
            imprimirRelatorio() {
                const tabelaRelatorio = document.getElementById('tabelaRelatorio');
                if (!tabelaRelatorio) return;
                
                const printContent = tabelaRelatorio.outerHTML;
                const originalContent = document.body.innerHTML;
                
                document.body.innerHTML = `
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
                        th { background: #1a237e; color: white; padding: 12px; text-align: left; }
                        td { padding: 12px; border-bottom: 1px solid #ddd; }
                        .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 11px; }
                        .status-aberto { background: #fff3e0; color: #e65100; }
                        .status-enviado { background: #e3f2fd; color: #0d47a1; }
                        .status-solucionado { background: #e8f5e9; color: #1b5e20; }
                    </style>
                    <h2>Relatório de Solicitações CFOP</h2>
                    <p>Data: ${new Date().toLocaleDateString('pt-BR')}</p>
                    ${printContent}
                `;
                
                window.print();
                document.body.innerHTML = originalContent;
                location.reload();
            }
            
            carregarConfiguracoes() {
                document.getElementById('configEmailJuliana').value = this.config.emailJuliana;
                document.getElementById('configEmailProdac').value = this.config.emailProdac;
                document.getElementById('configAssuntoPadrao').value = this.config.assuntoPadrao;
                document.getElementById('configNotificacoes').checked = this.config.notificacoes;
                document.getElementById('configRetencaoDados').value = this.config.retencaoDados;
                document.getElementById('configFormatoExportacao').value = this.config.formatoExportacao;
                
                if (this.config.ultimoBackup) {
                    document.getElementById('ultimoBackup').textContent = new Date(this.config.ultimoBackup).toLocaleString('pt-BR');
                }
            }
            
            salvarConfig() {
                const novasConfigs = {
                    emailJuliana: document.getElementById('configEmailJuliana').value,
                    emailProdac: document.getElementById('configEmailProdac').value,
                    assuntoPadrao: document.getElementById('configAssuntoPadrao').value,
                    notificacoes: document.getElementById('configNotificacoes').checked,
                    retencaoDados: parseInt(document.getElementById('configRetencaoDados').value),
                    formatoExportacao: document.getElementById('configFormatoExportacao').value
                };
                
                this.db.updateConfig(novasConfigs);
                this.config = this.db.getConfig();
                
                this.showNotification('Configurações salvas com sucesso!', 'success');
            }
            
            limparDadosAntigos() {
                const dias = this.config.retencaoDados;
                if (confirm(`Deseja limpar dados de solicitações solucionadas com mais de ${dias} dias?`)) {
                    const removidos = this.db.clearOldData(dias);
                    this.showNotification(`${removidos} solicitações antigas foram removidas.`, 'success');
                    this.updateStats();
                    this.carregarHistorico();
                    this.updateSpaceInfo();
                }
            }
            
            limparTotal() {
                if (confirm('ATENÇÃO: Esta ação irá REMOVER TODOS OS DADOS do sistema, incluindo solicitações, postos e configurações. O sistema será reiniciado. Deseja continuar?')) {
                    this.showLoading(true);
                    setTimeout(() => {
                        this.db.resetDatabase();
                        this.showNotification('Todos os dados foram removidos. O sistema será reiniciado.', 'success');
                        setTimeout(() => {
                            location.reload();
                        }, 2000);
                        this.showLoading(false);
                    }, 1000);
                }
            }
            
            updateStats() {
                const stats = this.db.getStats();
                
                document.getElementById('statsHoje').textContent = stats.hoje;
                document.getElementById('statsAberto').textContent = stats.aberto;
                document.getElementById('statsEnviado').textContent = stats.enviado;
                document.getElementById('statsSolucionado').textContent = stats.solucionado;
                
                this.atualizarGraficos();
            }
            
            updateSpaceInfo() {
                let totalSize = 0;
                
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    const value = localStorage.getItem(key);
                    totalSize += key.length + (value ? value.length : 0);
                }
                
                const sizeInKB = (totalSize / 1024).toFixed(2);
                document.getElementById('espacoUtilizado').textContent = `${sizeInKB} KB`;
                
                const solicitacoes = this.db.getSolicitacoes();
                document.getElementById('totalSolicitacoes').textContent = solicitacoes.length;
            }
            
            updateTime() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('pt-BR');
                const dateString = now.toLocaleDateString('pt-BR', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                
                const timeDisplay = document.getElementById('timeDisplay');
                if (timeDisplay) {
                    timeDisplay.innerHTML = `<i class="far fa-clock"></i> ${dateString} - ${timeString}`;
                }
            }
            
            showNotification(message, type = 'info') {
                const notification = document.getElementById('notification');
                if (!notification) return;
                
                notification.textContent = message;
                notification.className = `notification ${type} show`;
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
            
            showLoading(show) {
                const loading = document.getElementById('loading');
                if (!loading) return;
                
                loading.classList.toggle('show', show);
            }
            
            showModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.add('show');
                }
            }
            
            closeModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.remove('show');
                }
            }
        }

        // Inicializar a aplicação
        const app = new CFOPApp();
        window.app = app;
    </script>
</body>
</html>