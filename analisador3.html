



<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Vendas por Forma de Pagamento</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    margin: 0;
    padding: 10px;
    font-family: 'Inter', sans-serif;
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
}

.dashboard-container {
    max-width: 99% !important;
    margin: 0 auto;
    padding: 8px;
}

.table-container {
    width: 100%;
    overflow-x: auto;
}

.modern-table {
    width: 100%;
    table-layout: auto;
}

.header-gradient {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px 20px 0 0;
    position: relative;
    overflow: hidden;
}

/* Efeito de brilho deslizante no header */
.header-gradient::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
    animation: shine 3s infinite;
}

@keyframes shine {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

.logo-container {
    width: 60px;
    height: 60px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    position: relative;
    overflow: hidden;
}

/* Efeito de rotação no logo container */
.logo-container::after {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: conic-gradient(transparent, rgba(255,255,255,0.3), transparent);
    animation: rotate 4s linear infinite;
}

@keyframes rotate {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.logo-circle {
    position: absolute;
    top: -10px;
    right: 30px;
    width: 100px;
    height: 100px;
    background: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
    border: 4px solid rgba(255, 255, 255, 0.9);
    z-index: 10;
    transition: all 0.3s ease;
    animation: float 3s ease-in-out infinite;
}

/* Efeito de flutuação no logo */
@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
}

.logo-circle:hover {
    transform: scale(1.1) translateY(-5px);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
}

.logo-circle img {
    width: 60px;
    height: 60px;
}

.stat-card {
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    border-radius: 16px;
    padding: 24px;
    box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.8);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px -3px rgba(0, 0, 0, 0.15);
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #667eea, #764ba2);
    border-radius: 16px 16px 0 0;
}

.action-button {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    border-radius: 12px;
    color: white;
    padding: 12px 24px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    display: flex;
    align-items: center;
    gap: 8px;
    position: relative;
    overflow: hidden;
}

/* Efeito de onda nos botões */
.action-button::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    transition: all 0.3s ease;
    transform: translate(-50%, -50%);
}

.action-button:hover::before {
    width: 300px;
    height: 300px;
}

.action-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
}

.action-button.secondary {
    background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
    box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
}

.action-button.secondary:hover {
    box-shadow: 0 8px 25px rgba(139, 92, 246, 0.6);
}

.action-button.danger {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
}

.action-button.danger:hover {
    box-shadow: 0 8px 25px rgba(239, 68, 68, 0.6);
}

.action-button.fleet {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
}

.action-button.fleet:hover {
    box-shadow: 0 8px 25px rgba(245, 158, 11, 0.6);
}

.action-button.scroll-nav {
    padding: 10px;
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    border-radius: 50%;
}

.file-input {
    position: relative;
    overflow: hidden;
    display: inline-block;
    cursor: pointer;
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    border: 2px dashed #cbd5e1;
    border-radius: 16px;
    padding: 32px;
    text-align: center;
    transition: all 0.3s ease;
    width: 100%;
}

.file-input:hover {
    border-color: #667eea;
    background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
    transform: scale(1.02);
}

.file-input input[type=file] {
    position: absolute;
    left: -9999px;
}

.table-container {
    background: white;
    border-radius: 16px;
    box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.8);
    overflow: hidden;
}

.modern-table {
    width: 100%;
    border-collapse: collapse;
}

.modern-table th {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 16px;
    text-align: left;
    font-weight: 600;
    font-size: 14px;
    letter-spacing: 0.5px;
}

.modern-table td {
    padding: 16px;
    border-bottom: 1px solid #f1f5f9;
    transition: all 0.3s ease;
    text-align: left !important;
}

.modern-table tr:hover td {
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
}

.chart-container {
    background: white;
    border-radius: 16px;
    box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.8);
    position: relative;
}

.chart-3d {
    background: radial-gradient(circle at 50% 50%, #f8fafc 0%, #e2e8f0 100%);
    border-radius: 16px;
    padding: 24px;
}

.company-count-card {
    max-width: 180px;
    padding: 10px;
    margin-left: 0;
    text-align: center;
}

.icon-gradient {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.glassmorphism {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 16px;
}

.checkbox-grid {
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    gap: 16px;
    margin-bottom: 16px;
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    color: #374151;
    cursor: pointer;
}

.checkbox-label input[type="checkbox"] {
    appearance: none;
    width: 20px;
    height: 20px;
    border: 2px solid #cbd5e1;
    border-radius: 4px;
    transition: all 0.3s ease;
}

.checkbox-label input[type="checkbox"]:checked {
    border-color: #667eea;
    background-color: #667eea;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3E%3C/svg%3E");
}

.checkbox-label input[type="checkbox"]:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.search-input {
    background: white;
    border: 1px solid #cbd5e1;
    border-radius: 12px;
    padding: 12px;
    width: 100%;
    max-width: 300px;
    font-size: 14px;
    transition: all 0.3s ease;
}

.search-input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.loading-spinner {
    border: 4px solid #f3f4f6;
    border-top: 4px solid #667eea;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
    margin: 20px auto;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.success-message {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    padding: 12px 24px;
    border-radius: 12px;
    margin: 16px 0;
    display: flex;
    align-items: center;
    gap: 8px;
    animation: slideIn 0.3s ease;
}

.print-values {
    display: none;
}

@keyframes slideIn {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
}

.hidden-column {
    display: none;
}

/* Novos efeitos adicionados */
.pulse-animation {
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

.glow-effect {
    position: relative;
}

.glow-effect::after {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: linear-gradient(45deg, #667eea, #764ba2, #667eea);
    border-radius: inherit;
    z-index: -1;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.glow-effect:hover::after {
    opacity: 1;
}

.icon-bounce {
    animation: bounce 1s infinite;
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
    40% { transform: translateY(-10px); }
    60% { transform: translateY(-5px); }
}

.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    padding: 16px 24px;
    border-radius: 12px;
    box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
    z-index: 1000;
    animation: slideInRight 0.3s ease;
}

@keyframes slideInRight {
    from { opacity: 0; transform: translateX(100%); }
    to { opacity: 1; transform: translateX(0); }
}

/* Efeito de neon para botões especiais */
.neon-effect {
    position: relative;
    text-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
}

.neon-effect::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: inherit;
    border-radius: inherit;
    filter: blur(8px);
    opacity: 0.7;
    z-index: -1;
}

/* Efeito de gradiente animado */
.gradient-animation {
    background: linear-gradient(45deg, #667eea, #764ba2, #667eea);
    background-size: 400% 400%;
    animation: gradientMove 3s ease infinite;
}

@keyframes gradientMove {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

/* Efeito de ondulação */
.ripple-effect {
    position: relative;
    overflow: hidden;
}

.ripple-effect::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width 0.3s ease, height 0.3s ease;
}

.ripple-effect:hover::after {
    width: 200px;
    height: 200px;
}

/* Efeito de cristal */
.crystal-effect {
    background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
    box-shadow: 0 8px 32px rgba(0,0,0,0.1);
}

/* Efeito de sombra dinâmica */
.dynamic-shadow {
    transition: box-shadow 0.3s ease;
}

.dynamic-shadow:hover {
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
}

/* Estilo para o popup */
#salesPopup {
    z-index: 1000;
    transition: opacity 0.3s ease;
}

#salesPopup .bg-white {
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    border: 1px solid rgba(255, 255, 255, 0.8);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    max-height: 80vh;
    overflow-y: auto;
}

#salesPopup input:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

#salesPopup ul {
    max-height: 200px;
    overflow-y: auto;
}

#salesPopup ul li {
    margin-bottom: 8px;
}

.popup-selected-volume {
    display: flex;
    align-items: center;
    gap: 8px;
}

/* Media queries para impressão */
@media print {
    @page {
        size: landscape;
        margin: 0;
    }

    body {
        background: white;
        padding: 0;
        margin: 0;
        font-size: 10pt;
    }

    .no-print {
        display: none !important;
    }

    .dashboard-container {
        max-width: 100% !important;
        padding: 0 !important;
    }

    .header-gradient {
        border-radius: 0;
        padding: 10mm !important;
        position: relative;
        margin-bottom: 10mm;
    }

    .chart-container {
        page-break-inside: avoid;
        display: flex !important;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        padding: 10mm !important;
        box-shadow: none;
        border: none;
    }

    #salesChart {
        width: 60% !important;
        height: auto !important;
    }

    .print-values {
        display: block !important;
        background: #f8fafc;
        border-radius: 8px;
        padding: 5mm !important;
        margin-left: 5mm !important;
        min-width: 80mm !important;
    }

    .print-values ul {
        list-style: none;
        margin: 0;
        padding: 0;
    }

    .print-values li {
        margin-bottom: 6px !important;
        font-size: 8pt !important;
        display: block;
        text-align: left !important;
    }

    .print-values strong {
        font-weight: 600;
    }

    .table-container {
        page-break-before: always;
        page-break-inside: avoid;
        box-shadow: none;
        border: none;
        margin-top: 10mm;
    }

    .modern-table {
        width: 100%;
        font-size: 8pt;
    }

    .modern-table th,
    .modern-table td {
        text-align: center !important;
        padding: 16px;
        border-bottom: 1px solid #f1f5f9;
        transition: all 0.3s ease;
    }

    .modern-table th:first-child,
    .modern-table td:first-child {
        text-align: left !important;
    }

    .company-count-card {
        max-width: 45mm !important;
        padding: 2mm !important;
        margin-bottom: 2mm !important;
        margin-left: 0 !important;
        margin-right: auto !important;
        text-align: center !important;
    }

    .print-header {
        position: running(header);
        text-align: center;
        font-size: 12pt;
        font-weight: bold;
        margin-bottom: 5mm;
    }

    .print-footer {
        position: running(footer);
        text-align: center;
        font-size: 8pt;
        color: #666;
        border-top: 1px solid #ccc;
        padding-top: 5mm;
    }

    @page {
        @top-center {
            content: element(header);
        }
        @bottom-center {
            content: element(footer);
        }
    }
}
/* Estilo para a imagem Pedrinho no cabeçalho */
.header-image {
    width: 122px;
    height: 198px;
    border-radius: 12px;
    object-fit: cover;
    border: 2px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    transition: all 0.0s ease;
}

.header-image:hover {
    transform: scale(1.1);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
}
    </style>
</head>
<body>
    
    <div class="max-w-7xl mx-auto dashboard-container">

     <!-- Header com Logo e Imagem Pedrinho -->
<div class="header-gradient p-8">
    <div class="logo-circle">
        <img src="https://api.platform-production.ensun.io/file/external-company-logo/67aa3fb5fe46411a0b728dd1" alt="Logo">
    </div>
    <div class="flex items-center justify-between">
        <div class="flex items-center gap-6">
            <img src="pedrinho.png" alt="Pedrinho" class="header-image">
            <div class="logo-container">
                <i class="fas fa-chart-pie text-white text-2xl"></i>
            </div>
            <div>
                <h1 class="text-3xl font-bold text-white">Dashboard de Vendas Rede Dom Pedro</h1>
                <p class="text-white/80 mt-2">Análise de Formas de Pagamento</p>
            </div>
        </div>
    </div>
    <!-- Botões de ação -->
    <div class="flex items-center gap-4 no-print">
        <button id="printButton" class="action-button" onclick="window.print()">
            <i class="fas fa-print"></i>
            Imprimir
        </button>
        <button id="showPopupButton" class="action-button secondary">
            <i class="fas fa-info-circle"></i>
            Detalhes de Vendas
        </button>
        <button id="exportCSV" class="action-button secondary">
            <i class="fas fa-download"></i>
            Exportar CSV
        </button>
        <button id="clearData" class="action-button danger">
            <i class="fas fa-trash"></i>
            Limpar
        </button>
    </div>
</div>

<!-- Popup -->
<div id="salesPopup" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden no-print">
    <div class="bg-white rounded-lg p-6 w-full max-w-md shadow-lg">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold text-gray-900">Detalhes de Vendas</h2>
            <button id="closePopupButton" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="mb-4">
            <p class="text-sm font-medium text-gray-600">Total de Vendas</p>
            <p class="text-2xl font-bold text-gray-900" id="popupTotalSales">R$ 0,00</p>
        </div>
        <div class="mb-4">
            <label for="volumeInput" class="text-sm font-medium text-gray-600 block">Total de Volume de Vendas</label>
            <input type="number" id="volumeInput" class="search-input w-full" placeholder="Digite o valor" step="0.01">
        </div>
        <div class="mb-4">
            <p class="text-sm font-medium text-gray-600">Porcentagem de Vendas</p>
            <p class="text-2xl font-bold text-gray-900" id="popupSalesPercentage">0.00%</p>
        </div>
        <div class="mb-4">
            <p class="text-sm font-medium text-gray-600">Índice dos Selecionados</p>
            <p class="text-2xl font-bold text-gray-900" id="popupSelectedIndex">0.00%</p>
            <p class="text-xs text-gray-500" id="popupSelectedTotal">R$ 0,00 de R$ 0,00</p>
        </div>
        <div>
            <p class="text-sm font-medium text-gray-600 mb-2">Métodos Selecionados</p>
            <ul id="popupSelectedMethods" class="list-disc pl-5 text-sm text-gray-700"></ul>
        </div>
    </div>
</div>

<!-- Botões de navegação -->
<div class="fixed right-4 top-1/2 transform -translate-y-1/2 flex flex-col gap-2 no-print">
    <button id="scrollToTop" class="action-button" title="Vai para o Topo">
        <i class="fas fa-arrow-up"></i>
    </button>
    <button id="scrollToBottom" class="action-button" title="Vai para o Fim">
        <i class="fas fa-arrow-down"></i>
    </button>
</div>
       <!-- Upload de Arquivos -->
<div class="p-4 no-print">
    <div class="file-input" id="fileInputArea">
        <input type="file" id="fileInput" multiple accept=".pdf">
        <div class="text-center">
            <i class="fas fa-cloud-upload-alt text-2xl icon-gradient mb-2"></i>
            <p class="text-base font-semibold text-gray-700">Arraste ou clique para selecionar PDFs</p>
            <p class="text-xs text-gray-500 mt-1">Suporta múltiplos arquivos</p>
        </div>
    </div>
    <div id="loadingSpinner" class="loading-spinner" style="display: none;"></div>
    <div id="successMessage" class="success-message" style="display: none;"></div>
</div>

        <!-- Cards de Estatísticas -->
        <div class="px-8 pb-8 no-print" id="statsContainer">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6" id="statsCards"></div>
        </div>

        <!-- Gráfico -->
        <div class="px-8 pb-8">
            <div class="chart-container chart-3d">
                <canvas id="salesChart" class="w-full h-96"></canvas>
                <div class="print-values" id="printValues"></div>
            </div>
        </div>

        <!-- Filtros e Busca -->
        <div class="px-8 pb-4 no-print">
            <div class="flex flex-col gap-4">
                <input type="text" id="searchInput" class="search-input" placeholder="Buscar por empresa...">
               <div class="flex gap-2">
    <button id="uncheckAll" class="action-button secondary" onclick="uncheckAllCheckboxes()">
        Desmarcar Todos
    </button>
    <button id="selectAll" class="action-button secondary" onclick="selectAllCheckboxes()">
        <i class="fas fa-check-double"></i>
        Selecionar Todos
    </button>
    <button id="sortAsc" class="action-button secondary">
        <i class="fas fa-sort-amount-up"></i>
        % Crescente
    </button>
    <button id="sortDesc" class="action-button secondary">
        <i class="fas fa-sort-amount-down"></i>
        % Decrescente
    </button>
                    <button id="selectCredit" class="action-button secondary" onclick="selectCreditCheckboxes()">
                        <i class="fas fa-credit-card"></i>
                        Selecionar Crédito
                    </button>
                    <button id="selectDebit" class="action-button secondary" onclick="selectDebitCheckboxes()">
                        <i class="fas fa-money-check-alt"></i>
                        Selecionar Débito
                    </button>
                    <button id="selectFleet" class="action-button fleet" onclick="selectFleetCheckboxes()">
                        <i class="fas fa-truck"></i>
                        Cartão Frotas
                    </button>
                </div>


                <div class="checkbox-grid">
                    <label class="checkbox-label">
                        <input type="checkbox" id="cashCheckbox" value="cash">
                        Dinheiro
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="creditNotesCheckbox" value="creditNotes">
                        Notas a Prazo
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="preDatedCheckbox" value="preDated">
                        Cheque Pré-Datado
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="onSightCheckbox" value="onSight">
                        Cheque À Vista
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="tefTicketCheckbox" value="tefTicket">
                        TEF - Ticket Log
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="redeFrotaCheckbox" value="redeFrota">
                        Rede Frota Crédito
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="tefMasterCheckbox" value="tefMaster">
                        TEF - Mastercard
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="pixStoneCheckbox" value="pixStone">
                        PIX (Stone)
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="proFrotasCheckbox" value="proFrotas">
                        Pro Frotas
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="tefVisaCheckbox" value="tefVisa">
                        TEF - Visa Electron
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="tefMasterMaestrCheckbox" value="tefMasterMaestr">
                        TEF - Master Maestr
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="ctfCheckbox" value="ctf">
                        CTF
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="tefTruckPagCheckbox" value="tefTruckPag">
                        TEF - Truck Pag
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="tefVisaCrediCheckbox" value="tefVisaCredi">
                        TEF - Visa Credi
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="qrLinxPixCheckbox" value="qrLinxPix">
                        QR Linx - PIX
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="tefAleloAutoCheckbox" value="tefAleloAuto">
                        TEF - Alelo Auto
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="tefCtfTefCheckbox" value="tefCtfTef">
                        TEF - CTF TEF
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="truckPagAbasteCheckbox" value="truckPagAbaste">
                        Truck Pag Abaste
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="tefValeCardCheckbox" value="tefValeCard">
                        TEF - Vale Card
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="tefEloDebitoCheckbox" value="tefEloDebito">
                        TEF - Elo Débito
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="tefEloCreditCheckbox" value="tefEloCredit">
                        TEF - Elo Crédito
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="visaDebitoCheckbox" value="visaDebito">
                        Visa Débito
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="targetPayCheckbox" value="targetPay">
                        Target Pay
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="cartaFreteCheckbox" value="cartaFrete">
                        Carta Frete
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="visaCreditoCheckbox" value="visaCredito">
                        Visa Crédito
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="masterCardCredCheckbox" value="masterCardCred">
                        MasterCard Crédito
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="tefVisaElectronLioCheckbox" value="tefVisaElectronLio">
                        TEF - Visa Electron Lio
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="redeSempreCheckbox" value="redeSempre">
                        Rede Sempre
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="repomAbasteciCheckbox" value="repomAbasteci">
                        Repom Abasteci
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="tefMaxiFrotaCheckbox" value="tefMaxiFrota">
                        TEF - Maxi Frota
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="tefSodexoWizCheckbox" value="tefSodexoWiz">
                        TEF - Sodexo Wiz
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="novoAbasteceAiCheckbox" value="novoAbasteceAi">
                        Novo Abastece AI
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="masterCardDebiCheckbox" value="masterCardDebi">
                        MasterCard Débito
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="tefSouthAmerCheckbox" value="tefSouthAmer">
                        TEF - South Amer
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="eFreteCheckbox" value="eFrete">
                        E-Frete
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="tefAmericanECheckbox" value="tefAmericanE">
                        TEF - American E
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="ticketLogCheckbox" value="ticketLog">
                        Ticket Log
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="fleetcardCreditoCheckbox" value="fleetcardCredito">
                        Fleetcard Crédito
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="tefFitcardCrCheckbox" value="tefFitcardCr">
                        TEF - Fitcard Cr
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="southAmericaCheckbox" value="southAmerica">
                        South America
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="tefSenffCardCheckbox" value="tefSenffCard">
                        TEF - Senff Card
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="eloDebitoCheckbox" value="eloDebito">
                        Elo Débito
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="eloCreditoCheckbox" value="eloCredito">
                        Elo Crédito
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="pamcardFrotaCheckbox" value="pamcardFrota">
                        Pamcard Frota +
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="x7BankCheckbox" value="x7Bank">
                        X7 Bank
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="tefFlexFrotaCheckbox" value="tefFlexFrota">
                        TEF - Flex Frota
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="aleloAutoCrediCheckbox" value="aleloAutoCredi">
                        Alelo Auto Credi
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="fitcardCreditoCheckbox" value="fitcardCredito">
                        Fitcard Crédito
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="repomSaqueCheckbox" value="repomSaque">
                        Repom Saque
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="redeFrotaDebitoCheckbox" value="redeFrotaDebito">
                        Rede Frota Débito
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="tefPolicardCheckbox" value="tefPolicard">
                        TEF - Policard
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="tefVrBeneficCheckbox" value="tefVrBenefic">
                        TEF - VR Benefic
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="bamexCheckbox" value="bamex">
                        Bamex
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="vrBeneficiosCheckbox" value="vrBeneficios">
                        VR Benefícios
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="motivoTefCheckbox" value="motivoTef">
                        Motivo TEF
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="saqjaStoneNovoCheckbox" value="saqjaStoneNovo">
                        Saqja Stone Novo
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="tefBrasilCarCheckbox" value="tefBrasilCar">
                        TEF - Brasil Car
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="tefCabalCredCheckbox" value="tefCabalCred">
                        TEF - Cabal Crédito
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="tefCabalDebiCheckbox" value="tefCabalDebi">
                        TEF - Cabal Débito
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="tefPersonalCCheckbox" value="tefPersonalC">
                        TEF - Personal C
                    </label>
                </div>
            </div>
        </div>
<!-- Contador de empresas -->
<div class="px-4 pb-2">
    <div class="stat-card company-count-card">
        <div class="flex items-center justify-center gap-2">
            <div>
                <p class="text-xs font-medium text-gray-600">Número de Empresas</p>
                <p class="text-lg font-bold text-gray-900" id="companyCount">0</p>
            </div>
            <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                <i class="fas fa-building text-blue-600 text-base"></i>
            </div>
        </div>
    </div>
</div>
        <!-- Tabela -->
        <div class="px-4 pb-8 w-full">
            <div class="table-container">
                <table class="modern-table w-full">
                    <thead id="tableHeader"></thead>
                    <tbody id="tableBody"></tbody>
                    <tfoot id="tableFooter" class="bg-gray-50 font-semibold"></tfoot>
                </table>
            </div>
        </div>
    </div>
<div class="print-header">
        Relatório de Vendas por Forma de Pagamento
    </div>
    <div class="print-footer">
        Gerado em: <span id="printDate"></span> 
    </div>

    <script>
        // Configuração do PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.worker.min.js';
        
        // Variáveis globais
        let salesData = [];
        let filteredData = [];
        let chartInstance = null;
        let sortOrder = null;

        // Elementos DOM
        const fileInput = document.getElementById('fileInput');
        const fileInputArea = document.getElementById('fileInputArea');
        const tableHeader = document.getElementById('tableHeader');
        const tableBody = document.getElementById('tableBody');
        const tableFooter = document.getElementById('tableFooter');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const successMessage = document.getElementById('successMessage');
        const printValues = document.getElementById('printValues');
        const statsCards = document.getElementById('statsCards');
        const searchInput = document.getElementById('searchInput');
        const sortAscButton = document.getElementById('sortAsc');
        const sortDescButton = document.getElementById('sortDesc');
        const printDate = document.getElementById('printDate');

        // Mapeamento de colunas e ícones
        const paymentTypes = {
            cash: { label: 'Dinheiro', icon: 'fa-money-bill' },
            creditNotes: { label: 'Notas a Prazo', icon: 'fa-file-invoice' },
            preDated: { label: 'Cheque Pré-Datado', icon: 'fa-calendar-alt' },
            onSight: { label: 'Cheque À Vista', icon: 'fa-eye' },
            tefTicket: { label: 'TEF - Ticket Log', icon: 'fa-credit-card' },
            redeFrota: { label: 'Rede Frota Crédito', icon: 'fa-credit-card' },
            tefMaster: { label: 'TEF - Mastercard', icon: 'fa-credit-card' },
            pixStone: { label: 'PIX (Stone)', icon: 'fa-qrcode' },
            proFrotas: { label: 'Pro Frotas', icon: 'fa-truck' },
            tefVisa: { label: 'TEF - Visa Electron', icon: 'fa-credit-card' },
            tefMasterMaestr: { label: 'TEF - Master Maestr', icon: 'fa-credit-card' },
            ctf: { label: 'CTF', icon: 'fa-credit-card' },
            tefTruckPag: { label: 'TEF - Truck Pag', icon: 'fa-credit-card' },
            tefVisaCredi: { label: 'TEF - Visa Credi', icon: 'fa-credit-card' },
            qrLinxPix: { label: 'QR Linx - PIX', icon: 'fa-qrcode' },
            tefAleloAuto: { label: 'TEF - Alelo Auto', icon: 'fa-credit-card' },
            tefCtfTef: { label: 'TEF - CTF TEF', icon: 'fa-credit-card' },
            truckPagAbaste: { label: 'Truck Pag Abaste', icon: 'fa-credit-card' },
            tefValeCard: { label: 'TEF - Vale Card', icon: 'fa-credit-card' },
            tefEloDebito: { label: 'TEF - Elo Débito', icon: 'fa-credit-card' },
            tefEloCredit: { label: 'TEF - Elo Crédito', icon: 'fa-credit-card' },
            visaDebito: { label: 'Visa Débito', icon: 'fa-credit-card' },
            targetPay: { label: 'Target Pay', icon: 'fa-credit-card' },
            cartaFrete: { label: 'Carta Frete', icon: 'fa-file-invoice' },
            visaCredito: { label: 'Visa Crédito', icon: 'fa-credit-card' },
            masterCardCred: { label: 'MasterCard Crédito', icon: 'fa-credit-card' },
            tefVisaElectronLio: { label: 'TEF - Visa Electron Lio', icon: 'fa-credit-card' },
            redeSempre: { label: 'Rede Sempre', icon: 'fa-credit-card' },
            repomAbasteci: { label: 'Repom Abasteci', icon: 'fa-gas-pump' },
            tefMaxiFrota: { label: 'TEF - Maxi Frota', icon: 'fa-truck' },
            tefSodexoWiz: { label: 'TEF - Sodexo Wiz', icon: 'fa-credit-card' },
            novoAbasteceAi: { label: 'Novo Abastece AI', icon: 'fa-gas-pump' },
            masterCardDebi: { label: 'MasterCard Débito', icon: 'fa-credit-card' },
            tefSouthAmer: { label: 'TEF - South Amer', icon: 'fa-credit-card' },
            eFrete: { label: 'E-Frete', icon: 'fa-truck' },
            tefAmericanE: { label: 'TEF - American E', icon: 'fa-credit-card' },
            ticketLog: { label: 'Ticket Log', icon: 'fa-credit-card' },
            fleetcardCredito: { label: 'Fleetcard Crédito', icon: 'fa-credit-card' },
            tefFitcardCr: { label: 'TEF - Fitcard Cr', icon: 'fa-credit-card' },
            southAmerica: { label: 'South America', icon: 'fa-credit-card' },
            tefSenffCard: { label: 'TEF - Senff Card', icon: 'fa-credit-card' },
            eloDebito: { label: 'Elo Débito', icon: 'fa-credit-card' },
            eloCredito: { label: 'Elo Crédito', icon: 'fa-credit-card' },
            pamcardFrota: { label: 'Pamcard Frota +', icon: 'fa-credit-card' },
            x7Bank: { label: 'X7 Bank', icon: 'fa-credit-card' },
            tefFlexFrota: { label: 'TEF - Flex Frota', icon: 'fa-credit-card' },
            aleloAutoCredi: { label: 'Alelo Auto Credi', icon: 'fa-credit-card' },
            fitcardCredito: { label: 'Fitcard Crédito', icon: 'fa-credit-card' },
            repomSaque: { label: 'Repom Saque', icon: 'fa-money-bill-wave' },
            redeFrotaDebito: { label: 'Rede Frota Débito', icon: 'fa-credit-card' },
            tefPolicard: { label: 'TEF - Policard', icon: 'fa-credit-card' },
            tefVrBenefic: { label: 'TEF - VR Benefic', icon: 'fa-credit-card' },
            bamex: { label: 'Bamex', icon: 'fa-credit-card' },
            vrBeneficios: { label: 'VR Benefícios', icon: 'fa-credit-card' },
            motivoTef: { label: 'Motivo TEF', icon: 'fa-credit-card' },
            saqjaStoneNovo: { label: 'Saqja Stone Novo', icon: 'fa-credit-card' },
            tefBrasilCar: { label: 'TEF - Brasil Car', icon: 'fa-credit-card' },
            tefCabalCred: { label: 'TEF - Cabal Crédito', icon: 'fa-credit-card' },
            tefCabalDebi: { label: 'TEF - Cabal Débito', icon: 'fa-credit-card' },
            tefPersonalC: { label: 'TEF - Personal C', icon: 'fa-credit-card' }
        };

        // Obter todos os checkboxes
        const checkboxes = Array.from(document.querySelectorAll('.checkbox-label input[type="checkbox"]'));

        // Mapeamento de colunas para checkboxes
        const columnMap = {};
        checkboxes.forEach(checkbox => {
            const value = checkbox.value;
            columnMap[value] = [
                `${value}-column`,
                `${value}-percent-column`
            ];
        });

        // Event listeners
        fileInput.addEventListener('change', handleFiles);
        document.getElementById('exportCSV').addEventListener('click', exportToCSV);
        document.getElementById('clearData').addEventListener('click', clearAllData);
        searchInput.addEventListener('input', handleSearch);
        sortAscButton.addEventListener('click', () => sortData('asc'));
        sortDescButton.addEventListener('click', () => sortData('desc'));
        checkboxes.forEach(checkbox => checkbox.addEventListener('change', updateDisplay));

        // Drag and drop functionality
        fileInputArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileInputArea.style.borderColor = '#667eea';
        });

        fileInputArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            fileInputArea.style.borderColor = '#cbd5e1';
        });

        fileInputArea.addEventListener('drop', (e) => {
            e.preventDefault();
            fileInputArea.style.borderColor = '#cbd5e1';
            const files = e.dataTransfer.files;
            handleFiles({ target: { files } });
        });

        fileInputArea.addEventListener('click', () => {
            fileInput.click();
        });

        // Função para formatar valores monetários
      // Função para formatar valores monetários
function formatarValor(valor) {
    if (isNaN(valor) || valor === null || valor === undefined) return ' 0,00';
    const partes = valor.toFixed(2).split('.');
    partes[0] = partes[0].replace(/\B(?=(\d{3})+(?!\d))/g, '.');
    return ' ' + partes.join(',');
}

// Função para converter números no formato brasileiro
function parseBrazilianNumber(str) {
    if (!str) return 0;
    const cleaned = str.replace(/\./g, '').replace(',', '.');
    return parseFloat(cleaned) || 0;
}

        // Carregar dados salvos ao inicializar
        window.addEventListener('load', loadSavedData);

        function loadSavedData() {
            const savedData = localStorage.getItem('salesReportData');
            if (savedData) {
                salesData = JSON.parse(savedData);
                filteredData = [...salesData];
                setDefaultCheckboxes();
                updateDisplay();
            }
        }

        function saveData() {
            localStorage.setItem('salesReportData', JSON.stringify(salesData));
        }

        function setDefaultCheckboxes() {
            checkboxes.forEach(checkbox => {
                checkbox.checked = checkbox.value === 'cash' || checkbox.value === 'creditNotes';
            });
        }

async function handleFiles(event) {
    const files = Array.from(event.target.files);
    if (files.length === 0) return;

    loadingSpinner.style.display = 'block';

    for (const file of files) {
        try {
            // Limpeza robusta do fileName
            let fileName = file.name
                .replace('.pdf', '') // Remove extensão .pdf
                .replace(/01 GERAL.*$/i, '') // Remove "01 GERAL" e qualquer coisa após
                .replace(/[^\w\s-]/g, '') // Remove caracteres especiais, exceto letras, números, espaços e hífens
                .replace(/\s+/g, ' ') // Substitui múltiplos espaços por um único espaço
                .trim(); // Remove espaços extras no início e fim

            // Ignorar arquivos com nome vazio após limpeza
            if (!fileName) {
                console.warn(`Arquivo ${file.name} ignorado: nome inválido após limpeza.`);
                continue;
            }

            const fileData = await extractDataFromPDF(file);

            // Validar se os dados extraídos são válidos
            if (!fileData || fileData.totalVendas <= 0) {
                console.warn(`Arquivo ${file.name} ignorado: dados inválidos ou total de vendas igual a zero.`);
                continue;
            }

            const existingIndex = salesData.findIndex(item => item.fileName === fileName);

            const newData = {
                fileName,
                cash: fileData.dinheiro || 0,
                cashPercent: fileData.percentDinheiro || 0,
                creditNotes: fileData.notasAPrazo || 0,
                creditNotesPercent: fileData.percentNotasAPrazo || 0,
                preDated: fileData.chequePreDatado || 0,
                preDatedPercent: fileData.percentChequePreDatado || 0,
                onSight: fileData.chequeAVista || 0,
                onSightPercent: fileData.percentChequeAVista || 0,
                tefTicket: fileData.tefTicketLog || 0,
                tefTicketPercent: fileData.percentTefTicketLog || 0,
                redeFrota: fileData.redeFrotaCredito || 0,
                redeFrotaPercent: fileData.percentRedeFrotaCredito || 0,
                tefMaster: fileData.tefMastercard || 0,
                tefMasterPercent: fileData.percentTefMastercard || 0,
                pixStone: fileData.pixStone || 0,
                pixStonePercent: fileData.percentPixStone || 0,
                proFrotas: fileData.proFrotas || 0,
                proFrotasPercent: fileData.percentProFrotas || 0,
                tefVisa: fileData.tefVisaElectron || 0,
                tefVisaPercent: fileData.percentTefVisaElectron || 0,
                tefMasterMaestr: fileData.tefMasterMaestr || 0,
                tefMasterMaestrPercent: fileData.percentTefMasterMaestr || 0,
                ctf: fileData.ctf || 0,
                ctfPercent: fileData.percentCtf || 0,
                tefTruckPag: fileData.tefTruckPag || 0,
                tefTruckPagPercent: fileData.percentTefTruckPag || 0,
                tefVisaCredi: fileData.tefVisaCredi || 0,
                tefVisaCrediPercent: fileData.percentTefVisaCredi || 0,
                qrLinxPix: fileData.qrLinxPix || 0,
                qrLinxPixPercent: fileData.percentQrLinxPix || 0,
                tefAleloAuto: fileData.tefAleloAuto || 0,
                tefAleloAutoPercent: fileData.percentTefAleloAuto || 0,
                tefCtfTef: fileData.tefCtfTef || 0,
                tefCtfTefPercent: fileData.percentTefCtfTef || 0,
                truckPagAbaste: fileData.truckPagAbaste || 0,
                truckPagAbastePercent: fileData.percentTruckPagAbaste || 0,
                tefValeCard: fileData.tefValeCard || 0,
                tefValeCardPercent: fileData.percentTefValeCard || 0,
                tefEloDebito: fileData.tefEloDebito || 0,
                tefEloDebitoPercent: fileData.percentTefEloDebito || 0,
                tefEloCredit: fileData.tefEloCredit || 0,
                tefEloCreditPercent: fileData.percentTefEloCredit || 0,
                visaDebito: fileData.visaDebito || 0,
                visaDebitoPercent: fileData.percentVisaDebito || 0,
                targetPay: fileData.targetPay || 0,
                targetPayPercent: fileData.percentTargetPay || 0,
                cartaFrete: fileData.cartaFrete || 0,
                cartaFretePercent: fileData.percentCartaFrete || 0,
                visaCredito: fileData.visaCredito || 0,
                visaCreditoPercent: fileData.percentVisaCredito || 0,
                masterCardCred: fileData.masterCardCred || 0,
                masterCardCredPercent: fileData.percentMasterCardCred || 0,
                tefVisaElectronLio: fileData.tefVisaElectronLio || 0,
                tefVisaElectronLioPercent: fileData.percentTefVisaElectronLio || 0,
                redeSempre: fileData.redeSempre || 0,
                redeSemprePercent: fileData.percentRedeSempre || 0,
                repomAbasteci: fileData.repomAbasteci || 0,
                repomAbasteciPercent: fileData.percentRepomAbasteci || 0,
                tefMaxiFrota: fileData.tefMaxiFrota || 0,
                tefMaxiFrotaPercent: fileData.percentTefMaxiFrota || 0,
                tefSodexoWiz: fileData.tefSodexoWiz || 0,
                tefSodexoWizPercent: fileData.percentTefSodexoWiz || 0,
                novoAbasteceAi: fileData.novoAbasteceAi || 0,
                novoAbasteceAiPercent: fileData.percentNovoAbasteceAi || 0,
                masterCardDebi: fileData.masterCardDebi || 0,
                masterCardDebiPercent: fileData.percentMasterCardDebi || 0,
                tefSouthAmer: fileData.tefSouthAmer || 0,
                tefSouthAmerPercent: fileData.percentTefSouthAmer || 0,
                eFrete: fileData.eFrete || 0,
                eFretePercent: fileData.percentEFrete || 0,
                tefAmericanE: fileData.tefAmericanE || 0,
                tefAmericanEPercent: fileData.percentTefAmericanE || 0,
                ticketLog: fileData.ticketLog || 0,
                ticketLogPercent: fileData.percentTicketLog || 0,
                fleetcardCredito: fileData.fleetcardCredito || 0,
                fleetcardCreditoPercent: fileData.percentFleetcardCredito || 0,
                tefFitcardCr: fileData.tefFitcardCr || 0,
                tefFitcardCrPercent: fileData.percentTefFitcardCr || 0,
                southAmerica: fileData.southAmerica || 0,
                southAmericaPercent: fileData.percentSouthAmerica || 0,
                tefSenffCard: fileData.tefSenffCard || 0,
                tefSenffCardPercent: fileData.percentTefSenffCard || 0,
                eloDebito: fileData.eloDebito || 0,
                eloDebitoPercent: fileData.percentEloDebito || 0,
                eloCredito: fileData.eloCredito || 0,
                eloCreditoPercent: fileData.percentEloCredito || 0,
                pamcardFrota: fileData.pamcardFrota || 0,
                pamcardFrotaPercent: fileData.percentPamcardFrota || 0,
                x7Bank: fileData.x7Bank || 0,
                x7BankPercent: fileData.percentX7Bank || 0,
                tefFlexFrota: fileData.tefFlexFrota || 0,
                tefFlexFrotaPercent: fileData.percentTefFlexFrota || 0,
                aleloAutoCredi: fileData.aleloAutoCredi || 0,
                aleloAutoCrediPercent: fileData.percentAleloAutoCredi || 0,
                fitcardCredito: fileData.fitcardCredito || 0,
                fitcardCreditoPercent: fileData.percentFitcardCredito || 0,
                repomSaque: fileData.repomSaque || 0,
                repomSaquePercent: fileData.percentRepomSaque || 0,
                redeFrotaDebito: fileData.redeFrotaDebito || 0,
                redeFrotaDebitoPercent: fileData.percentRedeFrotaDebito || 0,
                tefPolicard: fileData.tefPolicard || 0,
                tefPolicardPercent: fileData.percentTefPolicard || 0,
                tefVrBenefic: fileData.tefVrBenefic || 0,
                tefVrBeneficPercent: fileData.percentTefVrBenefic || 0,
                bamex: fileData.bamex || 0,
                bamexPercent: fileData.percentBamex || 0,
                vrBeneficios: fileData.vrBeneficios || 0,
                vrBeneficiosPercent: fileData.percentVrBeneficios || 0,
                motivoTef: fileData.motivoTef || 0,
                motivoTefPercent: fileData.percentMotivoTef || 0,
                saqjaStoneNovo: fileData.saqjaStoneNovo || 0,
                saqjaStoneNovoPercent: fileData.percentSaqjaStoneNovo || 0,
                tefBrasilCar: fileData.tefBrasilCar || 0,
                tefBrasilCarPercent: fileData.percentTefBrasilCar || 0,
                tefCabalCred: fileData.tefCabalCred || 0,
                tefCabalCredPercent: fileData.percentTefCabalCred || 0,
                tefCabalDebi: fileData.tefCabalDebi || 0,
                tefCabalDebiPercent: fileData.percentTefCabalDebi || 0,
                tefPersonalC: fileData.tefPersonalC || 0,
                tefPersonalCPercent: fileData.percentTefPersonalC || 0,
                total: fileData.totalVendas,
                timestamp: new Date().toISOString()
            };

            if (existingIndex >= 0) {
                salesData[existingIndex] = newData;
            } else {
                salesData.push(newData);
            }
        } catch (error) {
            console.error(`Erro ao processar o arquivo ${file.name}:`, error);
        }
    }

    // Filtrar entradas inválidas de salesData
    salesData = salesData.filter(data => data.fileName && data.total > 0);
    filteredData = [...salesData];
    loadingSpinner.style.display = 'none';
    setDefaultCheckboxes();
    saveData();
    updateDisplay();
    showSuccessMessage(`${files.length} arquivo(s) processado(s) com sucesso!`);
}
        function showSuccessMessage(message) {
            successMessage.innerHTML = `
                <div class="success-message">
                    <i class="fas fa-check-circle"></i>
                    ${message}
                </div>
            `;
            successMessage.style.display = 'block';
            setTimeout(() => {
                successMessage.style.display = 'none';
            }, 3000);
        }

        function handleSearch() {
            const searchTerm = searchInput.value.toLowerCase();
            filteredData = salesData.filter(data => 
                data.fileName.toLowerCase().includes(searchTerm)
            );
            if (sortOrder) {
                sortData(sortOrder);
            } else {
                updateDisplay();
            }
        }

        function sortData(order) {
            sortOrder = order;
            filteredData.sort((a, b) => {
                if (order === 'asc') {
                    return a.onSightPercent - b.onSightPercent;
                } else {
                    return b.onSightPercent - a.onSightPercent;
                }
            });
            updateDisplay();
        }

       function updateDisplay() {
    // Atualizar o contador de empresas
    document.getElementById('companyCount').textContent = filteredData.length;
    
    updateColumnVisibility();
    updateTable();
    updateStats();
    updateChart();
    updatePrintDate();
}

        function updatePrintDate() {
            const now = new Date();
            printDate.textContent = now.toLocaleString('pt-BR');
        }

        function updateColumnVisibility() {
            document.querySelectorAll('th, td').forEach(el => {
                el.classList.remove('hidden-column');
            });

            checkboxes.forEach(checkbox => {
                const value = checkbox.value;
                if (!checkbox.checked && columnMap[value]) {
                    columnMap[value].forEach(colClass => {
                        document.querySelectorAll(`.${colClass}`).forEach(el => {
                            el.classList.add('hidden-column');
                        });
                    });
                }
            });
        }

        function updateStats() {
            statsCards.innerHTML = '';
            const selectedTypes = checkboxes.filter(checkbox => checkbox.checked).map(checkbox => checkbox.value);
            const grandTotal = filteredData.reduce((sum, data) => sum + data.total, 0);

            const totalCard = document.createElement('div');
            totalCard.className = 'stat-card';
            totalCard.innerHTML = `
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Total de Vendas</p>
                        <p class="text-2xl font-bold text-gray-900">${formatarValor(grandTotal)}</p>
                    </div>
                    <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-dollar-sign text-blue-600 text-xl"></i>
                    </div>
                </div>
            `;
            statsCards.appendChild(totalCard);

            selectedTypes.forEach(type => {
                const total = filteredData.reduce((sum, data) => sum + data[type], 0);
                const card = document.createElement('div');
                card.className = 'stat-card';
                card.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">${paymentTypes[type].label}</p>
                            <p class="text-2xl font-bold text-gray-900">${formatarValor(total)}</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                            <i class="fas ${paymentTypes[type].icon} text-blue-600 text-xl"></i>
                        </div>
                    </div>
                `;
                statsCards.appendChild(card);
            });
        }

      function updateTable() {
    tableHeader.innerHTML = '';
    tableBody.innerHTML = '';
    tableFooter.innerHTML = '';

    const selectedTypes = checkboxes.filter(checkbox => checkbox.checked).map(checkbox => checkbox.value);

    // Filtrar entradas inválidas de filteredData
    const validData = filteredData.filter(data => data.fileName && data.fileName.trim() && data.total > 0);

    // Criar cabeçalho da tabela
    let headerHtml = '<tr><th class="text-left"><i class="fas fa-building mr-2"></i>Empresa</th>';
    selectedTypes.forEach(type => {
        headerHtml += `
            <th class="text-right ${type}-column"><i class="fas ${paymentTypes[type].icon} mr-2"></i>${paymentTypes[type].label}</th>
            <th class="text-right ${type}-percent-column"><i class="fas fa-percentage mr-2"></i>% ${paymentTypes[type].label}</th>
        `;
    });
    headerHtml += '<th class="text-right"><i class="fas fa-dollar-sign mr-2"></i>Total de Vendas</th></tr>';
    tableHeader.innerHTML = headerHtml;

    // Criar corpo da tabela
    validData.forEach(data => {
        const row = document.createElement('tr');
        // Sanitizar fileName para evitar injeção de HTML ou conteúdo indesejado
        const sanitizedFileName = data.fileName
            .replace(/[<>"'&]/g, '') // Remove caracteres HTML perigosos
            .replace(/[^\w\s-]/g, '') // Remove caracteres especiais
            .trim();
        let rowHtml = `<td class="font-medium text-left">${sanitizedFileName}</td>`;
        selectedTypes.forEach(type => {
            rowHtml += `
                <td class="text-right ${type}-column">${formatarValor(data[type])}</td>
                <td class="text-right ${type}-percent-column">${data[`${type}Percent`]?.toFixed(2)}%</td>
            `;
        });
        rowHtml += `<td class="text-right font-semibold">${formatarValor(data.total)}</td>`;
        row.innerHTML = rowHtml;
        tableBody.appendChild(row);
    });

    // Criar rodapé da tabela
    if (validData.length > 0) {
        const totals = {};
        const percents = {};
        selectedTypes.forEach(type => {
            totals[type] = validData.reduce((sum, data) => sum + data[type], 0);
            percents[type] = validData.reduce((sum, data) => sum + (data[`${type}Percent`] || 0), 0);
        });
        const grandTotal = validData.reduce((sum, data) => sum + data.total, 0);

        const footerRow = document.createElement('tr');
        let footerHtml = '<td class="font-bold text-gray-900 text-left">TOTAL GERAL</td>';
        selectedTypes.forEach(type => {
            footerHtml += `
                <td class="text-right font-bold text-gray-900 ${type}-column">${formatarValor(totals[type])}</td>
                <td class="text-right font-bold text-gray-900 ${type}-percent-column">${((totals[type] / grandTotal) * 100).toFixed(2)}%</td>
            `;
        });
        footerHtml += `<td class="text-right font-bold text-gray-900">${formatarValor(grandTotal)}</td>`;
        footerRow.innerHTML = footerHtml;
        tableFooter.appendChild(footerRow);
    }

    updateColumnVisibility();
}

        function updateChart() {
            if (typeof Chart === 'undefined') {
                console.error('Chart.js não foi carregado.');
                printValues.innerHTML = '<p>Erro: Chart.js não carregado.</p>';
                return;
            }

            const ctx = document.getElementById('salesChart')?.getContext('2d');
            if (!ctx) {
                console.error('Canvas com ID "salesChart" não encontrado.');
                printValues.innerHTML = '<p>Erro: Elemento de canvas não encontrado.</p>';
                return;
            }

            if (chartInstance) {
                chartInstance.destroy();
            }

            if (!filteredData || filteredData.length === 0) {
                console.warn('Nenhum dado disponível em filteredData.');
                printValues.innerHTML = '<p>Nenhum dado disponível.</p>';
                return;
            }

            const selectedTypes = checkboxes
                .filter(checkbox => checkbox.checked)
                .map(checkbox => checkbox.value);
            const datasets = [];

            const colors = [
                '#eab308', '#8b5cf6', '#ef4444', '#10b981', '#3b82f6', '#f97316', '#06b6d4',
                '#8b5cf6', '#ec4899', '#14b8a6', '#f59e0b', '#84cc16', '#0ea5e9', '#a855f7',
                '#d946ef', '#f43f5e', '#22d3ee', '#f472b6', '#fb923c', '#4ade80', '#38bdf8',
                '#c084fc', '#e879f9', '#fb7185', '#2dd4bf', '#fbbf24', '#34d399', '#60a5fa',
                '#a78bfa', '#f87171', '#818cf8', '#f472b6', '#fb923c', '#4ade80', '#38bdf8',
                '#c084fc', '#e879f9', '#fb7185', '#2dd4bf', '#fbbf24', '#34d399', '#60a5fa',
                '#a78bfa', '#f87171', '#818cf8', '#f472b6', '#fb923c', '#4ade80', '#38bdf8'
            ];

            selectedTypes.forEach((type, index) => {
                if (filteredData[0][type] !== undefined) {
                    datasets.push({
                        label: paymentTypes[type].label,
                        data: filteredData.map(data => data[type]),
                        borderColor: colors[index % colors.length],
                        backgroundColor: `${colors[index % colors.length]}20`,
                        borderWidth: 2,
                        tension: 0.3,
                        fill: false,
                        pointBackgroundColor: colors[index % colors.length],
                        pointRadius: 4,
                        pointHoverRadius: 7
                    });
                }
            });

            const totals = {};
            selectedTypes.forEach(type => {
                totals[type] = filteredData.reduce((sum, data) => sum + (data[type] || 0), 0);
            });
            
            const grandTotal = filteredData.reduce((sum, data) => sum + data.total, 0);

            printValues.innerHTML = `
                <h3 class="text-lg font-bold mb-4">Valores Detalhados</h3>
                <ul>
                    ${selectedTypes.map(type => `
                        <li><span>${paymentTypes[type].label}:</span> 
                        <strong>${formatarValor(totals[type])}</strong> (${grandTotal ? ((totals[type] / grandTotal) * 100).toFixed(2) : 0}%)</li>
                    `).join('')}
                    <li><span>Total Geral:</span> <strong>${formatarValor(grandTotal)}</strong></li>
                </ul>
            `;

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: filteredData.map(data => data.fileName),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Empresas',
                                font: {
                                    size: 14,
                                    weight: '600'
                                }
                            },
                            grid: {
                                display: false
                            },
                            ticks: {
                                autoSkip: false,
                                maxRotation: 45,
                                minRotation: 45,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Valor ()',
                                font: {
                                    size: 14,
                                    weight: '600'
                                }
                            },
                            ticks: {
                                callback: function(value) {
                                    return formatarValor(value);
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                padding: 20,
                                font: {
                                    size: 14,
                                    weight: '600'
                                },
                                usePointStyle: true,
                                pointStyle: 'circle',
                                color: '#374151'
                            }
                        },
                        title: {
                            display: true,
                            text: 'Vendas por Forma de Pagamento por Empresa',
                            font: {
                                size: 20,
                                weight: 'bold'
                            },
                            padding: {
                                top: 20,
                                bottom: 30
                            },
                            color: '#374151'
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleFont: {
                                size: 16,
                                weight: '600'
                            },
                            bodyFont: {
                                size: 14
                            },
                            padding: 12,
                            cornerRadius: 8,
                            callbacks: {
                                label: function(context) {
                                    const label = context.dataset.label;
                                    const value = context.raw;
                                    const percentage = grandTotal ? ((value / grandTotal) * 100).toFixed(2) : 0;
                                    return `${label}: ${formatarValor(value)} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    animation: {
                        duration: 2000,
                        easing: 'easeInOutQuart'
                    }
                }
            });
        }

        function exportToCSV() {
            if (filteredData.length === 0) {
                alert('Nenhum dado para exportar!');
                return;
            }

            const selectedTypes = checkboxes.filter(checkbox => checkbox.checked).map(checkbox => checkbox.value);
            const headers = ['Empresa'];
            selectedTypes.forEach(type => {
                headers.push(paymentTypes[type].label);
                headers.push(`% ${paymentTypes[type].label}`);
            });
            headers.push('Total de Vendas');

            const csvContent = [
                headers.join(','),
                ...filteredData.map(data => {
                    const row = [`"${data.fileName}"`];
                    selectedTypes.forEach(type => {
                        row.push(data[type]?.toFixed(2) || '0.00');
                        row.push(data[`${type}Percent`]?.toFixed(2) || '0.00');
                    });
                    row.push(data.total.toFixed(2));
                    return row.join(',');
                })
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `relatorio_vendas_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();

            showSuccessMessage('Relatório exportado com sucesso!');
        }

        function clearAllData() {
            if (confirm('Tem certeza que deseja limpar todos os dados? Esta ação não pode ser desfeita.')) {
                salesData = [];
                filteredData = [];
                sortOrder = null;
                searchInput.value = '';
                setDefaultCheckboxes();
                localStorage.removeItem('salesReportData');
                updateDisplay();
                if (chartInstance) {
                    chartInstance.destroy();
                    chartInstance = null;
                }
                showSuccessMessage('Todos os dados foram limpos!');
            }
        }

        function uncheckAllCheckboxes() {
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            updateDisplay();
        }

        async function extractDataFromPDF(file) {
    return new Promise((resolve, reject) => {
        const fileReader = new FileReader();

        fileReader.onload = async function() {
            try {
                        const typedArray = new Uint8Array(this.result);
                        const pdf = await pdfjsLib.getDocument(typedArray).promise;
                        const page = await pdf.getPage(1);
                        const textContent = await page.getTextContent();

                        const lines = [];
                        let currentLine = '';

                        textContent.items.forEach((item, index) => {
                            if (item.str.includes('\n') || (item.transform[4] < (textContent.items[index-1]?.transform[4] || 0))) {
                                if (currentLine.trim() !== '') {
                                    lines.push(currentLine.trim());
                                }
                                currentLine = item.str;
                            } else {
                                currentLine += item.str;
                            }
                        });

                        if (currentLine.trim() !== '') {
                            lines.push(currentLine.trim());
                        }

                        const tableData = [];
                        let inTable = false;

                        lines.forEach(line => {
                            if (line.includes('Rótulo') && line.includes('%') && line.includes('Valor')) {
                                inTable = true;
                                return;
                            }

                            if (inTable && line.trim() !== '') {
                                const columns = line.split(/\s+/).filter(Boolean);

                                if (columns.length >= 3) {
                                    const label = columns.slice(0, -2).join(' ');
                                    const percent = columns[columns.length - 2];
                                    const value = columns[columns.length - 1];

                                    tableData.push({
                                        label,
                                        percent: parseFloat(percent.replace(',', '.')),
                                        value: parseFloat(value.replace(/\./g, '').replace(',', '.'))
                                    });
                                }
                            }
                        });

                        const result = {};

                        const extractValue = (pattern) => {
                            const item = tableData.find(i => i.label.match(pattern)) || { percent: 0, value: 0 };
                            return {
                                value: item.value,
                                percent: item.percent
                            };
                        };

                        const dinheiro = extractValue(/DINHEIRO/i);
                        const notasAPrazo = extractValue(/NOTAS A PRAZO|NOTAS À PRAZO/i);
                        const chequeAVista = extractValue(/CHEQUE A VISTA/i);
                        const chequePreDatado = extractValue(/CHEQUE PRE DATADO|CHEQUE PRÉ-DATADO/i);
                        const tefTicketLog = extractValue(/TEF - CARTAO TICKET LOG/i);
                        const redeFrotaCredito = extractValue(/REDE FROTA CREDITO - AB/i);
                        const tefMastercard = extractValue(/TEF - MASTERCARD CREDIT/i);
                        const pixStone = extractValue(/PIX \(STONE\)/i);
                        const proFrotas = extractValue(/PRO FROTAS/i);
                        const tefVisaElectron = extractValue(/TEF - VISA ELECTRON/i);
                        const tefMasterMaestr = extractValue(/TEF - MASTERCARD MAESTR/i);
                        const ctf = extractValue(/CTF/i);
                        const tefTruckPag = extractValue(/TEF - CARTAO TRUCK PAG/i);
                        const tefVisaCredi = extractValue(/TEF - CARTAO VISA CREDI/i);
                        const qrLinxPix = extractValue(/QR LINX - PIX/i);
                        const tefAleloAuto = extractValue(/TEF - CARTAO ALELO AUTO/i);
                        const tefCtfTef = extractValue(/TEF - CARTAO CTF TEF/i);
                        const truckPagAbaste = extractValue(/CARTAO TRUCK PAG ABASTE/i);
                        const tefValeCard = extractValue(/TEF - CARTAO VALE CARD/i);
                        const tefEloDebito = extractValue(/TEF - CARTAO ELO DEBITO/i);
                        const tefEloCredit = extractValue(/TEF - CARTAO ELO CREDIT/i);
                        const visaDebito = extractValue(/CARTAO VISA DEBITO/i);
                        const targetPay = extractValue(/TARGET PAY/i);
                        const cartaFrete = extractValue(/CARTA FRETE/i);
                        const visaCredito = extractValue(/CARTAO VISA CREDITO/i);
                        const masterCardCred = extractValue(/CARTAO MASTER CARD CRED/i);
                        const tefVisaElectronLio = extractValue(/TEF - VISA ELECTRON LIO/i);
                        const redeSempre = extractValue(/CARTAO REDE SEMPRE/i);
                        const repomAbasteci = extractValue(/CARTAO REPOM - ABASTECI/i);
                        const tefMaxiFrota = extractValue(/TEF - CARTAO MAXI FROTA/i);
                        const tefSodexoWiz = extractValue(/TEF - CARTAO SODEXO WIZ/i);
                        const novoAbasteceAi = extractValue(/CARTAO NOVO ABASTECE AI/i);
                        const masterCardDebi = extractValue(/CARTAO MASTER CARD DEBI/i);
                        const tefSouthAmer = extractValue(/TEF - CARTAO SOUTH AMER/i);
                        const eFrete = extractValue(/E-FRETE/i);
                        const tefAmericanE = extractValue(/TEF - CARTAO AMERICAN E/i);
                        const ticketLog = extractValue(/CARTAO TICKET LOG/i);
                        const fleetcardCredito = extractValue(/CARTAO FLEETCARD CREDIT/i);
                        const tefFitcardCr = extractValue(/TEF - CARTAO FITCARD CR/i);
                        const southAmerica = extractValue(/CARTAO SOUTH AMERICA/i);
                        const tefSenffCard = extractValue(/TEF - CARTAO SENFF CARD/i);
                        const eloDebito = extractValue(/CARTAO ELO DEBITO/i);
                        const eloCredito = extractValue(/CARTAO ELO CREDITO/i);
                        const pamcardFrota = extractValue(/CARTAO PAMCARD FROTA \+/i);
                        const x7Bank = extractValue(/CARTAO X7 BANK/i);
                        const tefFlexFrota = extractValue(/TEF - CARTAO FLEX FROTA/i);
                        const aleloAutoCredi = extractValue(/CARTAO ALELO AUTO CREDI/i);
                        const fitcardCredito = extractValue(/CARTAO FITCARD CREDITO/i);
                        const repomSaque = extractValue(/CARTAO REPOM - SAQUE/i);
                        const redeFrotaDebito = extractValue(/REDE FROTA DEBITO/i);
                        const tefPolicard = extractValue(/TEF - CARTAO POLICARD/i);
                        const tefVrBenefic = extractValue(/TEF - CARTAO VR BENEFIC/i);
                        const bamex = extractValue(/CARTAO BAMEX/i);
                        const vrBeneficios = extractValue(/CARTAO VR BENEFICIOS/i);
                        const motivoTef = extractValue(/MOTIVO GENERICO DE TEF/i);
                        const saqjaStoneNovo = extractValue(/SAQJA STONE NOVO/i);
                        const tefBrasilCar = extractValue(/TEF - CARTAO BRASIL CAR/i);
                        const tefCabalCred = extractValue(/TEF - CARTAO CABAL CRED/i);
                        const tefCabalDebi = extractValue(/TEF - CARTAO CABAL DEBI/i);
                        const tefPersonalC = extractValue(/TEF - CARTAO PERSONAL C/i);

                        let totalVendas = 0;
                        for (let i = lines.length - 1; i >= 0; i--) {
                            if (lines[i].includes('Total')) {
                                const totalParts = lines[i].split(/\s+/);
                                const totalValue = totalParts[totalParts.length - 1];
                                if (totalValue) {
                                    totalVendas = parseFloat(totalValue.replace(/\./g, '').replace(',', '.'));
                                }
                                break;
                            }
                        }

                        Object.assign(result, {
                            dinheiro: dinheiro.value,
                            percentDinheiro: dinheiro.percent,
                            notasAPrazo: notasAPrazo.value,
                            percentNotasAPrazo: notasAPrazo.percent,
                            chequePreDatado: chequePreDatado.value,
                            percentChequePreDatado: chequePreDatado.percent,
                            chequeAVista: chequeAVista.value,
                            percentChequeAVista: chequeAVista.percent,
                            tefTicketLog: tefTicketLog.value,
                            percentTefTicketLog: tefTicketLog.percent,
                            redeFrotaCredito: redeFrotaCredito.value,
                            percentRedeFrotaCredito: redeFrotaCredito.percent,
                            tefMastercard: tefMastercard.value,
                            percentTefMastercard: tefMastercard.percent,
                            pixStone: pixStone.value,
                            percentPixStone: pixStone.percent,
                            proFrotas: proFrotas.value,
                            percentProFrotas: proFrotas.percent,
                            tefVisaElectron: tefVisaElectron.value,
                            percentTefVisaElectron: tefVisaElectron.percent,
                            tefMasterMaestr: tefMasterMaestr.value,
                            percentTefMasterMaestr: tefMasterMaestr.percent,
                            ctf: ctf.value,
                            percentCtf: ctf.percent,
                            tefTruckPag: tefTruckPag.value,
                            percentTefTruckPag: tefTruckPag.percent,
                            tefVisaCredi: tefVisaCredi.value,
                            percentTefVisaCredi: tefVisaCredi.percent,
                            qrLinxPix: qrLinxPix.value,
                            percentQrLinxPix: qrLinxPix.percent,
                            tefAleloAuto: tefAleloAuto.value,
                            percentTefAleloAuto: tefAleloAuto.percent,
                            tefCtfTef: tefCtfTef.value,
                            percentTefCtfTef: tefCtfTef.percent,
                            truckPagAbaste: truckPagAbaste.value,
                            percentTruckPagAbaste: truckPagAbaste.percent,
                            tefValeCard: tefValeCard.value,
                            percentTefValeCard: tefValeCard.percent,
                            tefEloDebito: tefEloDebito.value,
                            percentTefEloDebito: tefEloDebito.percent,
                            tefEloCredit: tefEloCredit.value,
                            percentTefEloCredit: tefEloCredit.percent,
                            visaDebito: visaDebito.value,
                            percentVisaDebito: visaDebito.percent,
                            targetPay: targetPay.value,
                            percentTargetPay: targetPay.percent,
                            cartaFrete: cartaFrete.value,
                            percentCartaFrete: cartaFrete.percent,
                            visaCredito: visaCredito.value,
                            percentVisaCredito: visaCredito.percent,
                            masterCardCred: masterCardCred.value,
                            percentMasterCardCred: masterCardCred.percent,
                            tefVisaElectronLio: tefVisaElectronLio.value,
                            percentTefVisaElectronLio: tefVisaElectronLio.percent,
                            redeSempre: redeSempre.value,
                            percentRedeSempre: redeSempre.percent,
                            repomAbasteci: repomAbasteci.value,
                            percentRepomAbasteci: repomAbasteci.percent,
                            tefMaxiFrota: tefMaxiFrota.value,
                            percentTefMaxiFrota: tefMaxiFrota.percent,
                            tefSodexoWiz: tefSodexoWiz.value,
                            percentTefSodexoWiz: tefSodexoWiz.percent,
                            novoAbasteceAi: novoAbasteceAi.value,
                            percentNovoAbasteceAi: novoAbasteceAi.percent,
                            masterCardDebi: masterCardDebi.value,
                            percentMasterCardDebi: masterCardDebi.percent,
                            tefSouthAmer: tefSouthAmer.value,
                            percentTefSouthAmer: tefSouthAmer.percent,
                            eFrete: eFrete.value,
                            percentEFrete: eFrete.percent,
                            tefAmericanE: tefAmericanE.value,
                            percentTefAmericanE: tefAmericanE.percent,
                            ticketLog: ticketLog.value,
                            percentTicketLog: ticketLog.percent,
                            fleetcardCredito: fleetcardCredito.value,
                            percentFleetcardCredito: fleetcardCredito.percent,
                            tefFitcardCr: tefFitcardCr.value,
                            percentTefFitcardCr: tefFitcardCr.percent,
                            southAmerica: southAmerica.value,
                            percentSouthAmerica: southAmerica.percent,
                            tefSenffCard: tefSenffCard.value,
                            percentTefSenffCard: tefSenffCard.percent,
                            eloDebito: eloDebito.value,
                            percentEloDebito: eloDebito.percent,
                            eloCredito: eloCredito.value,
                            percentEloCredito: eloCredito.percent,
                            pamcardFrota: pamcardFrota.value,
                            percentPamcardFrota: pamcardFrota.percent,
                            x7Bank: x7Bank.value,
                            percentX7Bank: x7Bank.percent,
                            tefFlexFrota: tefFlexFrota.value,
                            percentTefFlexFrota: tefFlexFrota.percent,
                            aleloAutoCredi: aleloAutoCredi.value,
                            percentAleloAutoCredi: aleloAutoCredi.percent,
                            fitcardCredito: fitcardCredito.value,
                            percentFitcardCredito: fitcardCredito.percent,
                            repomSaque: repomSaque.value,
                            percentRepomSaque: repomSaque.percent,
                            redeFrotaDebito: redeFrotaDebito.value,
                            percentRedeFrotaDebito: redeFrotaDebito.percent,
                            tefPolicard: tefPolicard.value,
                            percentTefPolicard: tefPolicard.percent,
                            tefVrBenefic: tefVrBenefic.value,
                            percentTefVrBenefic: tefVrBenefic.percent,
                            bamex: bamex.value,
                            percentBamex: bamex.percent,
                            vrBeneficios: vrBeneficios.value,
                            percentVrBeneficios: vrBeneficios.percent,
                            motivoTef: motivoTef.value,
                            percentMotivoTef: motivoTef.percent,
                            saqjaStoneNovo: saqjaStoneNovo.value,
                            percentSaqjaStoneNovo: saqjaStoneNovo.percent,
                            tefBrasilCar: tefBrasilCar.value,
                            percentTefBrasilCar: tefBrasilCar.percent,
                            tefCabalCred: tefCabalCred.value,
                            percentTefCabalCred: tefCabalCred.percent,
                            tefCabalDebi: tefCabalDebi.value,
                            percentTefCabalDebi: tefCabalDebi.percent,
                            tefPersonalC: tefPersonalC.value,
                            percentTefPersonalC: tefPersonalC.percent,
                            totalVendas
                        });

                        resolve(result);
                    } catch (error) {
                        reject(error);
                    }
                };

                fileReader.onerror = () => reject(fileReader.error);
                fileReader.readAsArrayBuffer(file);
            });
        }

        // Inicializar com checkboxes padrão
        window.addEventListener('DOMContentLoaded', () => {
            setDefaultCheckboxes();
            updateDisplay();
        });
// Funções para rolagem
document.getElementById('scrollToTop').addEventListener('click', () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
});

document.getElementById('scrollToBottom').addEventListener('click', () => {
    window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
});
//credito e débito 

// Função para selecionar todos os checkboxes de crédito
function selectCreditCheckboxes() {
    const creditTypes = [
        'tefMaster', 'tefVisa', 'tefVisaCredi', 'tefEloCredit',
        'visaCredito', 'masterCardCred', 'eloCredito'
    ];
    checkboxes.forEach(checkbox => {
        checkbox.checked = creditTypes.includes(checkbox.value);
    });
    updateDisplay();
}

// Função para selecionar todos os checkboxes de débito
function selectDebitCheckboxes() {
    const debitTypes = [
        'tefMasterMaestr', 'tefEloDebito', 'visaDebito',
        'masterCardDebi', 'eloDebito'
    ];
    checkboxes.forEach(checkbox => {
        checkbox.checked = debitTypes.includes(checkbox.value);
    });
    updateDisplay();
}

// Função para selecionar todos os checkboxes de Cartão Frotas
function selectFleetCheckboxes() {
    const fleetTypes = [
        'tefTicket',         // TEF - Ticket Log
        'redeFrota',         // Rede Frota Crédito
        'tefTruckPag',       // TEF - Truck Pag
        'tefAleloAuto',      // TEF - Alelo Auto
        'truckPagAbaste',    // Truck Pag Abaste
        'targetPay',         // Target Pay
        'redeSempre',        // Rede Sempre
        'repomAbasteci',     // Repom Abasteci
        'tefMaxiFrota',      // TEF - Maxi Frota
        'tefSodexoWiz',      // TEF - Sodexo Wiz
        'novoAbasteceAi',    // Novo Abastece AI
        'tefSouthAmer',      // TEF - South Amer
        'eFrete',            // E-Frete
        'ticketLog',         // Ticket Log
        'fleetcardCredito',  // Fleetcard Crédito
        'tefFitcardCr'       // TEF - Fitcard Cr
    ];
    
    checkboxes.forEach(checkbox => {
        checkbox.checked = fleetTypes.includes(checkbox.value);
    });
    updateDisplay();
}
 // Função para selecionar todos os checkboxes
        function selectAllCheckboxes() {
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
            });
            updateDisplay();
        }

        // Função para desmarcar todos os checkboxes
        function uncheckAllCheckboxes() {
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            updateDisplay();
        }


// Adicione esta função para calcular o índice dos selecionados
function calculateSelectedIndex() {
    const selectedTypes = checkboxes.filter(checkbox => checkbox.checked).map(checkbox => checkbox.value);
    const totalSelected = filteredData.reduce((sum, data) => {
        return sum + selectedTypes.reduce((typeSum, type) => typeSum + (data[type] || 0), 0);
    }, 0);
    
    const grandTotal = filteredData.reduce((sum, data) => sum + data.total, 0);
    // Garantir que totalSelected não exceda grandTotal
    const adjustedTotalSelected = Math.min(totalSelected, grandTotal);
    const percentage = grandTotal ? (adjustedTotalSelected / grandTotal * 100) : 0;
    
    return {
        totalSelected: adjustedTotalSelected,
        percentage
    };
}

// Atualize a função updateStats para incluir o índice
function updateStats() {
    statsCards.innerHTML = '';
    const selectedTypes = checkboxes.filter(checkbox => checkbox.checked).map(checkbox => checkbox.value);
    const grandTotal = filteredData.reduce((sum, data) => sum + data.total, 0);
    
    // Calcular o índice dos selecionados
    const selectedIndex = calculateSelectedIndex();

    // Card de Total de Vendas
    const totalCard = document.createElement('div');
    totalCard.className = 'stat-card';
    totalCard.innerHTML = `
        <div class="flex items-center justify-between">
            <div>
                <p class="text-sm font-medium text-gray-600">Total de Vendas</p>
                <p class="text-2xl font-bold text-gray-900">${formatarValor(grandTotal)}</p>
            </div>
            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                <i class="fas fa-dollar-sign text-blue-600 text-xl"></i>
            </div>
        </div>
    `;
    statsCards.appendChild(totalCard);

    // Card de Índice dos Selecionados (novo card)
    if (selectedTypes.length > 0) {
        const indexCard = document.createElement('div');
        indexCard.className = 'stat-card';
        indexCard.innerHTML = `
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-600">Índice dos Selecionados</p>
                    <p class="text-2xl font-bold text-gray-900">${selectedIndex.percentage.toFixed(2)}%</p>
                    <p class="text-xs text-gray-500">${formatarValor(selectedIndex.totalSelected)} de ${formatarValor(grandTotal)}</p>
                </div>
                <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                    <i class="fas fa-percentage text-green-600 text-xl"></i>
                </div>
            </div>
        `;
        statsCards.appendChild(indexCard);
    }

    // Cards individuais para cada tipo de pagamento selecionado
    selectedTypes.forEach(type => {
        const total = filteredData.reduce((sum, data) => sum + data[type], 0);
        const card = document.createElement('div');
        card.className = 'stat-card';
        card.innerHTML = `
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-600">${paymentTypes[type].label}</p>
                    <p class="text-2xl font-bold text-gray-900">${formatarValor(total)}</p>
                </div>
                <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                    <i class="fas ${paymentTypes[type].icon} text-blue-600 text-xl"></i>
                </div>
            </div>
        `;
        statsCards.appendChild(card);
    });
}
//// Elementos DOM do popup
const showPopupButton = document.getElementById('showPopupButton');
const closePopupButton = document.getElementById('closePopupButton');
const salesPopup = document.getElementById('salesPopup');
const volumeInput = document.getElementById('volumeInput');
const popupTotalSales = document.getElementById('popupTotalSales');
const popupSalesPercentage = document.getElementById('popupSalesPercentage');
const popupSelectedIndex = document.getElementById('popupSelectedIndex');
const popupSelectedTotal = document.getElementById('popupSelectedTotal');
const popupSelectedMethods = document.getElementById('popupSelectedMethods');

// Função para abrir o popup
showPopupButton.addEventListener('click', () => {
    salesPopup.classList.remove('hidden');
    updatePopupContent();
});

// Função para fechar o popup
closePopupButton.addEventListener('click', () => {
    salesPopup.classList.add('hidden');
});

// Fechar o popup ao clicar fora dele
salesPopup.addEventListener('click', (e) => {
    if (e.target === salesPopup) {
        salesPopup.classList.add('hidden');
    }
});


// Função para atualizar o conteúdo do popup
function updatePopupContent() {
    const grandTotal = filteredData.reduce((sum, data) => sum + data.total, 0);
    const selectedIndex = calculateSelectedIndex(); // Retorna { totalSelected, percentage }
    const selectedTypes = checkboxes.filter(checkbox => checkbox.checked).map(checkbox => checkbox.value);

    // Atualizar Total de Vendas
    popupTotalSales.textContent = formatarValor(grandTotal);

    // Obter Total de Volume de Vendas do localStorage e definir no input
    const totalVolumeVendas = parseFloat(localStorage.getItem('totalVolumeVendas')) || 0;
    volumeInput.value = totalVolumeVendas;

    // Calcular Valor de Média
    let valorMedia = totalVolumeVendas > 0 ? (grandTotal / totalVolumeVendas).toFixed(2) : 0;
    const valorMediaText = `Média: ${valorMedia} R$ / ${totalVolumeVendas} L`;
    popupSalesPercentage.textContent = valorMediaText;

    // Atualizar Índice dos Selecionados
    popupSelectedIndex.textContent = selectedIndex.percentage.toFixed(2) + '%';
    popupSelectedTotal.textContent = `${formatarValor(selectedIndex.totalSelected)} de ${formatarValor(grandTotal)}`;

    // Atualizar Métodos Selecionados
    popupSelectedMethods.innerHTML = selectedTypes.map(type => {
        const total = filteredData.reduce((sum, data) => sum + (data[type] || 0), 0);
        const percentage = grandTotal ? ((total / grandTotal) * 100).toFixed(2) : 0;
        return `<li>${paymentTypes[type].label}: <strong>${formatarValor(total)}</strong> (${percentage}%)</li>`;
    }).join('');

    // Atualizar Volume dos Selecionados
    let selectedVolumeElement = document.getElementById('popupSelectedVolume');
    if (!selectedVolumeElement) {
        selectedVolumeElement = document.createElement('p');
        selectedVolumeElement.id = 'popupSelectedVolume';
        selectedVolumeElement.className = 'text-sm text-gray-700 mt-2 popup-selected-volume';
        popupSelectedTotal.parentNode.appendChild(selectedVolumeElement);
    }

    const volume = parseBrazilianNumber(volumeInput.value);
    const selectedVolume = grandTotal ? (selectedIndex.totalSelected / grandTotal) * volume : 0;
    selectedVolumeElement.innerHTML = `<i class="fas fa-tint text-blue-600"></i> Volume dos Selecionados: ${formatarValor(selectedVolume)} litros`;

    // Campo para Valor Litros Negociados
    let negotiatedValueElement = document.getElementById('popupNegotiatedValue');
    let negotiatedInput, negotiatedAmountElement;

    if (!negotiatedValueElement) {
        negotiatedValueElement = document.createElement('div');
        negotiatedValueElement.id = 'popupNegotiatedValue';
        negotiatedValueElement.className = 'text-sm text-gray-700 mt-2 flex items-center gap-2';

        negotiatedInput = document.createElement('input');
        negotiatedInput.type = 'number';
        negotiatedInput.placeholder = 'Valor Litros Negociados';
        negotiatedInput.value = localStorage.getItem('negotiatedValue') || '';
        negotiatedInput.className = 'border rounded p-1 w-32';

        negotiatedAmountElement = document.createElement('p');
        negotiatedAmountElement.id = 'negotiatedAmount';
        negotiatedAmountElement.className = 'mt-1 flex items-center gap-2';

        // Botão de impressão
        const printButton = document.createElement('button');
        printButton.innerHTML = `<i class="fas fa-print text-blue-600"></i>`;
        printButton.className = 'ml-2 text-sm text-blue-600 hover:text-blue-800 focus:outline-none';
        printButton.title = 'Imprimir Detalhes de Vendas';
        printButton.onclick = printSalesDetails;

        negotiatedValueElement.appendChild(negotiatedInput);
        negotiatedValueElement.appendChild(negotiatedAmountElement);
        negotiatedValueElement.appendChild(printButton);

        popupSelectedTotal.parentNode.appendChild(negotiatedValueElement);
    } else {
        negotiatedInput = negotiatedValueElement.querySelector('input');
        negotiatedAmountElement = document.getElementById('negotiatedAmount');
    }

    // Função para calcular e atualizar o valor negociado e a porcentagem
    const updateNegotiatedAmount = () => {
        const negotiatedValue = parseFloat(negotiatedInput.value) || 0;
        localStorage.setItem('negotiatedValue', negotiatedValue);

        const negotiatedTotal = negotiatedValue * valorMedia;
        const percentage = selectedVolume > 0 ? (negotiatedValue / selectedVolume * 100).toFixed(2) : 0;
        negotiatedAmountElement.innerHTML = `<span class="font-semibold">R$ Valor do Negociado: ${formatarValor(negotiatedTotal)}</span> | <span class="text-green-600">%: ${percentage}%</span>`;
    };

    // Remover listener anterior, se existir
    if (negotiatedInput._inputHandler) {
        negotiatedInput.removeEventListener('input', negotiatedInput._inputHandler);
    }
    negotiatedInput._inputHandler = updateNegotiatedAmount;
    negotiatedInput.addEventListener('input', negotiatedInput._inputHandler);
    updateNegotiatedAmount();

    // Atualizar o localStorage e recalcular a média ao digitar no volume
    if (volumeInput._inputHandler) {
        volumeInput.removeEventListener('input', volumeInput._inputHandler);
    }
    volumeInput._inputHandler = () => {
        const newVolume = parseBrazilianNumber(volumeInput.value);
        localStorage.setItem('totalVolumeVendas', newVolume);
        
        valorMedia = newVolume > 0 ? (grandTotal / newVolume).toFixed(2) : 0;
        popupSalesPercentage.textContent = `Média: ${valorMedia} R$ / ${newVolume} L`;

        const newSelectedVolume = grandTotal ? (selectedIndex.totalSelected / grandTotal) * newVolume : 0;
        selectedVolumeElement.innerHTML = `<i class="fas fa-tint text-blue-600"></i> Volume dos Selecionados: ${formatarValor(newSelectedVolume)} litros`;

        updateNegotiatedAmount();
    };
    volumeInput.addEventListener('input', volumeInput._inputHandler);

    // Função para imprimir apenas os Detalhes de Vendas com o valor atual do input
  function printSalesDetails() {
    const grandTotal = filteredData.reduce((sum, data) => sum + data.total, 0);
    const selectedIndex = calculateSelectedIndex();
    const selectedTypes = checkboxes.filter(checkbox => checkbox.checked).map(checkbox => checkbox.value);
    const totalVolumeVendas = parseFloat(localStorage.getItem('totalVolumeVendas')) || 0;
    const valorMedia = totalVolumeVendas > 0 ? (grandTotal / totalVolumeVendas).toFixed(2) : 0;
    const selectedVolume = grandTotal ? (selectedIndex.totalSelected / grandTotal) * totalVolumeVendas : 0;
    const negotiatedValue = parseFloat(localStorage.getItem('negotiatedValue')) || 0;
    const negotiatedTotal = negotiatedValue * valorMedia;
    const negotiatedPercentage = selectedVolume > 0 ? (negotiatedValue / selectedVolume * 100).toFixed(2) : 0;

    // Criar o conteúdo para impressão
    const printContent = `
        <html>
            <head>
                <title>Detalhes de Vendas - Rede Dom Pedro</title>
                <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
                <style>
                    body {
                        font-family: 'Inter', Arial, sans-serif;
                        margin: 0;
                        padding: 20mm;
                        background: #f8fafc;
                        color: #374151;
                    }
                    @page {
                        size: A4;
                        margin: 15mm;
                    }
                    .print-container {
                        max-width: 100%;
                        background: white;
                        border-radius: 12px;
                        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
                        padding: 30px;
                        border: 1px solid rgba(255, 255, 255, 0.8);
                    }
                    .header {
                        text-align: center;
                        padding-bottom: 20px;
                        border-bottom: 2px solid #e2e8f0;
                        position: relative;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        border-radius: 12px 12px 0 0;
                        padding: 20px;
                        margin: -30px -30px 30px -30px;
                    }
                    .header h1 {
                        font-size: 28px;
                        font-weight: 700;
                        margin: 0;
                    }
                    .header p {
                        font-size: 14px;
                        opacity: 0.8;
                        margin: 5px 0 0;
                    }
                    .section {
                        margin-bottom: 25px;
                        padding: 20px;
                        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
                        border-radius: 8px;
                        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
                        border: 1px solid #e2e8f0;
                    }
                    .section-title {
                        font-size: 16px;
                        font-weight: 600;
                        color: #374151;
                        margin-bottom: 10px;
                        display: flex;
                        align-items: center;
                        gap: 8px;
                    }
                    .section-value {
                        font-size: 22px;
                        font-weight: 700;
                        color: #1f2937;
                    }
                    .section-subvalue {
                        font-size: 12px;
                        color: #6b7280;
                        margin-top: 5px;
                    }
                    .methods-list {
                        list-style: none;
                        padding: 0;
                        margin: 0;
                    }
                    .methods-list li {
                        font-size: 14px;
                        color: #374151;
                        margin-bottom: 8px;
                        display: flex;
                        align-items: center;
                        gap: 8px;
                    }
                    .methods-list li i {
                        color: #667eea;
                    }
                    .footer {
                        text-align: center;
                        font-size: 12px;
                        color: #6b7280;
                        margin-top: 30px;
                        padding-top: 20px;
                        border-top: 1px solid #e2e8f0;
                    }
                    .highlight {
                        color: #10b981;
                        font-weight: 600;
                    }
                    .icon {
                        color: #667eea;
                    }
                    @media print {
                        body {
                            background: white;
                            padding: 0;
                        }
                        .print-container {
                            box-shadow: none;
                            border: none;
                        }
                        .header {
                            -webkit-print-color-adjust: exact;
                            print-color-adjust: exact;
                        }
                        .section {
                            page-break-inside: avoid;
                        }
                    }
                </style>
            </head>
            <body>
                <div class="print-container">
                    <div class="header">
                        <h1>Detalhes de Vendas - Rede Dom Pedro</h1>
                        <p>Análise de Formas de Pagamento</p>
                    </div>
                    <div class="section">
                        <div class="section-title"><i class="fas fa-dollar-sign icon"></i>Total de Vendas</div>
                        <div class="section-value">${formatarValor(grandTotal)}</div>
                    </div>
                    <div class="section">
                        <div class="section-title"><i class="fas fa-tint icon"></i>Total de Volume de Vendas</div>
                        <div class="section-value">${formatarValor(totalVolumeVendas)} litros</div>
                    </div>
                    <div class="section">
                        <div class="section-title"><i class="fas fa-calculator icon"></i>Média</div>
                        <div class="section-value">${valorMedia} R$/L</div>
                    </div>
                    <div class="section">
                        <div class="section-title"><i class="fas fa-percentage icon"></i>Índice dos Selecionados</div>
                        <div class="section-value">${selectedIndex.percentage.toFixed(2)}%</div>
                        <div class="section-subvalue">${formatarValor(selectedIndex.totalSelected)} de ${formatarValor(grandTotal)}</div>
                    </div>
                    <div class="section">
                        <div class="section-title"><i class="fas fa-tint icon"></i>Volume dos Selecionados</div>
                        <div class="section-value">${formatarValor(selectedVolume)} litros</div>
                    </div>
                    <div class="section">
                        <div class="section-title"><i class="fas fa-handshake icon"></i>Valor Negociado</div>
                        <div class="section-value">${formatarValor(negotiatedTotal)}</div>
                        <div class="section-subvalue">${formatarValor(negotiatedValue)} litros <span class="highlight">(${negotiatedPercentage}%)</span></div>
                    </div>
                    <div class="section">
                        <div class="section-title"><i class="fas fa-list-ul icon"></i>Métodos Selecionados</div>
                        <ul class="methods-list">
                            ${selectedTypes.map(type => {
                                const total = filteredData.reduce((sum, data) => sum + (data[type] || 0), 0);
                                const percentage = grandTotal ? ((total / grandTotal) * 100).toFixed(2) : 0;
                                return `<li><i class="fas ${paymentTypes[type].icon}"></i>${paymentTypes[type].label}: <strong>${formatarValor(total)}</strong> <span class="highlight">(${percentage}%)</span></li>`;
                            }).join('')}
                        </ul>
                    </div>
                    <div class="footer">
                        Gerado em: ${new Date().toLocaleString('pt-BR')}
                    </div>
                </div>
            </body>
        </html>
    `;

    // Criar uma nova janela para impressão
    const printWindow = window.open('', '_blank');
    printWindow.document.write(printContent);
    printWindow.document.close();
    printWindow.print();
}
}   
    </script>
</body>
</html>
</xaiArtifact>

