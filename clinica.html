
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Fisio Cl√≠nica Dra Tha√≠s Xavier - Sistema Completo</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

* {
box-sizing: border-box;
margin: 0;
padding: 0;
}

body {
font-family: 'Poppins', sans-serif;
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
min-height: 100vh;
color: #2d3748;
}

header {
background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
color: white;
padding: 1.5rem;
text-align: center;
position: relative;
box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}

header::after {
content: '';
position: absolute;
bottom: -50px;
left: 0;
right: 0;
height: 50px;
background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
border-radius: 0 0 50% 50%;
}

.header-content {
display: flex;
flex-direction: column;
align-items: center;
gap: 1rem;
}

.logo-section {
display: flex;
flex-direction: column;
align-items: center;
gap: 0.5rem;
}

.logo-icon {
font-size: 3.5rem;
animation: pulse 2s infinite;
}

.fisio-icon {
display: flex;
align-items: center;
justify-content: center;
gap: 0.5rem;
font-size: 1.1rem;
margin-top: 0.5rem;
}

.fisio-icon i {
font-size: 1.8rem;
color: #fff;
background: rgba(255,255,255,0.2);
padding: 0.5rem;
border-radius: 50%;
}

@keyframes pulse {
0%, 100% { transform: scale(1); }
50% { transform: scale(1.1); }
}

.header-info {
display: flex;
flex-direction: column;
align-items: center;
gap: 0.5rem;
}

header h1 {
font-size: 1.8rem;
font-weight: 700;
text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
}

.contract-info {
font-size: 1rem;
font-weight: 600;
background: rgba(255,255,255,0.2);
padding: 0.5rem 1rem;
border-radius: 8px;
margin-top: 0.5rem;
}

.clock-container {
background: rgba(255,255,255,0.2);
backdrop-filter: blur(10px);
padding: 1rem 2rem;
border-radius: 15px;
margin-top: 1rem;
display: inline-block;
box-shadow: 0 8px 32px rgba(0,0,0,0.1);
}

.clock {
font-size: 2rem;
font-weight: 700;
display: flex;
align-items: center;
gap: 1rem;
}

.date-display {
font-size: 1.2rem;
margin-top: 0.5rem;
font-weight: 500;
}

main {
max-width: 1400px;
margin: 5rem auto 3rem;
background: white;
padding: 2.5rem;
border-radius: 20px;
box-shadow: 0 20px 60px rgba(0,0,0,0.3);
position: relative;
}

/* Menu de Navega√ß√£o */
.main-menu {
display: flex;
justify-content: center;
flex-wrap: wrap;
gap: 1rem;
margin: 2rem 0;
padding: 1.5rem;
background: white;
border-radius: 15px;
box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

.menu-btn {
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
width: 120px;
height: 100px;
background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
color: white;
border: none;
border-radius: 12px;
cursor: pointer;
transition: all 0.3s ease;
text-align: center;
padding: 1rem;
}

.menu-btn.active {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
transform: translateY(-5px);
box-shadow: 0 10px 20px rgba(0,0,0,0.3);
}

.menu-btn:hover {
transform: translateY(-5px);
box-shadow: 0 10px 20px rgba(0,0,0,0.2);
}

.menu-btn i {
font-size: 2rem;
margin-bottom: 0.5rem;
}

.menu-btn span {
font-size: 0.85rem;
font-weight: 600;
}

/* Se√ß√µes do formul√°rio */
.form-section {
display: none;
margin-bottom: 2rem;
}

.form-section.active {
display: block;
animation: fadeIn 0.5s ease;
}

.form-header {
display: flex;
align-items: center;
gap: 1rem;
margin-bottom: 2rem;
padding-bottom: 1rem;
border-bottom: 3px solid #4facfe;
}

.form-header i {
font-size: 2rem;
color: #4facfe;
}

.form-header h2 {
font-size: 1.8rem;
color: #2d3748;
}

/* Abas */
.tab-buttons {
display: flex;
flex-wrap: wrap;
gap: 0.5rem;
margin-bottom: 1.5rem;
border-bottom: 2px solid #e2e8f0;
}

.tab-btn {
background: #f7fafc;
border: none;
padding: 0.8rem 1.5rem;
border-radius: 8px 8px 0 0;
cursor: pointer;
font-weight: 600;
color: #4a5568;
transition: all 0.3s ease;
}

.tab-btn.active {
background: #4facfe;
color: white;
}

.tab-btn:hover:not(.active) {
background: #e2e8f0;
}

.tab-content {
display: none;
}

.tab-content.active {
display: block;
}

/* Formul√°rios */
form {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
gap: 1.5rem;
margin-bottom: 2rem;
}

.form-group {
position: relative;
}

.form-row {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 1rem;
margin-bottom: 1rem;
}

.textarea-group {
grid-column: 1 / -1;
}

label {
font-weight: 600;
margin-bottom: 0.5rem;
display: flex;
align-items: center;
gap: 0.5rem;
color: #4a5568;
font-size: 0.95rem;
}

label i {
color: #4facfe;
}

input, select, textarea {
width: 100%;
padding: 0.75rem 1rem;
padding-left: 2.5rem;
border: 2px solid #e2e8f0;
border-radius: 12px;
font-size: 1rem;
color: #2d3748;
background: #f7fafc;
transition: all 0.3s ease;
font-family: 'Poppins', sans-serif;
}

textarea {
min-height: 120px;
resize: vertical;
}

input:focus, select:focus, textarea:focus {
border-color: #4facfe;
background: white;
outline: none;
box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
transform: translateY(-2px);
}

.input-icon {
position: absolute;
left: 0.75rem;
top: 2.4rem;
color: #4facfe;
font-size: 1.1rem;
}

.form-actions {
grid-column: 1 / -1;
display: flex;
gap: 1rem;
justify-content: center;
margin-top: 1rem;
flex-wrap: wrap;
}

button {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
font-weight: 600;
padding: 0.9rem 2rem;
border: none;
border-radius: 12px;
cursor: pointer;
font-size: 1.05rem;
transition: all 0.3s ease;
display: flex;
align-items: center;
gap: 0.5rem;
box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
}

button:hover {
transform: translateY(-3px);
box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
}

button:active {
transform: translateY(-1px);
}

button:disabled {
background: #cbd5e0;
cursor: not-allowed;
box-shadow: none;
}

.btn-clear {
background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
}

.btn-print {
background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
}

.btn-continue {
background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
}

.btn-fatura {
background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
}

.btn-backup {
background: linear-gradient(135deg, #a78bfa 0%, #7e22ce 100%);
}

.btn-restore {
background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
}

.btn-consolidado {
background: linear-gradient(135deg, #06b6d4 0%, #0ea5e9 100%);
}

.btn-calendar {
background: linear-gradient(135deg, #10b981 0%, #059669 100%);
}

.btn-toggle {
background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
}

.btn-check {
background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
}

.btn-clear-sessions {
background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
}

/* Mensagens */
#message {
margin: 1rem 0;
padding: 1rem;
text-align: center;
font-weight: 600;
border-radius: 12px;
display: none;
animation: slideIn 0.3s ease;
}

@keyframes slideIn {
from { opacity: 0; transform: translateY(-10px); }
to { opacity: 1; transform: translateY(0); }
}

.message-success {
background: #c6f6d5;
color: #22543d;
border: 2px solid #9ae6b4;
display: block;
}

.message-error {
background: #fed7d7;
color: #742a2a;
border: 2px solid #fc8181;
display: block;
}

.message-warning {
background: #fef3c7;
color: #78350f;
border: 2px solid #fbbf24;
display: block;
}

/* Busca */
.search-container {
margin: 2rem 0;
position: relative;
}

#searchInput {
max-width: 400px;
padding-left: 3rem;
}

.search-icon {
position: absolute;
left: 1rem;
top: 50%;
transform: translateY(-50%);
color: #4facfe;
font-size: 1.2rem;
}

/* Tabelas */
.table-container {
overflow-x: auto;
border-radius: 12px;
box-shadow: 0 4px 20px rgba(0,0,0,0.08);
}

table {
width: 100%;
border-collapse: collapse;
}

th, td {
padding: 1rem;
text-align: left;
}

th {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
font-weight: 600;
text-transform: uppercase;
font-size: 0.85rem;
letter-spacing: 0.5px;
}

tbody tr {
border-bottom: 1px solid #e2e8f0;
transition: all 0.3s ease;
}

tbody tr:hover {
background: linear-gradient(90deg, #f0f9ff 0%, #e0f2fe 100%);
transform: scale(1.01);
box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.actions-cell {
text-align: center;
width: 120px;
}

.action-buttons {
display: flex;
gap: 0.5rem;
justify-content: center;
align-items: center;
}

.action-btn {
background: none;
border: none;
color: #4a5568;
cursor: pointer;
font-size: 1.1rem;
transition: all 0.3s ease;
padding: 0.3rem;
border-radius: 4px;
}

.action-btn:hover {
color: #4facfe;
transform: scale(1.2);
background: rgba(79, 172, 254, 0.1);
}

.edit-btn {
color: #f59e0b;
}

.edit-btn:hover {
color: #d97706;
}

.delete-btn {
color: #ef4444;
}

.delete-btn:hover {
color: #dc2626;
}

/* Painel de bot√µes */
.buttons-panel {
text-align: center;
margin: 2rem 0;
display: flex;
gap: 1rem;
justify-content: center;
flex-wrap: wrap;
}

/* Autocomplete */
.autocomplete {
position: relative;
}

.autocomplete-items {
position: absolute;
border: 2px solid #4facfe;
border-top: none;
z-index: 99;
top: 100%;
left: 0;
right: 0;
background: white;
max-height: 200px;
overflow-y: auto;
border-radius: 0 0 12px 12px;
box-shadow: 0 10px 25px rgba(0,0,0,0.1);
}

.autocomplete-items div {
padding: 12px;
cursor: pointer;
border-bottom: 1px solid #e2e8f0;
transition: all 0.2s;
}

.autocomplete-items div:hover {
background: #f0f9ff;
}

.autocomplete-active {
background: linear-gradient(90deg, #667eea 0%, #764ba2 100%) !important;
color: white !important;
}

/* Alertas de conflito */
.conflict-warning {
background: #fef3c7;
border: 2px solid #fbbf24;
color: #78350f;
padding: 1rem;
border-radius: 12px;
margin: 1rem 0;
display: none;
}

.conflict-warning.show {
display: block;
animation: shake 0.5s;
}

.conflict-details {
background: #fed7d7;
border: 2px solid #fc8181;
color: #742a2a;
padding: 1rem;
border-radius: 12px;
margin: 1rem 0;
display: none;
}

.conflict-details.show {
display: block;
}

.conflict-list {
margin-top: 0.5rem;
padding-left: 1.5rem;
}

.conflict-list li {
margin: 0.3rem 0;
padding: 0.3rem;
background: rgba(255,255,255,0.5);
border-radius: 4px;
}

@keyframes shake {
0%, 100% { transform: translateX(0); }
25% { transform: translateX(-10px); }
75% { transform: translateX(10px); }
}

/* Modais */
.modal {
display: none;
position: fixed;
z-index: 1000;
left: 0;
top: 0;
width: 100%;
height: 100%;
background-color: rgba(0,0,0,0.7);
animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
from { opacity: 0; }
to { opacity: 1; }
}

.modal-content {
background: white;
margin: 3% auto;
padding: 2rem;
border-radius: 20px;
width: 90%;
max-width: 900px;
max-height: 85vh;
overflow-y: auto;
box-shadow: 0 20px 60px rgba(0,0,0,0.4);
animation: slideDown 0.3s ease;
}

@keyframes slideDown {
from { transform: translateY(-50px); opacity: 0; }
to { transform: translateY(0); opacity: 1; }
}

.modal-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 2rem;
padding-bottom: 1rem;
border-bottom: 3px solid #4facfe;
}

.modal-header h2 {
display: flex;
align-items: center;
gap: 1rem;
color: #2d3748;
}

.close {
color: #aaa;
font-size: 2rem;
font-weight: bold;
cursor: pointer;
transition: color 0.3s;
}

.close:hover {
color: #000;
}

/* Calend√°rio */
.calendar-section {
margin: 2rem 0;
}

.calendar-container {
background: white;
border-radius: 12px;
padding: 1.5rem;
box-shadow: 0 4px 20px rgba(0,0,0,0.08);
margin-bottom: 1rem;
}

.calendar-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 1rem;
padding-bottom: 1rem;
border-bottom: 2px solid #e2e8f0;
}

.calendar-title {
display: flex;
align-items: center;
gap: 1rem;
}

.calendar-actions {
display: flex;
gap: 1rem;
}

.calendar-grid {
display: grid;
grid-template-columns: repeat(7, 1fr);
gap: 5px;
}

.calendar-day-header {
text-align: center;
font-weight: 600;
padding: 0.8rem 0.5rem;
border-radius: 8px;
font-size: 0.85rem;
font-weight: bold;
}

.calendar-day-header:nth-child(1) { /* Dom */
background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
color: white;
}

.calendar-day-header:nth-child(2) { /* Seg */
background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
color: white;
}

.calendar-day-header:nth-child(3) { /* Ter */
background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
color: white;
}

.calendar-day-header:nth-child(4) { /* Qua */
background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
color: white;
}

.calendar-day-header:nth-child(5) { /* Qui */
background: linear-gradient(135deg, #a78bfa 0%, #7e22ce 100%);
color: white;
}

.calendar-day-header:nth-child(6) { /* Sex */
background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
color: white;
}

.calendar-day-header:nth-child(7) { /* S√°b */
background: linear-gradient(135deg, #06b6d4 0%, #0ea5e9 100%);
color: white;
}

.calendar-day {
min-height: 100px;
border: 1px solid #e2e8f0;
padding: 5px;
overflow-y: auto;
cursor: pointer;
transition: all 0.2s;
border-radius: 8px;
position: relative;
background: white;
}

.calendar-day:hover {
background: #f0f9ff;
transform: translateY(-2px);
box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.calendar-day.empty {
background: #f7fafc;
cursor: default;
}

.calendar-day.today {
background: #e6fffa;
border: 2px solid #38b2ac;
}

.calendar-day.has-sessions {
background: #ebf8ff;
border: 1px solid #4facfe;
}

.calendar-day.conflict {
background: #fed7d7;
border: 2px solid #fc8181;
}

.calendar-day.saturday {
background: #e0f2fe;
border: 1px solid #4facfe;
}

.calendar-day.sunday {
background: #ffe4e6;
border: 1px solid #fb7185;
}

.calendar-day.holiday {
background: #fef3c7;
border: 2px solid #f59e0b;
}

.calendar-session {
font-size: 0.7rem;
margin-bottom: 2px;
padding: 3px 5px;
border-radius: 4px;
color: white;
display: flex;
justify-content: space-between;
align-items: center;
}

.calendar-session:nth-child(odd) {
background: #4facfe;
}

.calendar-session:nth-child(even) {
background: #667eea;
}

.calendar-session.conflict {
background: #fc8181;
}

.session-time {
font-weight: bold;
font-size: 0.6rem;
}

.session-patient {
flex: 1;
text-align: center;
font-size: 0.65rem;
}

.session-count {
position: absolute;
top: 2px;
right: 5px;
font-size: 0.7rem;
background: #4facfe;
color: white;
border-radius: 50%;
width: 18px;
height: 18px;
display: flex;
align-items: center;
justify-content: center;
}

.conflict-count {
background: #fc8181;
}

.day-number {
font-weight: bold;
font-size: 0.9rem;
margin-bottom: 3px;
}

.calendar-info {
display: flex;
justify-content: space-between;
align-items: center;
margin-top: 1rem;
padding: 1rem;
background: #f8fafc;
border-radius: 8px;
border-left: 4px solid #8b5cf6;
}

.moon-phase {
display: flex;
align-items: center;
gap: 0.5rem;
font-size: 0.9rem;
color: #4a5568;
}

.holidays-info {
display: flex;
align-items: center;
gap: 0.5rem;
font-size: 0.9rem;
color: #4a5568;
}

/* Upload de foto */
.photo-upload {
display: flex;
flex-direction: column;
align-items: center;
gap: 1rem;
margin: 1rem 0;
}

.photo-preview {
width: 150px;
height: 150px;
border: 2px dashed #4facfe;
border-radius: 8px;
display: flex;
align-items: center;
justify-content: center;
overflow: hidden;
background: #f7fafc;
}

.photo-preview img {
max-width: 100%;
max-height: 100%;
object-fit: cover;
}

.photo-placeholder {
text-align: center;
color: #718096;
}

/* Campos de pagamento */
.payment-fields {
background: #f0f9ff;
padding: 1.5rem;
border-radius: 12px;
border-left: 4px solid #4facfe;
margin: 1rem 0;
}

.payment-summary {
background: #e6fffa;
padding: 1rem;
border-radius: 8px;
margin-top: 1rem;
border: 1px solid #38b2ac;
}

/* Indicador de assinatura */
.signature-indicator {
display: flex;
align-items: center;
justify-content: center;
gap: 0.5rem;
margin-top: 0.5rem;
font-size: 0.8rem;
color: #4a5568;
}

/* Navega√ß√£o */
.navigation-buttons {
position: fixed;
left: 20px;
top: 50%;
transform: translateY(-50%);
display: flex;
flex-direction: column;
gap: 1rem;
z-index: 100;
}

.nav-btn {
background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
color: white;
border: none;
border-radius: 8px;
padding: 0.8rem 1.5rem;
display: flex;
align-items: center;
gap: 0.5rem;
cursor: pointer;
font-size: 1rem;
transition: all 0.3s ease;
box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
}

.nav-btn:hover {
transform: translateY(-3px);
box-shadow: 0 6px 20px rgba(79, 172, 254, 0.6);
}

/* Footer */
footer {
background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
color: white;
padding: 2rem;
text-align: center;
margin-top: 3rem;
}

/* √Årea de impress√£o */
#printArea {
display: none;
}

.print-curve {
height: 30px;
background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
margin: -20px -20px 20px -20px;
border-radius: 0 0 50% 50%;
}

.print-header {
display: flex;
justify-content: space-between;
align-items: flex-start;
border-bottom: 3px solid #000;
padding-bottom: 15px;
margin-bottom: 20px;
}

.print-logo-section {
display: flex;
flex-direction: column;
align-items: flex-start;
}

.print-logo {
display: flex;
align-items: center;
gap: 10px;
margin-bottom: 5px;
}

.print-clinic-name {
font-size: 18pt;
font-weight: bold;
color: #000;
}

.print-info-section {
text-align: right;
font-size: 10pt;
}

.print-info-section div {
margin: 3px 0;
}

#printTable {
width: 100%;
border-collapse: collapse;
margin: 20px 0;
font-size: 10pt;
}

#printTable th,
#printTable td {
border: 1.5px solid #000;
padding: 8px;
text-align: left;
}

#printTable th {
background: #e0e0e0;
font-weight: bold;
}

.printSignatureSpace {
height: 40px;
background: #f5f5f5;
}

.print-footer {
text-align: center;
font-size: 9pt;
padding-top: 15px;
border-top: 2px solid #000;
margin-top: 30px;
}

/* Assinatura personalizada */
.assinatura-personalizada {
text-align: center;
margin-top: 3rem;
}

.carimbo-container {
position: relative;
display: inline-block;
margin-bottom: 1rem;
}

.carimbo-img {
max-height: 80px;
transform: rotate(-5deg);
opacity: 0.9;
}

.linha-assinatura {
border-top: 1px solid #000;
width: 300px;
margin: 0 auto;
padding-top: 10px;
}

.nome-fisioterapeuta {
font-weight: bold;
margin-top: 5px;
}

/* Responsividade */
@media (max-width: 768px) {
header h1 {
font-size: 1.5rem;
}

.clock {
font-size: 1.5rem;
}

form {
grid-template-columns: 1fr;
}

main {
margin: 3rem 1rem;
padding: 1.5rem;
}

.buttons-panel {
flex-direction: column;
}

.modal-content {
width: 95%;
margin: 5% auto;
padding: 1.5rem;
}

.calendar-grid {
grid-template-columns: repeat(7, 1fr);
}

.calendar-day {
min-height: 80px;
font-size: 0.7rem;
}

.calendar-header {
flex-direction: column;
gap: 1rem;
align-items: flex-start;
}

.calendar-actions {
width: 100%;
justify-content: center;
}

.calendar-info {
flex-direction: column;
gap: 1rem;
align-items: flex-start;
}

.navigation-buttons {
position: static;
transform: none;
flex-direction: row;
justify-content: center;
margin: 1rem 0;
}

.nav-btn {
padding: 0.6rem 1rem;
font-size: 0.9rem;
}

.main-menu {
flex-direction: column;
align-items: center;
}

.menu-btn {
width: 100%;
max-width: 200px;
}

.form-row {
grid-template-columns: 1fr;
}
}

@media print {
body {
background: white !important;
}
 
header, footer, #form-section, #searchInput, .buttons-panel, .edit-button, .delete-button, .search-container, main, .backup-section, .patients-section, .calendar-actions, .calendar-info, .navigation-buttons, .main-menu {
display: none !important;
}

#printArea {
display: block !important;
width: 100%;
margin: 0;
padding: 20px;
font-family: Arial, sans-serif;
}

@page {
size: portrait;
margin: 1cm;
}
}
</style>
</head>
<body>

<header>
<div class="header-content">
<div class="logo-section">
<i class="fas fa-hands-helping logo-icon"></i>
<div class="header-info">
<h1>Fisio Cl√≠nica Dra Tha√≠s Xavier</h1>
<div class="fisio-icon">
<i class="fas fa-bone"></i>
<span>Especializada em Fisioterapia</span>
</div>
</div>
</div>
</div>
<div class="clock-container">
<div class="clock">
<i class="far fa-clock"></i>
<span id="clockTime">00:00:00</span>
</div>
<div class="date-display" id="dateDisplay">00/00/0000</div>
</div>
</header>

<main>
<!-- Menu Principal de Navega√ß√£o -->
<section class="main-menu">
<button class="menu-btn active" onclick="showSection('session-section')">
<i class="fas fa-calendar-plus"></i>
<span>Agendar Sess√£o</span>
</button>
<button class="menu-btn" onclick="showSection('patients-section')">
<i class="fas fa-users"></i>
<span>Pacientes</span>
</button>
<button class="menu-btn" onclick="showSection('anamnese-section')">
<i class="fas fa-file-medical"></i>
<span>Anamnese</span>
</button>
<button class="menu-btn" onclick="showSection('payment-section')">
<i class="fas fa-money-bill-wave"></i>
<span>Pagamentos</span>
</button>
<button class="menu-btn" onclick="showSection('reports-section')">
<i class="fas fa-chart-bar"></i>
<span>Relat√≥rios</span>
</button>
<button class="menu-btn" onclick="showSection('documents-section')">
<i class="fas fa-file-contract"></i>
<span>Documentos</span>
</button>
</section>

<!-- Se√ß√£o de Agendamento de Sess√µes -->
<section id="session-section" class="form-section active">
<div class="form-header">
<i class="fas fa-calendar-plus"></i>
<h2>Agendamento de Sess√µes</h2>
</div>

<div class="tab-buttons">
<button class="tab-btn active" onclick="showTab('agendamento-tab')">Agendamento</button>
<button class="tab-btn" onclick="showTab('paciente-tab')">Dados do Paciente</button>
</div>

<div id="agendamento-tab" class="tab-content active">
<form id="sessionForm" autocomplete="off">
<div class="form-row">
<div class="form-group">
<label for="inputDia">
<i class="fas fa-calendar-day"></i>
Dia da Sess√£o
</label>
<i class="fas fa-calendar-alt input-icon"></i>
<input type="date" id="inputDia" name="dia" required />
</div>
<div class="form-group">
<label for="inputHorario">
<i class="fas fa-clock"></i>
Hor√°rio
</label>
<i class="far fa-clock input-icon"></i>
<input type="time" id="inputHorario" name="horario" required />
</div>
<div class="form-group autocomplete">
<label for="inputNome">
<i class="fas fa-user"></i>
Nome do Paciente
</label>
<i class="fas fa-user-circle input-icon"></i>
<input type="text" id="inputNome" name="nome" required minlength="2" autocomplete="off" />
</div>
</div>

<div class="form-row">
<div class="form-group">
<label for="inputTipo">
<i class="fas fa-map-marker-alt"></i>
Tipo de Atendimento
</label>
<i class="fas fa-hospital input-icon"></i>
<select id="inputTipo" name="tipo" required>
<option value="Particular">Particular</option>
<option value="Prefeitura">Prefeitura</option>
</select>
</div>
<div class="form-group">
<label for="inputSessoesSolicitadas">
<i class="fas fa-list-ol"></i>
Quant. Sess√µes Solicitadas
</label>
<i class="fas fa-hashtag input-icon"></i>
<input type="number" id="inputSessoesSolicitadas" name="sessoesSolicitadas" min="1" value="10" />
</div>
<div class="form-group">
<label for="inputSessoesLiberadas">
<i class="fas fa-list-ol"></i>
Quant. Sess√µes Liberadas
</label>
<i class="fas fa-hashtag input-icon"></i>
<input type="number" id="inputSessoesLiberadas" name="sessoesLiberadas" min="1" value="0" disabled />
</div>
</div>

<div class="form-row">
<div class="form-group">
<label for="inputMes">
<i class="fas fa-calendar"></i>
M√™s de Refer√™ncia
</label>
<i class="far fa-calendar input-icon"></i>
<select id="inputMes" name="mes" required>
<option value="" disabled selected>Selecione o m√™s</option>
<option value="Janeiro">Janeiro</option>
<option value="Fevereiro">Fevereiro</option>
<option value="Mar√ßo">Mar√ßo</option>
<option value="Abril">Abril</option>
<option value="Maio">Maio</option>
<option value="Junho">Junho</option>
<option value="Julho">Julho</option>
<option value="Agosto">Agosto</option>
<option value="Setembro">Setembro</option>
<option value="Outubro">Outubro</option>
<option value="Novembro">Novembro</option>
<option value="Dezembro">Dezembro</option>
</select>
</div>
<div class="form-group">
<label for="inputValorSessao">
<i class="fas fa-money-bill-wave"></i>
Valor por Sess√£o (R$)
</label>
<i class="fas fa-dollar-sign input-icon"></i>
<input type="number" id="inputValorSessao" name="valorSessao" step="0.01" min="0" placeholder="0,00" />
</div>
</div>

<input type="hidden" id="editIndex" value="-1" />
<div class="form-actions">
<button type="submit" id="btnSave">
<i class="fas fa-save"></i>
Cadastrar Sess√£o
</button>
<button type="button" id="btnContinue" class="btn-continue">
<i class="fas fa-plus-circle"></i>
Cadastro Cont√≠nuo (+9 datas)
</button>
<button type="button" id="btnClear" class="btn-clear">
<i class="fas fa-trash-alt"></i>
Limpar Tudo
</button>
</div>
</form>

<div id="conflictAlert" class="conflict-details">
<strong><i class="fas fa-exclamation-triangle"></i> CONFLITO DE HOR√ÅRIO DETECTADO!</strong>
<p>J√° existem pacientes agendados neste mesmo dia e hor√°rio:</p>
<ul id="conflictList" class="conflict-list">
</ul>
<p>Por favor, escolha outro hor√°rio ou data.</p>
</div>

<div id="message"></div>
</div>

<div id="paciente-tab" class="tab-content">
<form id="patientForm">
<div class="form-row">
<div class="form-group autocomplete">
<label for="inputPacienteNome">
<i class="fas fa-user"></i>
Nome do Paciente
</label>
<i class="fas fa-user-circle input-icon"></i>
<input type="text" id="inputPacienteNome" name="pacienteNome" required minlength="2" autocomplete="off" />
</div>
<div class="form-group">
<label for="inputPacienteTelefone">
<i class="fas fa-phone"></i>
Telefone
</label>
<i class="fas fa-phone input-icon"></i>
<input type="tel" id="inputPacienteTelefone" name="pacienteTelefone" placeholder="(00) 00000-0000" />
</div>
</div>

<div class="form-row">
<div class="form-group">
<label for="inputPacienteCidade">
<i class="fas fa-city"></i>
Cidade
</label>
<i class="fas fa-map-marker-alt input-icon"></i>
<input type="text" id="inputPacienteCidade" name="pacienteCidade" />
</div>
<div class="form-group">
<label for="inputPacienteBairro">
<i class="fas fa-map-pin"></i>
Bairro
</label>
<i class="fas fa-location-dot input-icon"></i>
<input type="text" id="inputPacienteBairro" name="pacienteBairro" />
</div>
</div>

<div class="form-actions">
<button type="submit" id="btnSavePaciente">
<i class="fas fa-save"></i>
Salvar Dados do Paciente
</button>
</div>
</form>
</div>
</section>

<!-- Se√ß√£o de Pacientes -->
<section id="patients-section" class="form-section">
<div class="form-header">
<i class="fas fa-users"></i>
<h2>Gest√£o de Pacientes</h2>
</div>

<div class="search-container">
<i class="fas fa-search search-icon"></i>
<input type="text" id="searchPaciente" placeholder="üîç Buscar paciente..." />
</div>

<div class="table-container">
<table id="patientsTable">
<thead>
<tr>
<th>Nome</th>
<th>Telefone</th>
<th>Cidade</th>
<th>Bairro</th>
<th>Sess√µes Realizadas</th>
<th>A√ß√µes</th>
</tr>
</thead>
<tbody id="patientsTableBody">
</tbody>
</table>
</div>
</section>

<!-- Se√ß√£o de Anamnese -->
<section id="anamnese-section" class="form-section">
<div class="form-header">
<i class="fas fa-file-medical"></i>
<h2>Ficha de Anamnese</h2>
</div>

<div class="search-container">
<i class="fas fa-search search-icon"></i>
<input type="text" id="searchPacienteAnamnese" placeholder="üîç Buscar paciente para anamnese..." />
</div>

<form id="anamneseForm">
<div class="form-row">
<div class="form-group autocomplete">
<label for="inputAnamnesePaciente">
<i class="fas fa-user"></i>
Paciente
</label>
<i class="fas fa-user-circle input-icon"></i>
<input type="text" id="inputAnamnesePaciente" name="anamnesePaciente" required minlength="2" autocomplete="off" />
</div>
</div>

<div class="photo-upload">
<div class="photo-preview" id="photoPreview">
<div class="photo-placeholder">
<i class="fas fa-camera"></i>
<p>Foto do Paciente</p>
</div>
</div>
<input type="file" id="inputFotoPaciente" accept="image/png" style="display: none;" />
<button type="button" id="btnSelectPhoto" class="btn-print">
<i class="fas fa-upload"></i>
Selecionar Foto
</button>
</div>

<div class="form-row">
<div class="form-group textarea-group">
<label for="inputMedicamentos">
<i class="fas fa-pills"></i>
Medicamentos em Uso
</label>
<textarea id="inputMedicamentos" name="medicamentos" placeholder="Liste os medicamentos que o paciente utiliza..."></textarea>
</div>
</div>

<div class="form-row">
<div class="form-group textarea-group">
<label for="inputQueixaPrincipal">
<i class="fas fa-stethoscope"></i>
Queixa Principal
</label>
<textarea id="inputQueixaPrincipal" name="queixaPrincipal" placeholder="Descreva a queixa principal do paciente..."></textarea>
</div>
</div>

<div class="form-row">
<div class="form-group textarea-group">
<label for="inputHistoricoDoenca">
<i class="fas fa-history"></i>
Hist√≥rico da Doen√ßa
</label>
<textarea id="inputHistoricoDoenca" name="historicoDoenca" placeholder="Descreva o hist√≥rico da doen√ßa..."></textarea>
</div>
</div>

<div class="form-row">
<div class="form-group textarea-group">
<label for="inputExameFisico">
<i class="fas fa-heartbeat"></i>
Exame F√≠sico
</label>
<textarea id="inputExameFisico" name="exameFisico" placeholder="Descreva os achados do exame f√≠sico..."></textarea>
</div>
</div>

<div class="form-actions">
<button type="button" id="btnPrintAnamnese" class="btn-print">
<i class="fas fa-print"></i>
Imprimir Anamnese
</button>
<button type="submit" id="btnSaveAnamnese">
<i class="fas fa-save"></i>
Salvar Anamnese
</button>
<button type="button" id="btnUpdateAnamnese" class="btn-continue" style="display:none;">
<i class="fas fa-sync-alt"></i>
Atualizar Anamnese
</button>
</div>
</form>

<div class="table-container" style="margin-top: 2rem;">
<table id="anamnesesTable">
<thead>
<tr>
<th>Paciente</th>
<th>Data</th>
<th>A√ß√µes</th>
</tr>
</thead>
<tbody id="anamnesesTableBody">
</tbody>
</table>
</div>
</section>

<!-- Se√ß√£o de Pagamentos -->
<section id="payment-section" class="form-section">
<div class="form-header">
<i class="fas fa-money-bill-wave"></i>
<h2>Gest√£o de Pagamentos</h2>
</div>

<div class="search-container">
<i class="fas fa-search search-icon"></i>
<input type="text" id="searchPacientePagamento" placeholder="üîç Buscar paciente para pagamento..." />
</div>

<form id="paymentForm">
<div class="form-row">
<div class="form-group autocomplete">
<label for="inputPagamentoPaciente">
<i class="fas fa-user"></i>
Paciente
</label>
<i class="fas fa-user-circle input-icon"></i>
<input type="text" id="inputPagamentoPaciente" name="pagamentoPaciente" required minlength="2" autocomplete="off" />
</div>
<div class="form-group">
<label for="inputPagamentoData">
<i class="fas fa-calendar-day"></i>
Data do Pagamento
</label>
<i class="fas fa-calendar-alt input-icon"></i>
<input type="date" id="inputPagamentoData" name="pagamentoData" required />
</div>
</div>

<div class="form-row">
<div class="form-group">
<label for="inputSessoesPagamento">
<i class="fas fa-list-ol"></i>
Sess√µes Pagas
</label>
<i class="fas fa-hashtag input-icon"></i>
<input type="number" id="inputSessoesPagamento" name="sessoesPagamento" min="1" value="1" />
</div>
<div class="form-group">
<label for="inputValorSessaoPagamento">
<i class="fas fa-money-bill-wave"></i>
Valor por Sess√£o (R$)
</label>
<i class="fas fa-dollar-sign input-icon"></i>
<input type="number" id="inputValorSessaoPagamento" name="valorSessaoPagamento" step="0.01" min="0" placeholder="0,00" required />
</div>
</div>

<div class="payment-fields">
<div class="form-row">
<div class="form-group">
<label for="inputMeioPagamento">
<i class="fas fa-credit-card"></i>
Meio de Pagamento
</label>
<i class="fas fa-wallet input-icon"></i>
<select id="inputMeioPagamento" name="meioPagamento" required>
<option value="Pix">Pix</option>
<option value="Dinheiro">Dinheiro</option>
<option value="Cart√£o D√©bito">Cart√£o D√©bito</option>
<option value="Cart√£o Cr√©dito">Cart√£o Cr√©dito</option>
<option value="Transfer√™ncia">Transfer√™ncia</option>
</select>
</div>
<div class="form-group">
<label for="inputDesconto">
<i class="fas fa-percentage"></i>
Desconto (R$)
</label>
<i class="fas fa-tag input-icon"></i>
<input type="number" id="inputDesconto" name="desconto" step="0.01" min="0" placeholder="0,00" value="0" />
</div>
</div>

<div class="form-row">
<div class="form-group">
<label for="inputNumeroNF">
<i class="fas fa-file-invoice"></i>
N√∫mero da NF
</label>
<i class="fas fa-hashtag input-icon"></i>
<input type="text" id="inputNumeroNF" name="numeroNF" placeholder="N√∫mero da nota fiscal" />
</div>
<div class="form-group textarea-group">
<label for="inputObservacaoPagamento">
<i class="fas fa-sticky-note"></i>
Observa√ß√£o
</label>
<textarea id="inputObservacaoPagamento" name="observacaoPagamento" placeholder="Observa√ß√µes sobre o pagamento..."></textarea>
</div>
</div>

<div class="payment-summary">
<div class="fatura-row">
<span>Subtotal:</span>
<span id="pagamentoSubtotal">R$ 0,00</span>
</div>
<div class="fatura-row">
<span>Desconto:</span>
<span id="pagamentoDesconto">R$ 0,00</span>
</div>
<div class="fatura-row">
<span>Total:</span>
<span id="pagamentoTotal">R$ 0,00</span>
</div>
</div>
</div>

<div class="form-actions">
<button type="submit" id="btnRegistrarPagamento">
<i class="fas fa-save"></i>
Registrar Pagamento
</button>
<button type="button" id="btnLimparPagamento" class="btn-clear">
<i class="fas fa-trash-alt"></i>
Limpar
</button>
</div>
</form>

<div class="table-container">
<table id="paymentsTable">
<thead>
<tr>
<th>Data</th>
<th>Paciente</th>
<th>Sess√µes</th>
<th>Valor Unit.</th>
<th>Desconto</th>
<th>Total</th>
<th>Meio</th>
<th>NF</th>
<th>A√ß√µes</th>
</tr>
</thead>
<tbody id="paymentsTableBody">
</tbody>
</table>
</div>
</section>

<!-- Se√ß√£o de Documentos (Atestados e Cartas) -->
<section id="documents-section" class="form-section">
<div class="form-header">
<i class="fas fa-file-contract"></i>
<h2>Documentos</h2>
</div>

<div class="tab-buttons">
<button class="tab-btn active" onclick="showDocTab('atestado-tab')">Atestados</button>
<button class="tab-btn" onclick="showDocTab('carta-tab')">Carta ao M√©dico</button>
</div>

<!-- Subse√ß√£o de Atestados -->
<div id="atestado-tab" class="tab-content active">
<form id="atestadoForm">
<div class="form-row">
<div class="form-group autocomplete">
<label for="inputAtestadoPaciente">
<i class="fas fa-user"></i>
Paciente
</label>
<i class="fas fa-user-circle input-icon"></i>
<input type="text" id="inputAtestadoPaciente" name="atestadoPaciente" required minlength="2" autocomplete="off" />
</div>
<div class="form-group">
<label for="inputAtestadoTipo">
<i class="fas fa-calendar"></i>
Tipo de Atestado
</label>
<i class="fas fa-file-medical input-icon"></i>
<select id="inputAtestadoTipo" name="atestadoTipo" required>
<option value="horario">Por Hor√°rio</option>
<option value="dia">Por Dia</option>
</select>
</div>
</div>

<div class="form-row" id="atestadoHorarioFields">
<div class="form-group">
<label for="inputAtestadoData">
<i class="fas fa-calendar-day"></i>
Data do Atestado
</label>
<i class="fas fa-calendar-alt input-icon"></i>
<input type="date" id="inputAtestadoData" name="atestadoData" required />
</div>
<div class="form-group">
<label for="inputAtestadoHorarioInicio">
<i class="fas fa-clock"></i>
Hor√°rio In√≠cio
</label>
<i class="far fa-clock input-icon"></i>
<input type="time" id="inputAtestadoHorarioInicio" name="atestadoHorarioInicio" />
</div>
<div class="form-group">
<label for="inputAtestadoHorarioFim">
<i class="fas fa-clock"></i>
Hor√°rio Fim
</label>
<i class="far fa-clock input-icon"></i>
<input type="time" id="inputAtestadoHorarioFim" name="atestadoHorarioFim" />
</div>
</div>

<div class="form-row" id="atestadoDiaFields" style="display: none;">
<div class="form-group">
<label for="inputAtestadoDataInicio">
<i class="fas fa-calendar-day"></i>
Data In√≠cio
</label>
<i class="fas fa-calendar-alt input-icon"></i>
<input type="date" id="inputAtestadoDataInicio" name="atestadoDataInicio" />
</div>
<div class="form-group">
<label for="inputAtestadoDataFim">
<i class="fas fa-calendar-day"></i>
Data Fim
</label>
<i class="fas fa-calendar-alt input-icon"></i>
<input type="date" id="inputAtestadoDataFim" name="atestadoDataFim" />
</div>
</div>

<div class="form-row">
<div class="form-group textarea-group">
<label for="inputAtestadoSituacao">
<i class="fas fa-stethoscope"></i>
Situa√ß√£o do Paciente
</label>
<textarea id="inputAtestadoSituacao" name="atestadoSituacao" placeholder="Descreva a situa√ß√£o do paciente..."></textarea>
</div>
</div>

<div class="form-actions">
<button type="button" id="btnPrintAtestado" class="btn-print">
<i class="fas fa-print"></i>
Imprimir Atestado
</button>
<button type="submit" id="btnSaveAtestado">
<i class="fas fa-save"></i>
Salvar Atestado
</button>
<button type="button" id="btnUpdateAtestado" class="btn-continue" style="display:none;">
<i class="fas fa-sync-alt"></i>
Atualizar Atestado
</button>
</div>
</form>

<div class="table-container" style="margin-top: 2rem;">
<table id="atestadosTable">
<thead>
<tr>
<th>Paciente</th>
<th>Tipo</th>
<th>Data</th>
<th>A√ß√µes</th>
</tr>
</thead>
<tbody id="atestadosTableBody">
</tbody>
</table>
</div>
</div>

<!-- Subse√ß√£o de Carta ao M√©dico -->
<div id="carta-tab" class="tab-content">
<form id="cartaForm">
<div class="form-row">
<div class="form-group autocomplete">
<label for="inputCartaPaciente">
<i class="fas fa-user"></i>
Paciente
</label>
<i class="fas fa-user-circle input-icon"></i>
<input type="text" id="inputCartaPaciente" name="cartaPaciente" required minlength="2" autocomplete="off" />
</div>
<div class="form-group">
<label for="inputCartaMedico">
<i class="fas fa-user-md"></i>
M√©dico Destinat√°rio
</label>
<i class="fas fa-user-md input-icon"></i>
<input type="text" id="inputCartaMedico" name="cartaMedico" placeholder="Dr. Nome do M√©dico" />
</div>
</div>

<div class="form-row">
<div class="form-group textarea-group">
<label for="inputCartaTratamento">
<i class="fas fa-stethoscope"></i>
Tratamento Realizado
</label>
<textarea id="inputCartaTratamento" name="cartaTratamento" placeholder="Descreva o tratamento realizado..."></textarea>
</div>
</div>

<div class="form-row">
<div class="form-group textarea-group">
<label for="inputCartaEvolucao">
<i class="fas fa-chart-line"></i>
Evolu√ß√£o do Paciente
</label>
<textarea id="inputCartaEvolucao" name="cartaEvolucao" placeholder="Descreva a evolu√ß√£o do paciente ap√≥s o tratamento..."></textarea>
</div>
</div>

<div class="form-row">
<div class="form-group">
<label for="inputCartaSessoes">
<i class="fas fa-list-ol"></i>
Sess√µes Realizadas
</label>
<i class="fas fa-hashtag input-icon"></i>
<input type="number" id="inputCartaSessoes" name="cartaSessoes" min="1" value="1" />
</div>
</div>

<div class="form-actions">
<button type="button" id="btnPrintCarta" class="btn-print">
<i class="fas fa-print"></i>
Imprimir Carta
</button>
<button type="submit" id="btnSaveCarta">
<i class="fas fa-save"></i>
Salvar Carta
</button>
<button type="button" id="btnUpdateCarta" class="btn-continue" style="display:none;">
<i class="fas fa-sync-alt"></i>
Atualizar Carta
</button>
</div>
</form>

<div class="table-container" style="margin-top: 2rem;">
<table id="cartasTable">
<thead>
<tr>
<th>Paciente</th>
<th>M√©dico</th>
<th>Data</th>
<th>A√ß√µes</th>
</tr>
</thead>
<tbody id="cartasTableBody">
</tbody>
</table>
</div>
</div>
</section>

<!-- Se√ß√£o de Relat√≥rios -->
<section id="reports-section" class="form-section">
<div class="form-header">
<i class="fas fa-chart-bar"></i>
<h2>Relat√≥rios</h2>
</div>

<div class="buttons-panel">
<button id="btnPrintPaciente" class="btn-print">
<i class="fas fa-print"></i>
Ficha do Paciente
</button>
<button id="btnPrintRelatorio" class="btn-print">
<i class="fas fa-file-alt"></i>
Relat√≥rio por Paciente
</button>
<button id="btnFecharFatura" class="btn-fatura">
<i class="fas fa-file-invoice-dollar"></i>
Fechar Fatura
</button>
<button id="btnRelatorioConsolidado" class="btn-consolidado">
<i class="fas fa-chart-bar"></i>
Relat√≥rio Consolidado
</button>
</div>

<div class="search-container">
<i class="fas fa-search search-icon"></i>
<input type="text" id="searchInput" placeholder="üîç Buscar paciente pelo nome..." />
</div>

<div class="table-container">
<table id="sessionsTable">
<thead>
<tr>
<th><i class="fas fa-calendar-day"></i> Dia</th>
<th><i class="fas fa-clock"></i> Hor√°rio</th>
<th><i class="fas fa-user"></i> Paciente</th>
<th><i class="fas fa-map-marker-alt"></i> Tipo</th>
<th><i class="fas fa-hashtag"></i> N¬∫ Sess√£o</th>
<th><i class="fas fa-list-ol"></i> Sess√µes</th>
<th><i class="fas fa-calendar"></i> M√™s</th>
<th><i class="fas fa-cog"></i> A√ß√µes</th>
</tr>
</thead>
<tbody id="sessionsTableBody">
</tbody>
</table>
</div>

<!-- Calend√°rio -->
<div class="calendar-section">
<div class="calendar-container">
<div class="calendar-header">
<div class="calendar-title">
<h3><i class="fas fa-calendar-alt"></i> Calend√°rio de Sess√µes</h3>
<span id="calendarMonthYear" style="color: #4a5568; font-weight: 600;"></span>
</div>
<div class="calendar-actions">
<select id="filterHorario">
<option value="">Todos os hor√°rios</option>
</select>
<button id="btnPrevMonth" class="btn-calendar">
<i class="fas fa-chevron-left"></i>
M√™s Anterior
</button>
<button id="btnNextMonth" class="btn-calendar">
<i class="fas fa-chevron-right"></i>
Pr√≥ximo M√™s
</button>
<button id="btnPrintCalendar" class="btn-calendar">
<i class="fas fa-print"></i>
Imprimir Calend√°rio
</button>
</div>
</div>
<div id="calendar"></div>
<div class="calendar-info">
<div class="moon-phase" id="moonPhase">
<i class="fas fa-moon"></i>
<span>Carregando fase da lua...</span>
</div>
<div class="holidays-info" id="holidaysInfo">
<i class="fas fa-calendar-star"></i>
<span>Carregando feriados...</span>
</div>
</div>
</div>
</div>

<!-- Backup e Restaura√ß√£o -->
<section class="backup-section">
<h3><i class="fas fa-database"></i> Backup e Restaura√ß√£o de Dados</h3>
<div class="backup-actions">
<button id="btnBackupCompleto" class="btn-backup">
<i class="fas fa-download"></i>
Backup Completo
</button>
<button id="btnRestoreBackup" class="btn-restore">
<i class="fas fa-upload"></i>
Restaurar Backup
</button>
</div>
</section>
</section>

<!-- Navega√ß√£o -->
<div class="navigation-buttons" id="navigationButtons">
<button class="nav-btn" onclick="scrollToTop()" title="Ir para o in√≠cio">
<i class="fas fa-arrow-up"></i>
</button>
<button class="nav-btn" onclick="scrollToBottom()" title="Ir para o final">
<i class="fas fa-arrow-down"></i>
</button>
</div>
</main>

<!-- √Årea de impress√£o -->
<div id="printArea" style="display:none;">
<div class="print-curve"></div>
<div class="print-header">
<div class="print-logo-section">
<div class="print-logo">
<span class="print-clinic-name">Fisio Cl√≠nica Dra Tha√≠s Xavier</span>
</div>
<div style="font-size: 9pt; margin-top: 5px;">
<div><strong>CNPJ:</strong> 21.719.507/0001-70</div>
<div id="printContractInfo" style="font-weight: bold;"></div>
<div id="printSubtitle" style="margin-top: 10px; font-weight: bold;"></div>
</div>
</div>
<div class="print-info-section">
<div><strong>Contato:</strong></div>
<div><i class="fab fa-whatsapp"></i> WhatsApp: (35) 98402-0761</div>
<div><i class="fas fa-map-marker-alt"></i> Endere√ßo: Seu endere√ßo</div>
<div style="margin-top: 10px;"><strong>Data de impress√£o:</strong></div>
<div id="printDate"></div>
</div>
</div>
<div id="printContent"></div>
<div class="assinatura-personalizada">
<div class="carimbo-container">
<img src="carimbo.png" alt="Carimbo" class="carimbo-img" onerror="this.style.display='none'">
</div>
<div class="linha-assinatura"></div>
<div class="nome-fisioterapeuta">Thais Pereira Xavier</div>
</div>
<div class="print-footer">
¬© Fisio Cl√≠nica Dra Tha√≠s Xavier - Todos os direitos reservados
</div>
</div>

<footer>
<i class="fas fa-code"></i> Desenvolvido para Fisio Cl√≠nica Dra Tha√≠s Xavier - 2025
</footer>

<!-- Modais -->
<div id="modalContinuo" class="modal">
<div class="modal-content">
<div class="modal-header">
<h2><i class="fas fa-plus-circle"></i> Cadastro Cont√≠nuo</h2>
<span class="close" id="closeContinuo">&times;</span>
</div>
<div>
<p><strong>Paciente:</strong> <span id="modalPacienteNome"></span></p>
<p><strong>Hor√°rio:</strong> <span id="modalHorario"></span></p>
<p><strong>M√™s:</strong> <span id="modalMes"></span></p>
<p><strong>Sess√µes Liberadas:</strong> <span id="modalSessoesLiberadas"></span></p>
</div>
<div id="conflictWarning" class="conflict-warning">
<i class="fas fa-exclamation-triangle"></i> Conflitos de hor√°rio detectados em algumas datas. As datas com conflito est√£o marcadas em vermelho.
</div>
<div class="dates-grid" id="datesGrid">
</div>
<div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem;">
<button id="btnSaveContinuo" class="btn-continue">
<i class="fas fa-save"></i> Salvar Todas as Datas
</button>
<button id="btnCancelContinuo" class="btn-clear">
<i class="fas fa-times"></i> Cancelar
</button>
</div>
</div>
</div>

<div id="modalFatura" class="modal">
<div class="modal-content">
<div class="modal-header">
<h2><i class="fas fa-file-invoice-dollar"></i> Fechar Fatura</h2>
<span class="close" id="closeFatura">&times;</span>
</div>
<div>
<p><strong>Modo:</strong> <span id="faturaMode"></span></p>
<div class="form-group" style="margin: 1.5rem 0;">
<label for="inputValorSessao">
<i class="fas fa-money-bill-wave"></i>
Valor por Sess√£o (R$)
</label>
<input type="number" id="inputValorSessao" step="0.01" min="0" placeholder="0,00" />
</div>
</div>
<div id="faturaSummaryContainer">
</div>
<div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem;">
<button id="btnImprimirFatura" class="btn-fatura">
<i class="fas fa-print"></i> Imprimir Fatura
</button>
<button id="btnCancelarFatura" class="btn-clear">
<i class="fas fa-times"></i> Cancelar
</button>
</div>
</div>
</div>

<div id="modalDayDetails" class="modal day-details-modal">
<div class="modal-content">
<div class="modal-header">
<h2><i class="fas fa-calendar-day"></i> Detalhes do Dia</h2>
<span class="close" id="closeDayDetails">&times;</span>
</div>
<div>
<h3 id="modalDayDate"></h3>
<div class="day-sessions-list" id="daySessionsList">
</div>
</div>
<div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem;">
<button id="btnCloseDayDetails" class="btn-clear">
<i class="fas fa-times"></i> Fechar
</button>
</div>
</div>
</div>

<script>
// =============================================
// VARI√ÅVEIS GLOBAIS E INICIALIZA√á√ÉO
// =============================================
let sessions = JSON.parse(localStorage.getItem("fisioSessions")) || [];
let patients = JSON.parse(localStorage.getItem("fisioPatients")) || [];
let payments = JSON.parse(localStorage.getItem("fisioPayments")) || [];
let anamneses = JSON.parse(localStorage.getItem("fisioAnamneses")) || [];
let documents = JSON.parse(localStorage.getItem("fisioDocuments")) || [];
let tempSessionData = {};
let currentCalendarDate = new Date();
let currentFaturaNumber = parseInt(localStorage.getItem("currentFaturaNumber")) || 1;
let currentEditIndex = -1;

// =============================================
// FUN√á√ïES PRINCIPAIS
// =============================================

// Fun√ß√£o para mostrar se√ß√µes
function showSection(sectionId) {
    document.querySelectorAll('.form-section').forEach(section => {
        section.classList.remove('active');
    });
    document.querySelectorAll('.menu-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.getElementById(sectionId).classList.add('active');
    event.target.classList.add('active');
    
    // Atualizar dados espec√≠ficos da se√ß√£o
    if (sectionId === 'patients-section') {
        renderPatientsTable();
    } else if (sectionId === 'payment-section') {
        renderPaymentsTable();
    } else if (sectionId === 'anamnese-section') {
        renderAnamnesesTable();
    } else if (sectionId === 'documents-section') {
        renderAtestadosTable();
        renderCartasTable();
    }
}

// Fun√ß√£o para mostrar abas
function showTab(tabId) {
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.getElementById(tabId).classList.add('active');
    event.target.classList.add('active');
}

// Fun√ß√£o para mostrar abas de documentos
function showDocTab(tabId) {
    document.querySelectorAll('#documents-section .tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelectorAll('#documents-section .tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.getElementById(tabId).classList.add('active');
    event.target.classList.add('active');
}

// Atualizar campos de sess√µes liberadas baseado no tipo
document.getElementById('inputTipo').addEventListener('change', function() {
    const tipo = this.value;
    const sessoesLiberadasInput = document.getElementById('inputSessoesLiberadas');
    
    if (tipo === 'Prefeitura') {
        sessoesLiberadasInput.disabled = false;
        sessoesLiberadasInput.value = document.getElementById('inputSessoesSolicitadas').value;
    } else {
        sessoesLiberadasInput.disabled = true;
        sessoesLiberadasInput.value = '0';
    }
});

// Atualizar campos de atestado baseado no tipo
document.getElementById('inputAtestadoTipo').addEventListener('change', function() {
    const tipo = this.value;
    const horarioFields = document.getElementById('atestadoHorarioFields');
    const diaFields = document.getElementById('atestadoDiaFields');
    
    if (tipo === 'horario') {
        horarioFields.style.display = 'grid';
        diaFields.style.display = 'none';
    } else {
        horarioFields.style.display = 'none';
        diaFields.style.display = 'grid';
    }
});

// Calcular total de pagamento
function updatePaymentTotal() {
    const sessoes = parseInt(document.getElementById('inputSessoesPagamento').value) || 0;
    const valorSessao = parseFloat(document.getElementById('inputValorSessaoPagamento').value) || 0;
    const desconto = parseFloat(document.getElementById('inputDesconto').value) || 0;
    
    const subtotal = sessoes * valorSessao;
    const total = subtotal - desconto;
    
    document.getElementById('pagamentoSubtotal').textContent = formatCurrency(subtotal);
    document.getElementById('pagamentoDesconto').textContent = formatCurrency(desconto);
    document.getElementById('pagamentoTotal').textContent = formatCurrency(total);
}

// Event listeners para atualizar total de pagamento
document.getElementById('inputSessoesPagamento').addEventListener('input', updatePaymentTotal);
document.getElementById('inputValorSessaoPagamento').addEventListener('input', updatePaymentTotal);
document.getElementById('inputDesconto').addEventListener('input', updatePaymentTotal);

// Upload de foto para anamnese
document.getElementById('btnSelectPhoto').addEventListener('click', function() {
    document.getElementById('inputFotoPaciente').click();
});

document.getElementById('inputFotoPaciente').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const photoPreview = document.getElementById('photoPreview');
            photoPreview.innerHTML = `<img src="${e.target.result}" alt="Foto do paciente">`;
        };
        reader.readAsDataURL(file);
    }
});

// =============================================
// FUN√á√ïES DE ARMAZENAMENTO
// =============================================

function saveSessions() {
    try {
        localStorage.setItem("fisioSessions", JSON.stringify(sessions));
        // Atualizar calend√°rio ap√≥s salvar
        renderCalendar();
    } catch (error) {
        console.error("Erro ao salvar sess√µes:", error);
        showMessage("‚ùå Erro ao salvar dados no navegador", 'error');
    }
}

function savePatients() {
    localStorage.setItem("fisioPatients", JSON.stringify(patients));
}

function savePayments() {
    localStorage.setItem("fisioPayments", JSON.stringify(payments));
}

function saveAnamneses() {
    localStorage.setItem("fisioAnamneses", JSON.stringify(anamneses));
}

function saveDocuments() {
    localStorage.setItem("fisioDocuments", JSON.stringify(documents));
}

function loadSessions() {
    const data = localStorage.getItem("fisioSessions");
    sessions = data ? JSON.parse(data) : [];
    sessions.sort((a, b) => new Date(a.dia) - new Date(b.dia));
    updateHorarioFilter();
    renderCalendar();
    hideConflictAlert();
    updateMoonPhase();
    updateHolidaysInfo();
}

// =============================================
// FUN√á√ïES DE UTILIDADE
// =============================================

function formatDate(dateStr) {
    if (!dateStr) return "";
    const [year, month, day] = dateStr.split('-');
    return `${day}/${month}/${year}`;
}

function formatDateLong(dateStr) {
    if (!dateStr) return "";
    const date = new Date(dateStr + 'T00:00:00');
    return date.toLocaleDateString('pt-BR', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    });
}

function formatCurrency(value) {
    return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
}

function getSessionNumber(pacienteNome, dia) {
    const pacienteSessions = sessions
        .filter(s => s.nome === pacienteNome)
        .sort((a, b) => new Date(a.dia) - new Date(b.dia));
    const sessionIndex = pacienteSessions.findIndex(s => s.dia === dia);
    return sessionIndex >= 0 ? (sessionIndex + 1).toString().padStart(2, '0') : '01';
}

function getSessoesLiberadas(pacienteNome) {
    const pacienteSession = sessions.find(s => s.nome === pacienteNome);
    return pacienteSession ? pacienteSession.sessoesLiberadas || 0 : 0;
}

function getSessoesRealizadas(pacienteNome) {
    return sessions.filter(s => s.nome === pacienteNome).length;
}

function getPatientData(nome) {
    return patients.find(p => p.nome === nome) || {};
}

function showMessage(text, type = 'success') {
    const message = document.getElementById('message');
    message.textContent = text;
    message.className = type === 'error' ? 'message-error' : type === 'warning' ? 'message-warning' : 'message-success';
    message.style.display = 'block';
    hideConflictAlert();
    setTimeout(() => {
        message.className = '';
        message.style.display = 'none';
    }, 5000);
}

function hideConflictAlert() {
    const conflictAlert = document.getElementById('conflictAlert');
    conflictAlert.classList.remove('show');
}

function clearForm() {
    const form = document.getElementById("sessionForm");
    form.reset();
    document.getElementById('inputSessoesSolicitadas').value = 10;
    document.getElementById('inputSessoesLiberadas').value = 0;
    document.getElementById('inputSessoesLiberadas').disabled = true;
    document.getElementById('editIndex').value = "-1";
    document.getElementById('btnSave').innerHTML = '<i class="fas fa-save"></i> Cadastrar';
    document.getElementById('message').style.display = 'none';
    hideConflictAlert();
    closeAllLists();
}

function closeAllLists(elmnt) {
    const lists = document.getElementsByClassName("autocomplete-items");
    for (let i = 0; i < lists.length; i++) {
        if (elmnt != lists[i] && elmnt != inputNome) {
            lists[i].parentNode.removeChild(lists[i]);
        }
    }
}

function updateActionButtons() {
    const btnPrintPaciente = document.getElementById('btnPrintPaciente');
    const btnPrintRelatorio = document.getElementById('btnPrintRelatorio');
    btnPrintPaciente.disabled = false;
    btnPrintRelatorio.disabled = false;
}

// =============================================
// FUN√á√ïES DE AGENDAMENTO E DISPONIBILIDADE
// =============================================

function checkAvailability(dia, horario, exceptIndexes = []) {
    let count = 0;
    let conflictingPatients = [];
    
    sessions.forEach((sess, i) => {
        if (!exceptIndexes.includes(i) && sess.dia === dia && sess.horario === horario) {
            count++;
            conflictingPatients.push({
                nome: sess.nome,
                horario: sess.horario,
                dia: formatDate(sess.dia),
                tipo: sess.tipo
            });
        }
    });
    
    // Verificar se √© Prefeitura e j√° tem 2 agendamentos
    const isPrefeitura = document.getElementById('inputTipo').value === 'Prefeitura';
    const maxAllowed = isPrefeitura ? 2 : 99;
    
    return { 
        available: count < maxAllowed, 
        conflictingPatients: conflictingPatients,
        count: count,
        maxAllowed: maxAllowed
    };
}

function showConflictAlert(conflictingPatients, dia, horario) {
    const conflictList = document.getElementById('conflictList');
    conflictList.innerHTML = '';
    conflictingPatients.forEach(patient => {
        const li = document.createElement('li');
        li.innerHTML = `<strong>${patient.nome}</strong> - ${patient.dia} √†s ${patient.horario}`;
        conflictList.appendChild(li);
    });
    document.getElementById('conflictAlert').classList.add('show');
    document.getElementById('message').style.display = 'none';
}

// =============================================
// FUN√á√ïES DE RENDERIZA√á√ÉO
// =============================================

function renderTable(filter = "") {
    const tableBody = document.getElementById("sessionsTableBody");
    tableBody.innerHTML = "";
    
    const filtered = sessions.filter((s) =>
        s.nome.toLowerCase().includes(filter.toLowerCase())
    ).sort((a, b) => new Date(a.dia) - new Date(b.dia));
    
    filtered.forEach((sess, i) => {
        const realIndex = sessions.findIndex(s => s === sess);
        const sessionNumber = getSessionNumber(sess.nome, sess.dia);
        const sessoesLiberadas = getSessoesLiberadas(sess.nome);
        const sessoesRealizadas = getSessoesRealizadas(sess.nome);

        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${formatDate(sess.dia)}</td>
            <td>${sess.horario || ""}</td>
            <td><i class="fas fa-user-circle" style="color: #4facfe;"></i> ${sess.nome}</td>
            <td>${sess.tipo || ""}</td>
            <td><span class="session-number">${sessionNumber}</span></td>
            <td>Solicitadas: ${sess.sessoesSolicitadas || 0}<br>
                Liberadas: ${sessoesLiberadas}<br>
                Realizadas: ${sessoesRealizadas}
            </td>
            <td>${sess.mes || ""}</td>
            <td class="actions-cell">
                <div class="action-buttons">
                    <button class="action-btn edit-btn" data-index="${realIndex}" title="Editar">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn delete-btn" data-index="${realIndex}" title="Excluir">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </td>
        `;
        tableBody.appendChild(tr);
    });

    updateActionButtons();
}

function renderPatientsTable() {
    const tableBody = document.getElementById('patientsTableBody');
    tableBody.innerHTML = '';
    
    patients.forEach((patient, index) => {
        const sessoesRealizadas = getSessoesRealizadas(patient.nome);
        
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${patient.nome}</td>
            <td>${patient.telefone || ''}</td>
            <td>${patient.cidade || ''}</td>
            <td>${patient.bairro || ''}</td>
            <td>${sessoesRealizadas}</td>
            <td class="actions-cell">
                <div class="action-buttons">
                    <button class="action-btn edit-btn" onclick="editPatient(${index})" title="Editar">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn delete-btn" onclick="deletePatient(${index})" title="Excluir">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </td>
        `;
        tableBody.appendChild(tr);
    });
}

function renderPaymentsTable() {
    const tableBody = document.getElementById('paymentsTableBody');
    tableBody.innerHTML = '';
    
    payments.forEach((payment, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${formatDate(payment.data)}</td>
            <td>${payment.paciente}</td>
            <td>${payment.sessoes}</td>
            <td>${formatCurrency(payment.valorSessao)}</td>
            <td>${formatCurrency(payment.desconto)}</td>
            <td>${formatCurrency(payment.total)}</td>
            <td>${payment.meioPagamento}</td>
            <td>${payment.numeroNF || ''}</td>
            <td class="actions-cell">
                <div class="action-buttons">
                    <button class="action-btn" onclick="printComprovante(${index})" title="Imprimir Comprovante">
                        <i class="fas fa-print"></i>
                    </button>
                    <button class="action-btn delete-btn" onclick="deletePayment(${index})" title="Excluir">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </td>
        `;
        tableBody.appendChild(tr);
    });
}

function renderAnamnesesTable() {
    const tableBody = document.getElementById('anamnesesTableBody');
    tableBody.innerHTML = '';
    
    anamneses.forEach((anamnese, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${anamnese.paciente}</td>
            <td>${formatDate(anamnese.createdAt)}</td>
            <td class="actions-cell">
                <div class="action-buttons">
                    <button class="action-btn" onclick="printAnamnese(${index})" title="Imprimir">
                        <i class="fas fa-print"></i>
                    </button>
                    <button class="action-btn edit-btn" onclick="editAnamnese(${index})" title="Editar">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn delete-btn" onclick="deleteAnamnese(${index})" title="Excluir">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </td>
        `;
        tableBody.appendChild(tr);
    });
}

function renderAtestadosTable() {
    const tableBody = document.getElementById('atestadosTableBody');
    tableBody.innerHTML = '';
    
    const atestados = documents.filter(d => d.tipo === 'atestado');
    
    atestados.forEach((atestado, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${atestado.paciente}</td>
            <td>${atestado.tipoAtestado}</td>
            <td>${formatDate(atestado.dataInicio)}</td>
            <td class="actions-cell">
                <div class="action-buttons">
                    <button class="action-btn" onclick="printAtestado(${index})" title="Imprimir">
                        <i class="fas fa-print"></i>
                    </button>
                    <button class="action-btn edit-btn" onclick="editAtestado(${index})" title="Editar">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn delete-btn" onclick="deleteAtestado(${index})" title="Excluir">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </td>
        `;
        tableBody.appendChild(tr);
    });
}

function renderCartasTable() {
    const tableBody = document.getElementById('cartasTableBody');
    tableBody.innerHTML = '';
    
    const cartas = documents.filter(d => d.tipo === 'carta');
    
    cartas.forEach((carta, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${carta.paciente}</td>
            <td>${carta.medico || 'N√£o informado'}</td>
            <td>${formatDate(carta.createdAt)}</td>
            <td class="actions-cell">
                <div class="action-buttons">
                    <button class="action-btn" onclick="printCarta(${index})" title="Imprimir">
                        <i class="fas fa-print"></i>
                    </button>
                    <button class="action-btn edit-btn" onclick="editCarta(${index})" title="Editar">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn delete-btn" onclick="deleteCarta(${index})" title="Excluir">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </td>
        `;
        tableBody.appendChild(tr);
    });
}

// =============================================
// AUTOCOMPLETE
// =============================================

function autocomplete(inp, arr) {
    let currentFocus;
    inp.addEventListener("input", function(e) {
        let a, b, i, val = this.value;
        closeAllLists();
        if (!val || val.length < 2) return false;
        currentFocus = -1;
        a = document.createElement("DIV");
        a.setAttribute("id", this.id + "autocomplete-list");
        a.setAttribute("class", "autocomplete-items");
        this.parentNode.appendChild(a);
        arr.forEach(item => {
            if (item.toLowerCase().includes(val.toLowerCase())) {
                b = document.createElement("DIV");
                b.innerHTML = item.replace(new RegExp(val, 'i'), `<strong>$&</strong>`);
                b.innerHTML += `<input type='hidden' value="${item}">`;
                b.addEventListener("click", function(e) {
                    inp.value = this.getElementsByTagName("input")[0].value;
                    closeAllLists();
                });
                a.appendChild(b);
            }
        });
    });
    inp.addEventListener("keydown", function(e) {
        let x = document.getElementById(this.id + "autocomplete-list");
        if (x) x = x.getElementsByTagName("div");
        if (e.keyCode == 40) {
            currentFocus++;
            addActive(x);
        } else if (e.keyCode == 38) {
            currentFocus--;
            addActive(x);
        } else if (e.keyCode == 13) {
            e.preventDefault();
            if (currentFocus > -1) {
                if (x) x[currentFocus].click();
            }
        }
    });
    function addActive(x) {
        if (!x) return false;
        removeActive(x);
        if (currentFocus >= x.length) currentFocus = 0;
        if (currentFocus < 0) currentFocus = (x.length - 1);
        x[currentFocus].classList.add("autocomplete-active");
    }
    function removeActive(x) {
        for (let i = 0; i < x.length; i++) {
            x[i].classList.remove("autocomplete-active");
        }
    }
    document.addEventListener("click", function (e) {
        closeAllLists(e.target);
    });
}

// =============================================
// CADASTRO CONT√çNUO
// =============================================

function openCadastroContinuo() {
    const pacienteNome = document.getElementById('inputNome').value.trim();
    const horario = document.getElementById('inputHorario').value;
    const mes = document.getElementById('inputMes').value;
    const tipo = document.getElementById('inputTipo').value;
    const sessoesSolicitadas = parseInt(document.getElementById('inputSessoesSolicitadas').value) || 10;
    const sessoesLiberadas = tipo === 'Prefeitura' ? 
        parseInt(document.getElementById('inputSessoesLiberadas').value) || 0 : 0;
    
    if (!pacienteNome || !horario || !mes) {
        showMessage("Por favor, preencha todos os campos obrigat√≥rios (Paciente, Hor√°rio, M√™s).", 'error');
        return;
    }
    
    tempSessionData = {
        nome: pacienteNome,
        horario: horario,
        mes: mes,
        tipo: tipo,
        sessoesSolicitadas: sessoesSolicitadas,
        sessoesLiberadas: sessoesLiberadas
    };
    
    document.getElementById('modalPacienteNome').textContent = pacienteNome;
    document.getElementById('modalHorario').textContent = horario;
    document.getElementById('modalMes').textContent = mes;
    document.getElementById('modalSessoesLiberadas').textContent = sessoesLiberadas;
    
    const baseDate = new Date(document.getElementById('inputDia').value);
    if (isNaN(baseDate)) {
        showMessage("Por favor, selecione uma data v√°lida.", 'error');
        return;
    }
    
    const datesGrid = document.getElementById('datesGrid');
    datesGrid.innerHTML = '';
    let hasConflict = false;
    
    for (let i = 1; i <= 9; i++) {
        const nextDate = new Date(baseDate);
        nextDate.setDate(baseDate.getDate() + (i * 7));
        const dateStr = nextDate.toISOString().split('T')[0];
        const availability = checkAvailability(dateStr, horario);
        const inputGroup = document.createElement('div');
        inputGroup.className = 'date-input-group';
        inputGroup.innerHTML = `
            <label for="extraDate${i}">Data ${i}</label>
            <input type="date" id="extraDate${i}" value="${dateStr}" required
                class="${!availability.available ? 'conflict' : ''}">
        `;
        if (!availability.available) hasConflict = true;
        datesGrid.appendChild(inputGroup);
    }
    
    const conflictWarning = document.getElementById('conflictWarning');
    conflictWarning.classList.toggle('show', hasConflict);
    document.getElementById('modalContinuo').style.display = 'block';
}

function saveCadastroContinuo() {
    let hasConflict = false;
    const newSessions = [];
    
    for (let i = 1; i <= 9; i++) {
        const dateInput = document.getElementById(`extraDate${i}`);
        const dateStr = dateInput.value;
        const availability = checkAvailability(dateStr, tempSessionData.horario);
        
        if (!availability.available) {
            hasConflict = true;
            dateInput.classList.add('conflict');
        } else {
            dateInput.classList.remove('conflict');
            newSessions.push({
                dia: dateStr,
                horario: tempSessionData.horario,
                nome: tempSessionData.nome,
                tipo: tempSessionData.tipo,
                sessoesSolicitadas: tempSessionData.sessoesSolicitadas,
                sessoesLiberadas: tempSessionData.sessoesLiberadas,
                mes: tempSessionData.mes
            });
        }
    }
    
    if (hasConflict) {
        showMessage("‚ö†Ô∏è Conflitos de hor√°rio detectados! Corrija as datas em vermelho.", 'warning');
        return;
    }
    
    newSessions.forEach(session => {
        sessions.push(session);
    });
    
    saveSessions();
    renderTable(document.getElementById('searchInput').value);
    showMessage(`‚úÖ ${newSessions.length} sess√µes adicionadas com sucesso para ${tempSessionData.nome}!`, 'success');
    document.getElementById('modalContinuo').style.display = 'none';
    clearForm();
}

// =============================================
// CALEND√ÅRIO
// =============================================

function renderCalendar() {
    const currentMonth = currentCalendarDate.getMonth();
    const currentYear = currentCalendarDate.getFullYear();
    const monthName = currentCalendarDate.toLocaleDateString('pt-BR', { month: 'long' });
    const capitalizedMonth = monthName.charAt(0).toUpperCase() + monthName.slice(1);
    document.getElementById('calendarMonthYear').textContent = `${capitalizedMonth} ${currentYear}`;

    const firstDay = new Date(currentYear, currentMonth, 1);
    const lastDay = new Date(currentYear, currentMonth + 1, 0);
    const daysInMonth = lastDay.getDate();
    const startingDay = firstDay.getDay();

    let calendarHTML = '<div class="calendar-grid">';
    
    const dayNames = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];
    dayNames.forEach(day => {
        calendarHTML += `<div class="calendar-day-header">${day}</div>`;
    });

    for (let i = 0; i < startingDay; i++) {
        calendarHTML += '<div class="calendar-day empty"></div>';
    }

    for (let day = 1; day <= daysInMonth; day++) {
        const dateStr = `${currentYear}-${(currentMonth + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
        const dateObj = new Date(dateStr);
        const dayOfWeek = dateObj.getDay();
        const filterHorario = document.getElementById('filterHorario');
        const daySessions = sessions.filter(s => s.dia === dateStr && 
            (!filterHorario.value || s.horario === filterHorario.value))
            .sort((a, b) => a.horario.localeCompare(b.horario));

        const isToday = day === new Date().getDate() && currentMonth === new Date().getMonth() && currentYear === new Date().getFullYear();
        const hasSessions = daySessions.length > 0;
        const hasConflict = daySessions.some(session => {
            const conflictCheck = checkAvailability(dateStr, session.horario);
            return !conflictCheck.available;
        });

        const isHoliday = getBrazilianHolidays(currentYear).some(holiday => 
            holiday.date === dateStr
        );

        let dayClass = 'calendar-day';
        if (isToday) dayClass += ' today';
        if (hasSessions) dayClass += ' has-sessions';
        if (hasConflict) dayClass += ' conflict';
        if (isHoliday) dayClass += ' holiday';
        if (dayOfWeek === 6) dayClass += ' saturday';
        else if (dayOfWeek === 0) dayClass += ' sunday';

        calendarHTML += `<div class="${dayClass}" data-date="${dateStr}">`;
        calendarHTML += `<div class="day-number">${day}</div>`;

        if (hasSessions) {
            const sessionCount = daySessions.length;
            const conflictCount = daySessions.filter(session => {
                const conflictCheck = checkAvailability(dateStr, session.horario);
                return !conflictCheck.available;
            }).length;
            const countClass = conflictCount > 0 ? 'conflict-count' : '';
            calendarHTML += `<span class="session-count ${countClass}">${sessionCount}</span>`;
        }

        daySessions.forEach(session => {
            const conflictCheck = checkAvailability(dateStr, session.horario);
            const isConflict = !conflictCheck.available;
            calendarHTML += `<div class="calendar-session ${isConflict ? 'conflict' : ''}">`;
            calendarHTML += `<span class="session-time">${session.horario}</span>`;
            calendarHTML += `<span class="session-patient">${session.nome}</span>`;
            calendarHTML += `</div>`;
        });

        calendarHTML += '</div>';
    }

    document.getElementById('calendar').innerHTML = calendarHTML;

    document.querySelectorAll('.calendar-day:not(.empty)').forEach(day => {
        day.addEventListener('click', function() {
            const date = this.getAttribute('data-date');
            showDayDetails(date);
        });
    });
}

function showDayDetails(dateStr) {
    const daySessions = sessions.filter(s => s.dia === dateStr)
        .sort((a, b) => a.horario.localeCompare(b.horario));
    const modalDayDate = document.getElementById('modalDayDate');
    const daySessionsList = document.getElementById('daySessionsList');
    
    const [year, month, day] = dateStr.split('-').map(Number);
    const date = new Date(year, month - 1, day);
    const formattedDate = date.toLocaleDateString('pt-BR', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    });
    modalDayDate.textContent = formattedDate.charAt(0).toUpperCase() + formattedDate.slice(1);
    
    daySessionsList.innerHTML = '';
    if (daySessions.length === 0) {
        daySessionsList.innerHTML = '<p style="text-align: center; color: #718096; padding: 2rem;">Nenhuma sess√£o agendada para este dia.</p>';
    } else {
        daySessions.forEach(session => {
            const sessionItem = document.createElement('div');
            sessionItem.className = 'day-session-item';
            sessionItem.innerHTML = `
                <div class="session-info">
                    <div class="session-time-large">${session.horario}</div>
                    <div class="session-patient-large">${session.nome}</div>
                </div>
                <div class="session-meta">
                    <div>${session.tipo || 'Tipo n√£o informado'}</div>
                    <div>${session.mes}</div>
                </div>
            `;
            daySessionsList.appendChild(sessionItem);
        });
    }
    document.getElementById('modalDayDetails').style.display = 'block';
}

function updateMoonPhase() {
    const moonPhase = calculateMoonPhase(currentCalendarDate);
    const moonPhaseElement = document.getElementById('moonPhase');
    moonPhaseElement.innerHTML = `<i class="fas fa-moon"></i><span>${moonPhase}</span>`;
}

function calculateMoonPhase(date) {
    const knownNewMoon = new Date('2024-01-11');
    const lunarCycle = 29.53;
    const diffTime = date - knownNewMoon;
    const diffDays = diffTime / (1000 * 60 * 60 * 24);
    const phase = (diffDays % lunarCycle) / lunarCycle;
    if (phase < 0.03) return "Lua Nova üåë";
    if (phase < 0.22) return "Lua Crescente üåí";
    if (phase < 0.28) return "Quarto Crescente üåì";
    if (phase < 0.47) return "Lua Gibosa Crescente üåî";
    if (phase < 0.53) return "Lua Cheia üåï";
    if (phase < 0.72) return "Lua Gibosa Minguante üåñ";
    if (phase < 0.78) return "Quarto Minguante üåó";
    return "Lua Minguante üåò";
}

function updateHolidaysInfo() {
    const currentMonth = currentCalendarDate.getMonth();
    const currentYear = currentCalendarDate.getFullYear();
    const holidays = getBrazilianHolidays(currentYear).filter(holiday => {
        const holidayDate = new Date(holiday.date);
        return holidayDate.getMonth() === currentMonth;
    });
    const holidaysInfo = document.getElementById('holidaysInfo');
    if (holidays.length > 0) {
        holidaysInfo.innerHTML = `<i class="fas fa-calendar-star"></i><span>Feriados: ${holidays.map(h => h.name).join(', ')}</span>`;
    } else {
        holidaysInfo.innerHTML = `<i class="fas fa-calendar-star"></i><span>Sem feriados este m√™s</span>`;
    }
}

function getBrazilianHolidays(year) {
    return [
        { date: `${year}-01-01`, name: 'Ano Novo' },
        { date: `${year}-04-21`, name: 'Tiradentes' },
        { date: `${year}-05-01`, name: 'Dia do Trabalho' },
        { date: `${year}-09-07`, name: 'Independ√™ncia' },
        { date: `${year}-10-12`, name: 'Nossa Senhora Aparecida' },
        { date: `${year}-11-02`, name: 'Finados' },
        { date: `${year}-11-15`, name: 'Proclama√ß√£o da Rep√∫blica' },
        { date: `${year}-12-25`, name: 'Natal' }
    ];
}

function updateHorarioFilter() {
    const filterHorario = document.getElementById('filterHorario');
    const horarios = [...new Set(sessions.map(s => s.horario))].sort();
    filterHorario.innerHTML = '<option value="">Todos os hor√°rios</option>';
    horarios.forEach(horario => {
        const option = document.createElement('option');
        option.value = horario;
        option.textContent = horario;
        filterHorario.appendChild(option);
    });
}

// =============================================
// FUN√á√ïES DE FORMUL√ÅRIOS
// =============================================

// Formul√°rio de sess√£o
document.getElementById("sessionForm").addEventListener("submit", (e) => {
    e.preventDefault();
    const dia = document.getElementById('inputDia').value;
    const horario = document.getElementById('inputHorario').value;
    const nome = document.getElementById('inputNome').value.trim();
    const tipo = document.getElementById('inputTipo').value;
    const sessoesSolicitadas = parseInt(document.getElementById('inputSessoesSolicitadas').value) || 10;
    const sessoesLiberadas = tipo === 'Prefeitura' ? 
        parseInt(document.getElementById('inputSessoesLiberadas').value) || 0 : 0;
    const valorSessao = parseFloat(document.getElementById('inputValorSessao').value) || 0;
    const mes = document.getElementById('inputMes').value;
    const index = parseInt(document.getElementById('editIndex').value);
    
    const availability = checkAvailability(dia, horario, index >= 0 ? [index] : []);
    if (!availability.available) {
        showConflictAlert(availability.conflictingPatients, dia, horario);
        return;
    }
    
    const session = {
        dia,
        horario,
        nome,
        tipo,
        sessoesSolicitadas,
        sessoesLiberadas,
        valorSessao,
        mes
    };
    
    if (index >= 0) {
        sessions[index] = session;
        showMessage(`‚úÖ Sess√£o de ${nome} editada com sucesso!`, 'success');
    } else {
        sessions.push(session);
        showMessage(`‚úÖ Sess√£o de ${nome} cadastrada com sucesso!`, 'success');
    }
    
    saveSessions();
    renderTable(document.getElementById('searchInput').value);
    clearForm();
});

// Formul√°rio de paciente
document.getElementById('patientForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const nome = document.getElementById('inputPacienteNome').value.trim();
    const telefone = document.getElementById('inputPacienteTelefone').value;
    const cidade = document.getElementById('inputPacienteCidade').value;
    const bairro = document.getElementById('inputPacienteBairro').value;
    
    // Verificar se paciente j√° existe
    const existingIndex = patients.findIndex(p => p.nome === nome);
    
    const patientData = {
        nome,
        telefone,
        cidade,
        bairro,
        updatedAt: new Date().toISOString()
    };
    
    if (existingIndex >= 0) {
        patients[existingIndex] = { ...patients[existingIndex], ...patientData };
        showMessage(`‚úÖ Dados de ${nome} atualizados com sucesso!`, 'success');
    } else {
        patientData.createdAt = new Date().toISOString();
        patients.push(patientData);
        showMessage(`‚úÖ Paciente ${nome} cadastrado com sucesso!`, 'success');
    }
    
    savePatients();
    renderPatientsTable();
    this.reset();
});

// Formul√°rio de anamnese
document.getElementById('anamneseForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const paciente = document.getElementById('inputAnamnesePaciente').value.trim();
    const medicamentos = document.getElementById('inputMedicamentos').value;
    const queixaPrincipal = document.getElementById('inputQueixaPrincipal').value;
    const historicoDoenca = document.getElementById('inputHistoricoDoenca').value;
    const exameFisico = document.getElementById('inputExameFisico').value;
    
    const photoPreview = document.getElementById('photoPreview');
    const foto = photoPreview.querySelector('img') ? photoPreview.querySelector('img').src : null;
    
    // Verificar se anamnese j√° existe
    const existingIndex = anamneses.findIndex(a => a.paciente === paciente);
    
    const anamneseData = {
        paciente,
        medicamentos,
        queixaPrincipal,
        historicoDoenca,
        exameFisico,
        foto,
        updatedAt: new Date().toISOString()
    };
    
    if (existingIndex >= 0) {
        anamneses[existingIndex] = { ...anamneses[existingIndex], ...anamneseData };
        showMessage(`‚úÖ Anamnese de ${paciente} atualizada com sucesso!`, 'success');
    } else {
        anamneseData.createdAt = new Date().toISOString();
        anamneses.push(anamneseData);
        showMessage(`‚úÖ Anamnese de ${paciente} cadastrada com sucesso!`, 'success');
    }
    
    saveAnamneses();
    renderAnamnesesTable();
});

// Formul√°rio de pagamento
document.getElementById('paymentForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const paciente = document.getElementById('inputPagamentoPaciente').value.trim();
    const data = document.getElementById('inputPagamentoData').value;
    const sessoes = parseInt(document.getElementById('inputSessoesPagamento').value);
    const valorSessao = parseFloat(document.getElementById('inputValorSessaoPagamento').value);
    const meioPagamento = document.getElementById('inputMeioPagamento').value;
    const desconto = parseFloat(document.getElementById('inputDesconto').value) || 0;
    const numeroNF = document.getElementById('inputNumeroNF').value;
    const observacao = document.getElementById('inputObservacaoPagamento').value;
    const total = (sessoes * valorSessao) - desconto;
    
    const payment = {
        paciente,
        data,
        sessoes,
        valorSessao,
        meioPagamento,
        desconto,
        total,
        numeroNF,
        observacao,
        timestamp: new Date().toISOString()
    };
    
    payments.push(payment);
    savePayments();
    renderPaymentsTable();
    
    showMessage(`‚úÖ Pagamento de ${paciente} registrado com sucesso!`, 'success');
    this.reset();
    updatePaymentTotal();
});

// Formul√°rio de atestado
document.getElementById('atestadoForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const paciente = document.getElementById('inputAtestadoPaciente').value.trim();
    const tipo = document.getElementById('inputAtestadoTipo').value;
    const situacao = document.getElementById('inputAtestadoSituacao').value;
    
    let dataInicio, dataFim, horarioInicio, horarioFim;
    
    if (tipo === 'horario') {
        dataInicio = document.getElementById('inputAtestadoData').value;
        horarioInicio = document.getElementById('inputAtestadoHorarioInicio').value;
        horarioFim = document.getElementById('inputAtestadoHorarioFim').value;
        dataFim = dataInicio;
    } else {
        dataInicio = document.getElementById('inputAtestadoDataInicio').value;
        dataFim = document.getElementById('inputAtestadoDataFim').value;
    }
    
    const atestado = {
        tipo: 'atestado',
        paciente,
        tipoAtestado: tipo,
        dataInicio,
        dataFim,
        horarioInicio,
        horarioFim,
        situacao,
        createdAt: new Date().toISOString()
    };
    
    documents.push(atestado);
    saveDocuments();
    renderAtestadosTable();
    
    showMessage(`‚úÖ Atestado para ${paciente} salvo com sucesso!`, 'success');
    this.reset();
});

// Formul√°rio de carta ao m√©dico
document.getElementById('cartaForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const paciente = document.getElementById('inputCartaPaciente').value.trim();
    const medico = document.getElementById('inputCartaMedico').value;
    const tratamento = document.getElementById('inputCartaTratamento').value;
    const evolucao = document.getElementById('inputCartaEvolucao').value;
    const sessoes = parseInt(document.getElementById('inputCartaSessoes').value);
    
    const carta = {
        tipo: 'carta',
        paciente,
        medico,
        tratamento,
        evolucao,
        sessoes,
        createdAt: new Date().toISOString()
    };
    
    documents.push(carta);
    saveDocuments();
    renderCartasTable();
    
    showMessage(`‚úÖ Carta para ${medico || 'm√©dico'} salva com sucesso!`, 'success');
    this.reset();
});

// =============================================
// FUN√á√ïES DE EDI√á√ÉO E EXCLUS√ÉO
// =============================================

// Fun√ß√µes para pacientes
function editPatient(index) {
    const patient = patients[index];
    document.getElementById('inputPacienteNome').value = patient.nome;
    document.getElementById('inputPacienteTelefone').value = patient.telefone || '';
    document.getElementById('inputPacienteCidade').value = patient.cidade || '';
    document.getElementById('inputPacienteBairro').value = patient.bairro || '';
    
    showSection('session-section');
    showTab('paciente-tab');
    
    showMessage(`‚úèÔ∏è Editando paciente: ${patient.nome}`, 'warning');
}

function deletePatient(index) {
    const patient = patients[index];
    if (confirm(`Deseja realmente excluir o paciente ${patient.nome}?`)) {
        patients.splice(index, 1);
        savePatients();
        renderPatientsTable();
        showMessage("‚úÖ Paciente exclu√≠do com sucesso!", 'success');
    }
}

// Fun√ß√µes para anamneses
function editAnamnese(index) {
    const anamnese = anamneses[index];
    document.getElementById('inputAnamnesePaciente').value = anamnese.paciente;
    document.getElementById('inputMedicamentos').value = anamnese.medicamentos || '';
    document.getElementById('inputQueixaPrincipal').value = anamnese.queixaPrincipal || '';
    document.getElementById('inputHistoricoDoenca').value = anamnese.historicoDoenca || '';
    document.getElementById('inputExameFisico').value = anamnese.exameFisico || '';
    
    if (anamnese.foto) {
        const photoPreview = document.getElementById('photoPreview');
        photoPreview.innerHTML = `<img src="${anamnese.foto}" alt="Foto do paciente">`;
    }
    
    document.getElementById('btnSaveAnamnese').style.display = 'none';
    document.getElementById('btnUpdateAnamnese').style.display = 'inline-block';
    currentEditIndex = index;
    
    showMessage(`‚úèÔ∏è Editando anamnese de: ${anamnese.paciente}`, 'warning');
}

function deleteAnamnese(index) {
    const anamnese = anamneses[index];
    if (confirm(`Deseja realmente excluir a anamnese de ${anamnese.paciente}?`)) {
        anamneses.splice(index, 1);
        saveAnamneses();
        renderAnamnesesTable();
        showMessage("‚úÖ Anamnese exclu√≠da com sucesso!", 'success');
    }
}

// Fun√ß√µes para atestados
function editAtestado(index) {
    const atestados = documents.filter(d => d.tipo === 'atestado');
    const atestado = atestados[index];
    
    document.getElementById('inputAtestadoPaciente').value = atestado.paciente;
    document.getElementById('inputAtestadoTipo').value = atestado.tipoAtestado;
    document.getElementById('inputAtestadoSituacao').value = atestado.situacao || '';
    
    if (atestado.tipoAtestado === 'horario') {
        document.getElementById('inputAtestadoData').value = atestado.dataInicio;
        document.getElementById('inputAtestadoHorarioInicio').value = atestado.horarioInicio || '';
        document.getElementById('inputAtestadoHorarioFim').value = atestado.horarioFim || '';
    } else {
        document.getElementById('inputAtestadoDataInicio').value = atestado.dataInicio;
        document.getElementById('inputAtestadoDataFim').value = atestado.dataFim;
    }
    
    document.getElementById('btnSaveAtestado').style.display = 'none';
    document.getElementById('btnUpdateAtestado').style.display = 'inline-block';
    currentEditIndex = index;
    
    showMessage(`‚úèÔ∏è Editando atestado de: ${atestado.paciente}`, 'warning');
}

function deleteAtestado(index) {
    const atestados = documents.filter(d => d.tipo === 'atestado');
    const atestado = atestados[index];
    if (confirm(`Deseja realmente excluir o atestado de ${atestado.paciente}?`)) {
        const realIndex = documents.findIndex(d => d === atestado);
        if (realIndex !== -1) {
            documents.splice(realIndex, 1);
            saveDocuments();
            renderAtestadosTable();
            showMessage("‚úÖ Atestado exclu√≠do com sucesso!", 'success');
        }
    }
}

// Fun√ß√µes para cartas
function editCarta(index) {
    const cartas = documents.filter(d => d.tipo === 'carta');
    const carta = cartas[index];
    
    document.getElementById('inputCartaPaciente').value = carta.paciente;
    document.getElementById('inputCartaMedico').value = carta.medico || '';
    document.getElementById('inputCartaTratamento').value = carta.tratamento || '';
    document.getElementById('inputCartaEvolucao').value = carta.evolucao || '';
    document.getElementById('inputCartaSessoes').value = carta.sessoes || 1;
    
    document.getElementById('btnSaveCarta').style.display = 'none';
    document.getElementById('btnUpdateCarta').style.display = 'inline-block';
    currentEditIndex = index;
    
    showMessage(`‚úèÔ∏è Editando carta de: ${carta.paciente}`, 'warning');
}

function deleteCarta(index) {
    const cartas = documents.filter(d => d.tipo === 'carta');
    const carta = cartas[index];
    if (confirm(`Deseja realmente excluir a carta de ${carta.paciente}?`)) {
        const realIndex = documents.findIndex(d => d === carta);
        if (realIndex !== -1) {
            documents.splice(realIndex, 1);
            saveDocuments();
            renderCartasTable();
            showMessage("‚úÖ Carta exclu√≠da com sucesso!", 'success');
        }
    }
}

// Fun√ß√µes para pagamentos
function deletePayment(index) {
    const payment = payments[index];
    if (confirm(`Deseja realmente excluir o pagamento de ${payment.paciente}?`)) {
        payments.splice(index, 1);
        savePayments();
        renderPaymentsTable();
        showMessage("‚úÖ Pagamento exclu√≠do com sucesso!", 'success');
    }
}

// =============================================
// FUN√á√ïES DE ATUALIZA√á√ÉO
// =============================================

// Atualizar anamnese
document.getElementById('btnUpdateAnamnese').addEventListener('click', function() {
    if (currentEditIndex === -1) return;
    
    const paciente = document.getElementById('inputAnamnesePaciente').value.trim();
    const medicamentos = document.getElementById('inputMedicamentos').value;
    const queixaPrincipal = document.getElementById('inputQueixaPrincipal').value;
    const historicoDoenca = document.getElementById('inputHistoricoDoenca').value;
    const exameFisico = document.getElementById('inputExameFisico').value;
    
    const photoPreview = document.getElementById('photoPreview');
    const foto = photoPreview.querySelector('img') ? photoPreview.querySelector('img').src : null;
    
    const anamneseData = {
        paciente,
        medicamentos,
        queixaPrincipal,
        historicoDoenca,
        exameFisico,
        foto,
        updatedAt: new Date().toISOString()
    };
    
    anamneses[currentEditIndex] = { ...anamneses[currentEditIndex], ...anamneseData };
    saveAnamneses();
    renderAnamnesesTable();
    
    document.getElementById('btnSaveAnamnese').style.display = 'inline-block';
    document.getElementById('btnUpdateAnamnese').style.display = 'none';
    currentEditIndex = -1;
    
    showMessage(`‚úÖ Anamnese de ${paciente} atualizada com sucesso!`, 'success');
    document.getElementById('anamneseForm').reset();
    document.getElementById('photoPreview').innerHTML = `
        <div class="photo-placeholder">
            <i class="fas fa-camera"></i>
            <p>Foto do Paciente</p>
        </div>
    `;
});

// Atualizar atestado
document.getElementById('btnUpdateAtestado').addEventListener('click', function() {
    if (currentEditIndex === -1) return;
    
    const atestados = documents.filter(d => d.tipo === 'atestado');
    const paciente = document.getElementById('inputAtestadoPaciente').value.trim();
    const tipo = document.getElementById('inputAtestadoTipo').value;
    const situacao = document.getElementById('inputAtestadoSituacao').value;
    
    let dataInicio, dataFim, horarioInicio, horarioFim;
    
    if (tipo === 'horario') {
        dataInicio = document.getElementById('inputAtestadoData').value;
        horarioInicio = document.getElementById('inputAtestadoHorarioInicio').value;
        horarioFim = document.getElementById('inputAtestadoHorarioFim').value;
        dataFim = dataInicio;
    } else {
        dataInicio = document.getElementById('inputAtestadoDataInicio').value;
        dataFim = document.getElementById('inputAtestadoDataFim').value;
    }
    
    const atestadoData = {
        paciente,
        tipoAtestado: tipo,
        dataInicio,
        dataFim,
        horarioInicio,
        horarioFim,
        situacao,
        updatedAt: new Date().toISOString()
    };
    
    const realIndex = documents.findIndex(d => d === atestados[currentEditIndex]);
    if (realIndex !== -1) {
        documents[realIndex] = { ...documents[realIndex], ...atestadoData };
        saveDocuments();
        renderAtestadosTable();
    }
    
    document.getElementById('btnSaveAtestado').style.display = 'inline-block';
    document.getElementById('btnUpdateAtestado').style.display = 'none';
    currentEditIndex = -1;
    
    showMessage(`‚úÖ Atestado para ${paciente} atualizado com sucesso!`, 'success');
    document.getElementById('atestadoForm').reset();
});

// Atualizar carta
document.getElementById('btnUpdateCarta').addEventListener('click', function() {
    if (currentEditIndex === -1) return;
    
    const cartas = documents.filter(d => d.tipo === 'carta');
    const paciente = document.getElementById('inputCartaPaciente').value.trim();
    const medico = document.getElementById('inputCartaMedico').value;
    const tratamento = document.getElementById('inputCartaTratamento').value;
    const evolucao = document.getElementById('inputCartaEvolucao').value;
    const sessoes = parseInt(document.getElementById('inputCartaSessoes').value);
    
    const cartaData = {
        paciente,
        medico,
        tratamento,
        evolucao,
        sessoes,
        updatedAt: new Date().toISOString()
    };
    
    const realIndex = documents.findIndex(d => d === cartas[currentEditIndex]);
    if (realIndex !== -1) {
        documents[realIndex] = { ...documents[realIndex], ...cartaData };
        saveDocuments();
        renderCartasTable();
    }
    
    document.getElementById('btnSaveCarta').style.display = 'inline-block';
    document.getElementById('btnUpdateCarta').style.display = 'none';
    currentEditIndex = -1;
    
    showMessage(`‚úÖ Carta para ${medico || 'm√©dico'} atualizada com sucesso!`, 'success');
    document.getElementById('cartaForm').reset();
});

// =============================================
// FUN√á√ïES DE IMPRESS√ÉO (mantidas as mesmas)
// =============================================

// ... (as fun√ß√µes de impress√£o permanecem as mesmas)

// =============================================
// FUN√á√ïES DE RELAT√ìRIOS (mantidas as mesmas)
// =============================================

// ... (as fun√ß√µes de relat√≥rios permanecem as mesmas)

// =============================================
// EVENT LISTENERS ADICIONAIS
// =============================================

function setupEventListeners() {
    // Clock
    setInterval(updateClock, 1000);
    updateClock();
    
    // Busca
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
        searchInput.addEventListener("input", () => {
            renderTable(searchInput.value);
            updateActionButtons();
        });
    }
    
    // Busca de pacientes
    const searchPaciente = document.getElementById('searchPaciente');
    if (searchPaciente) {
        searchPaciente.addEventListener("input", () => {
            renderPatientsTable();
        });
    }
    
    // Busca de anamneses
    const searchPacienteAnamnese = document.getElementById('searchPacienteAnamnese');
    if (searchPacienteAnamnese) {
        searchPacienteAnamnese.addEventListener("input", () => {
            renderAnamnesesTable();
        });
    }
    
    // Bot√µes de limpeza
    const btnClear = document.getElementById('btnClear');
    if (btnClear) {
        btnClear.addEventListener("click", () => {
            if (confirm("‚ö†Ô∏è ATEN√á√ÉO!\n\nIsso ir√° limpar TODOS os dados do sistema permanentemente.\n\nDeseja continuar?")) {
                sessions = [];
                patients = [];
                payments = [];
                anamneses = [];
                documents = [];
                currentFaturaNumber = 1;
                saveSessions();
                savePatients();
                savePayments();
                saveAnamneses();
                saveDocuments();
                localStorage.setItem("currentFaturaNumber", currentFaturaNumber);
                renderTable();
                renderPaymentsTable();
                renderPatientsTable();
                renderAnamnesesTable();
                renderAtestadosTable();
                renderCartasTable();
                clearForm();
                showMessage("‚úÖ Todos os dados foram removidos permanentemente!", 'success');
            }
        });
    }
    
    // Bot√£o de cadastro cont√≠nuo
    const btnContinue = document.getElementById('btnContinue');
    if (btnContinue) {
        btnContinue.addEventListener("click", openCadastroContinuo);
    }
    
    // Calend√°rio
    const btnPrevMonth = document.getElementById('btnPrevMonth');
    const btnNextMonth = document.getElementById('btnNextMonth');
    const btnPrintCalendar = document.getElementById('btnPrintCalendar');
    const filterHorario = document.getElementById('filterHorario');
    
    if (btnPrevMonth) btnPrevMonth.addEventListener("click", () => {
        currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
        renderCalendar();
        updateMoonPhase();
        updateHolidaysInfo();
    });
    
    if (btnNextMonth) btnNextMonth.addEventListener("click", () => {
        currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
        renderCalendar();
        updateMoonPhase();
        updateHolidaysInfo();
    });
    
    if (btnPrintCalendar) btnPrintCalendar.addEventListener("click", printCalendar);
    if (filterHorario) filterHorario.addEventListener("change", renderCalendar);
    
    // Backup
    const btnBackupCompleto = document.getElementById('btnBackupCompleto');
    const btnRestoreBackup = document.getElementById('btnRestoreBackup');
    
    if (btnBackupCompleto) btnBackupCompleto.addEventListener("click", exportToJSON);
    if (btnRestoreBackup) btnRestoreBackup.addEventListener("click", () => {
        const fileInput = document.createElement('input');
        fileInput.type = 'file';
        fileInput.accept = '.json';
        fileInput.onchange = (e) => {
            if (e.target.files.length > 0) {
                importFromJSON(e.target.files[0]);
            }
        };
        fileInput.click();
    });
    
    // Event listeners da tabela de sess√µes
    const tableBody = document.getElementById("sessionsTableBody");
    if (tableBody) {
        tableBody.addEventListener("click", (e) => {
            const target = e.target.closest('.action-btn');
            if (!target) return;
            
            const index = parseInt(target.dataset.index);
            if (target.classList.contains('edit-btn')) {
                const session = sessions[index];
                document.getElementById('inputDia').value = session.dia;
                document.getElementById('inputHorario').value = session.horario;
                document.getElementById('inputNome').value = session.nome;
                document.getElementById('inputTipo').value = session.tipo || 'Particular';
                document.getElementById('inputSessoesSolicitadas').value = session.sessoesSolicitadas || 10;
                document.getElementById('inputSessoesLiberadas').value = session.sessoesLiberadas || 0;
                document.getElementById('inputValorSessao').value = session.valorSessao || 0;
                document.getElementById('inputMes').value = session.mes;
                document.getElementById('editIndex').value = index;
                document.getElementById('btnSave').innerHTML = '<i class="fas fa-save"></i> Atualizar';
                
                // Scroll para o formul√°rio no topo
                document.getElementById('session-section').scrollIntoView({ behavior: 'smooth' });
                
                // Focar no campo de nome
                setTimeout(() => {
                    document.getElementById('inputNome').focus();
                }, 500);
                
            } else if (target.classList.contains('delete-btn')) {
                if (confirm(`Deseja realmente excluir a sess√£o de ${sessions[index].nome} em ${formatDate(sessions[index].dia)}?`)) {
                    sessions.splice(index, 1);
                    saveSessions();
                    renderTable(document.getElementById('searchInput').value);
                    showMessage("‚úÖ Sess√£o exclu√≠da com sucesso!", 'success');
                }
            }
        });
    }
    
    // Modais
    setupModalEventListeners();
}

function setupModalEventListeners() {
    // Modal de cadastro cont√≠nuo
    const closeContinuo = document.getElementById('closeContinuo');
    const btnSaveContinuo = document.getElementById('btnSaveContinuo');
    const btnCancelContinuo = document.getElementById('btnCancelContinuo');
    const modalContinuo = document.getElementById('modalContinuo');
    
    if (closeContinuo) closeContinuo.addEventListener("click", () => {
        modalContinuo.style.display = 'none';
        clearForm();
    });
    
    if (btnSaveContinuo) btnSaveContinuo.addEventListener("click", saveCadastroContinuo);
    if (btnCancelContinuo) btnCancelContinuo.addEventListener("click", () => {
        modalContinuo.style.display = 'none';
        clearForm();
    });
    
    if (modalContinuo) modalContinuo.addEventListener("click", (e) => {
        if (e.target === modalContinuo) {
            modalContinuo.style.display = 'none';
            clearForm();
        }
    });
    
    // Modal de detalhes do dia
    const closeDayDetails = document.getElementById('closeDayDetails');
    const btnCloseDayDetails = document.getElementById('btnCloseDayDetails');
    const modalDayDetails = document.getElementById('modalDayDetails');
    
    if (closeDayDetails) closeDayDetails.addEventListener("click", () => {
        modalDayDetails.style.display = 'none';
    });
    
    if (btnCloseDayDetails) btnCloseDayDetails.addEventListener("click", () => {
        modalDayDetails.style.display = 'none';
    });
    
    if (modalDayDetails) modalDayDetails.addEventListener("click", (e) => {
        if (e.target === modalDayDetails) {
            modalDayDetails.style.display = 'none';
        }
    });
    
    // Modal de fatura
    const closeFatura = document.getElementById('closeFatura');
    const btnImprimirFatura = document.getElementById('btnImprimirFatura');
    const btnCancelarFatura = document.getElementById('btnCancelarFatura');
    const modalFatura = document.getElementById('modalFatura');
    
    if (closeFatura) closeFatura.addEventListener("click", () => {
        modalFatura.style.display = 'none';
    });
    
    if (btnCancelarFatura) btnCancelarFatura.addEventListener("click", () => {
        modalFatura.style.display = 'none';
    });
    
    if (modalFatura) modalFatura.addEventListener("click", (e) => {
        if (e.target === modalFatura) {
            modalFatura.style.display = 'none';
        }
    });
}

// =============================================
// FUN√á√ïES DE NAVEGA√á√ÉO
// =============================================

function scrollToTop() {
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function scrollToBottom() {
    window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
}

// =============================================
// INICIALIZA√á√ÉO
// =============================================

function setupPatientSearch() {
    const searchInputs = [
        'searchPacienteAnamnese',
        'searchPacientePagamento',
        'inputAnamnesePaciente',
        'inputPagamentoPaciente',
        'inputAtestadoPaciente',
        'inputCartaPaciente'
    ];
    
    searchInputs.forEach(inputId => {
        const input = document.getElementById(inputId);
        if (input) {
            autocomplete(input, [...new Set(sessions.map(s => s.nome))]);
        }
    });
}

function initializeApp() {
    loadSessions();
    renderTable();
    setupPatientSearch();
    renderPaymentsTable();
    renderPatientsTable();
    renderAnamnesesTable();
    renderAtestadosTable();
    renderCartasTable();
    updatePaymentTotal();
    setupEventListeners();
    
    // Inicializar autocomplete para todos os campos de paciente
    const patientInputs = [
        'inputNome',
        'inputPacienteNome', 
        'inputAnamnesePaciente',
        'inputPagamentoPaciente',
        'inputAtestadoPaciente',
        'inputCartaPaciente'
    ];
    
    patientInputs.forEach(inputId => {
        const input = document.getElementById(inputId);
        if (input) {
            autocomplete(input, [...new Set(sessions.map(s => s.nome))]);
        }
    });
    
    console.log("Sistema de Fisioterapia inicializado com sucesso!");
}

// Fun√ß√£o para atualizar rel√≥gio e data
function updateClock() {
    const now = new Date();
    const timeString = now.toLocaleTimeString('pt-BR');
    const dateString = now.toLocaleDateString('pt-BR', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
    
    document.getElementById('clockTime').textContent = timeString;
    document.getElementById('dateDisplay').textContent = dateString.charAt(0).toUpperCase() + dateString.slice(1);
}

// Inicializar a aplica√ß√£o quando o DOM estiver carregado
document.addEventListener('DOMContentLoaded', initializeApp);
</script>
</body>
</html>
