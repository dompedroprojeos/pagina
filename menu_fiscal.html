<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Dom Pedro - Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1a4d2e;
            --secondary: #2d6a4f;
            --accent: #40916c;
            --light-green: #52b788;
            --bg-dark: #ffffff;
            --bg-medium: #f8f9fa;
            --bg-light: #e9ecef;
            --text-light: #212529;
            --text-medium: #6c757d;
            --text-dark: #adb5bd;
            --border: #dee2e6;
            --hover: #e9ecef;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            color: var(--text-light);
            overflow: hidden;
            height: 100vh;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Tema Escuro */
        body.dark-mode {
            --bg-dark: #0f1419;
            --bg-medium: #1a1f26;
            --bg-light: #252d38;
            --text-light: #e8eaed;
            --text-medium: #9aa0a6;
            --text-dark: #5f6368;
            --border: #3c4043;
            --hover: #2d3748;
        }

        /* Prote√ß√£o */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9998;
        }

        /* Container Principal */
        .main-container {
            display: flex;
            height: 100vh;
            position: relative;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, var(--bg-medium) 0%, var(--bg-dark) 100%);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 100;
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        body.dark-mode .sidebar {
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.3);
        }

        /* Header da Sidebar */
        .sidebar-header {
            padding: 25px 20px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-light);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .logo-img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--accent);
            box-shadow: 0 4px 12px rgba(64, 145, 108, 0.3);
        }

        .logo-text {
            flex: 1;
        }

        .logo-title {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--light-green) 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 2px;
        }

        .logo-subtitle {
            font-size: 12px;
            color: var(--text-medium);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            padding: 12px;
            background: rgba(64, 145, 108, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(64, 145, 108, 0.2);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--accent), var(--light-green));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            color: white;
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-light);
        }

        .user-role {
            font-size: 11px;
            color: var(--text-medium);
        }

        /* Alternador de Tema */
        .theme-toggle-container {
            margin-top: 15px;
        }

        .theme-toggle {
            width: 100%;
            padding: 12px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            font-size: 13px;
            color: var(--text-light);
            font-weight: 500;
        }

        .theme-toggle:hover {
            background: var(--hover);
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(64, 145, 108, 0.2);
        }

        .theme-icon {
            font-size: 18px;
            display: flex;
            align-items: center;
            transition: transform 0.3s ease;
        }

        .theme-toggle:hover .theme-icon {
            transform: rotate(20deg);
        }

        .theme-text {
            flex: 1;
        }

        /* Menu de Navega√ß√£o */
        .nav-menu {
            flex: 1;
            overflow-y: auto;
            padding: 20px 0;
        }

        .nav-menu::-webkit-scrollbar {
            width: 6px;
        }

        .nav-menu::-webkit-scrollbar-track {
            background: var(--bg-dark);
        }

        .nav-menu::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        .nav-section {
            margin-bottom: 25px;
        }

        .nav-section-title {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            color: var(--text-dark);
            padding: 0 20px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: var(--text-medium);
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            margin: 2px 10px;
            border-radius: 8px;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 0;
            background: linear-gradient(180deg, var(--light-green), var(--accent));
            border-radius: 0 3px 3px 0;
            transition: height 0.3s ease;
        }

        .nav-item:hover {
            background: var(--hover);
            color: var(--text-light);
        }

        .nav-item:hover::before {
            height: 70%;
        }

        .nav-icon {
            font-size: 20px;
            width: 24px;
            text-align: center;
        }

        .nav-text {
            flex: 1;
            font-size: 14px;
        }

        .nav-badge {
            background: var(--accent);
            color: white;
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 600;
        }

        /* Rodap√© da Sidebar */
        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border);
            background: var(--bg-light);
        }

        .footer-info {
            text-align: center;
            font-size: 11px;
            color: var(--text-dark);
            line-height: 1.6;
        }

        .footer-credit {
            font-weight: 600;
            color: var(--accent);
            display: block;
            margin-top: 5px;
        }

        /* √Årea de Conte√∫do */
        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            position: relative;
            overflow: hidden;
        }

        body.dark-mode .content-area {
            background: linear-gradient(135deg, #0f1419 0%, #1a1f26 100%);
        }

        /* Header do Conte√∫do */
        .content-header {
            background: var(--bg-medium);
            border-bottom: 1px solid var(--border);
            padding: 20px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            z-index: 50;
            transition: all 0.3s ease;
        }

        body.dark-mode .content-header {
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 25px;
        }

        /* Calend√°rio */
        .calendar-widget {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 18px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 10px;
            min-width: 180px;
        }

        .calendar-day {
            text-align: center;
            padding-right: 15px;
            border-right: 1px solid var(--border);
        }

        .calendar-day-number {
            font-family: 'Playfair Display', serif;
            font-size: 42px;
            font-weight: 700;
            line-height: 1;
            background: linear-gradient(135deg, var(--accent), var(--light-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .calendar-day-name {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-dark);
            margin-top: 2px;
            font-weight: 600;
        }

        .calendar-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .calendar-weekday {
            font-size: 14px;
            color: var(--text-light);
            font-weight: 600;
        }

        .calendar-month-year {
            font-size: 13px;
            color: var(--text-medium);
        }

        .calendar-time {
            font-size: 12px;
            color: var(--text-dark);
            font-family: 'Libre Baskerville', serif;
        }

        /* Desktop/Workspace */
        .desktop {
            flex: 1;
            position: relative;
            overflow: hidden;
            padding: 20px;
        }

        /* Janela flutuante */
        .window {
            position: absolute;
            min-width: 400px;
            min-height: 300px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        body.dark-mode .window {
            background: var(--bg-medium);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .window.minimized {
            display: none;
        }

        .window.maximized {
            top: 20px !important;
            left: 20px !important;
            right: 20px;
            bottom: 20px;
            width: auto !important;
            height: auto !important;
        }

        .window-header {
            background: linear-gradient(135deg, var(--accent), var(--light-green));
            color: white;
            padding: 12px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: move;
            user-select: none;
        }

        .window-title {
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .window-controls {
            display: flex;
            gap: 8px;
        }

        .window-btn {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .window-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .window-btn.close:hover {
            background: #dc3545;
        }

        .window-content {
            flex: 1;
            overflow: hidden;
        }

        .window-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Barra de tarefas */
        .taskbar {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-medium);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 8px 15px;
            display: flex;
            gap: 8px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            z-index: 90;
        }

        body.dark-mode .taskbar {
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .taskbar-item {
            padding: 10px 16px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--text-light);
            max-width: 180px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .taskbar-item:hover {
            background: var(--hover);
            transform: translateY(-2px);
        }

        .taskbar-item.active {
            background: linear-gradient(135deg, rgba(64, 145, 108, 0.2), rgba(82, 183, 136, 0.2));
            border-color: var(--accent);
        }

        .taskbar-icon {
            font-size: 16px;
        }

        /* Prote√ß√£o Visual */
        .protected {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        /* Responsivo */
        @media (max-width: 1024px) {
            .sidebar {
                width: 240px;
            }

            .calendar-widget {
                min-width: 160px;
            }

            .calendar-day-number {
                font-size: 36px;
            }

            .window {
                min-width: 300px;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -280px;
                z-index: 1000;
                transition: left 0.3s ease;
            }

            .sidebar.mobile-open {
                left: 0;
            }

            .header-left {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .calendar-widget {
                width: 100%;
            }

            .content-header {
                padding: 15px 20px;
            }

            .window {
                min-width: 250px !important;
                width: calc(100% - 40px) !important;
            }

            .taskbar {
                width: calc(100% - 40px);
                overflow-x: auto;
            }
        }
    </style>
</head>
<body class="protected">
    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo-container">
                    <img src="pedrinho.png" alt="Dom Pedro" class="logo-img" onerror="this.style.display='none'">
                    <div class="logo-text">
                        <div class="logo-title">Dom Pedro</div>
                        <div class="logo-subtitle">Sistema Integrado</div>
                    </div>
                </div>
                <div class="user-info">
                    <div class="user-avatar">WR</div>
                    <div class="user-details">
                        <div class="user-name">Waldeci Ramos</div>
                        <div class="user-role">Administrador</div>
                    </div>
                </div>
                
                <!-- Alternador de Tema -->
                <div class="theme-toggle-container">
                    <button class="theme-toggle" onclick="toggleTheme()" id="theme-toggle">
                        <span class="theme-icon sun-icon">‚òÄÔ∏è</span>
                        <span class="theme-icon moon-icon" style="display: none;">üåô</span>
                        <span class="theme-text" id="theme-text">Modo Escuro</span>
                    </button>
                </div>
            </div>

            <nav class="nav-menu">
                <div class="nav-section">
                    <div class="nav-section-title">Controles</div>
                    <div class="nav-item" onclick="openWindow('https://dompedroprojeos.github.io/pagina/tarefas.html', 'Controle de E-mails', '‚úâÔ∏è')">
                        <span class="nav-icon">‚úâÔ∏è</span>
                        <span class="nav-text">E-mails e Libera√ß√µes</span>
                        <span class="nav-badge">NEW</span>
                    </div>
                    <div class="nav-item" onclick="openWindow('https://dompedroprojeos.github.io/pagina/sistema_libera.html', 'Libera√ß√£o de Funcion√°rios', 'üë§')">
                        <span class="nav-icon">üë§</span>
                        <span class="nav-text">Libera√ß√£o Funcion√°rios</span>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Financeiro</div>
                    <div class="nav-item" onclick="openWindow('https://dompedroprojeos.github.io/pagina/comparar_saldocredor.html', 'Saldo Credor', 'üí≥')">
                        <span class="nav-icon">üí≥</span>
                        <span class="nav-text">Saldo Credor</span>
                    </div>
                    <div class="nav-item" onclick="openWindow('https://dompedroprojeos.github.io/pagina/saldocredor.html', 'PDF Saldo Credor', 'üìä')">
                        <span class="nav-icon">üìä</span>
                        <span class="nav-text">PDF Saldo Credor</span>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Sistemas</div>
                    <div class="nav-item" onclick="openWindow('https://dompedroprojeos.github.io/pagina/diferenca_prodac_autosystem_Atual.html', 'Diferen√ßas Prodac', 'üîÑ')">
                        <span class="nav-icon">üîÑ</span>
                        <span class="nav-text">Prodac vs Autosystem</span>
                    </div>
                    <div class="nav-item" onclick="openWindow('https://dompedroprojeos.github.io/pagina/postosliberados.html', 'C√≥pia Prodac', 'üìÅ')">
                        <span class="nav-icon">üìÅ</span>
                        <span class="nav-text">C√≥pia Prodac</span>
                    </div>
                     <div class="nav-item" onclick="openWindow('https://dompedroprojeos.github.io/pagina/verificaliberados.html', 'Compara pastas', 'üìÅ')">
                        <span class="nav-icon">üìÅ</span>
                        <span class="nav-text">Compara pastas Prodac x Autosystem </span>
                    </div>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="footer-info">
                    ¬© 2026 Sistema Dom Pedro
                    <span class="footer-credit">@waldeciramos</span>
                    Todos os direitos reservados
                </div>
            </div>
        </aside>

        <!-- √Årea de Conte√∫do -->
        <main class="content-area">
            <header class="content-header">
                <div class="header-left">
                    <!-- Calend√°rio -->
                    <div class="calendar-widget">
                        <div class="calendar-day">
                            <div class="calendar-day-number" id="day-number">16</div>
                            <div class="calendar-day-name" id="day-name-short">FEV</div>
                        </div>
                        <div class="calendar-info">
                            <div class="calendar-weekday" id="weekday">Segunda-feira</div>
                            <div class="calendar-month-year" id="month-year">Fevereiro de 2026</div>
                            <div class="calendar-time" id="current-time">00:00:00</div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Desktop com janelas -->
            <div class="desktop" id="desktop">
                <!-- Janelas ser√£o criadas aqui dinamicamente -->
            </div>

            <!-- Barra de tarefas -->
            <div class="taskbar" id="taskbar">
                <!-- Itens da barra de tarefas aparecer√£o aqui -->
            </div>
        </main>
    </div>

    <script>
        // ===== PROTE√á√ÉO DO SISTEMA =====
        
        document.addEventListener('keydown', function(e) {
            if (e.keyCode === 123) { e.preventDefault(); return false; }
            if (e.ctrlKey && e.shiftKey && e.keyCode === 73) { e.preventDefault(); return false; }
            if (e.ctrlKey && e.shiftKey && e.keyCode === 74) { e.preventDefault(); return false; }
            if (e.ctrlKey && e.keyCode === 85) { e.preventDefault(); return false; }
            if (e.ctrlKey && e.keyCode === 83) { e.preventDefault(); return false; }
        });

        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
        });

        document.onselectstart = function() { return false; };

        // ===== SISTEMA DE TEMA =====
        
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.classList.add('dark-mode');
            updateThemeButton();
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            updateThemeButton();
            localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
        }

        function updateThemeButton() {
            const isDark = document.body.classList.contains('dark-mode');
            document.querySelector('.sun-icon').style.display = isDark ? 'none' : 'flex';
            document.querySelector('.moon-icon').style.display = isDark ? 'flex' : 'none';
            document.getElementById('theme-text').textContent = isDark ? 'Modo Claro' : 'Modo Escuro';
        }

        // ===== CALEND√ÅRIO =====
        
        function updateCalendar() {
            const now = new Date();
            const weekdays = ['Domingo', 'Segunda-feira', 'Ter√ßa-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'S√°bado'];
            const months = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            const monthsShort = ['JAN', 'FEV', 'MAR', 'ABR', 'MAI', 'JUN', 'JUL', 'AGO', 'SET', 'OUT', 'NOV', 'DEZ'];
            
            document.getElementById('day-number').textContent = now.getDate();
            document.getElementById('day-name-short').textContent = monthsShort[now.getMonth()];
            document.getElementById('weekday').textContent = weekdays[now.getDay()];
            document.getElementById('month-year').textContent = months[now.getMonth()] + ' de ' + now.getFullYear();
            
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('current-time').textContent = `${hours}:${minutes}:${seconds}`;
        }

        updateCalendar();
        setInterval(updateCalendar, 1000);

        // ===== SISTEMA DE JANELAS =====
        
        let windows = [];
        let zIndexCounter = 100;
        let activeWindow = null;

        function openWindow(url, title, icon) {
            const existing = windows.find(w => w.url === url);
            if (existing) {
                focusWindow(existing.id);
                return;
            }

            const windowId = 'window-' + Date.now();
            const desktop = document.getElementById('desktop');
            const taskbar = document.getElementById('taskbar');
            const offset = (windows.length * 30) % 100;

            const windowDiv = document.createElement('div');
            windowDiv.className = 'window';
            windowDiv.id = windowId;
            windowDiv.style.top = `${50 + offset}px`;
            windowDiv.style.left = `${50 + offset}px`;
            windowDiv.style.width = '900px';
            windowDiv.style.height = '600px';
            windowDiv.style.zIndex = ++zIndexCounter;

            windowDiv.innerHTML = `
                <div class="window-header">
                    <div class="window-title">
                        <span>${icon}</span>
                        <span>${title}</span>
                    </div>
                    <div class="window-controls">
                        <button class="window-btn minimize" onclick="minimizeWindow('${windowId}')">‚àí</button>
                        <button class="window-btn maximize" onclick="toggleMaximize('${windowId}')">‚ñ°</button>
                        <button class="window-btn close" onclick="closeWindow('${windowId}')">√ó</button>
                    </div>
                </div>
                <div class="window-content">
                    <iframe class="window-iframe" src="${url}"></iframe>
                </div>
            `;

            desktop.appendChild(windowDiv);

            const taskbarItem = document.createElement('div');
            taskbarItem.className = 'taskbar-item active';
            taskbarItem.id = 'taskbar-' + windowId;
            taskbarItem.innerHTML = `<span class="taskbar-icon">${icon}</span><span>${title}</span>`;
            taskbarItem.onclick = () => toggleWindowFromTaskbar(windowId);
            taskbar.appendChild(taskbarItem);

            windows.push({ id: windowId, url: url, title: title, minimized: false, maximized: false });
            makeDraggable(windowDiv);
            activeWindow = windowId;
            updateActiveStates();
        }

        function closeWindow(windowId) {
            document.getElementById(windowId)?.remove();
            document.getElementById('taskbar-' + windowId)?.remove();
            windows = windows.filter(w => w.id !== windowId);
            if (activeWindow === windowId) activeWindow = null;
        }

        function minimizeWindow(windowId) {
            const window = windows.find(w => w.id === windowId);
            if (window) {
                window.minimized = true;
                document.getElementById(windowId).classList.add('minimized');
                updateActiveStates();
            }
        }

        function toggleMaximize(windowId) {
            const window = windows.find(w => w.id === windowId);
            if (window) {
                window.maximized = !window.maximized;
                document.getElementById(windowId).classList.toggle('maximized');
            }
        }

        function toggleWindowFromTaskbar(windowId) {
            const window = windows.find(w => w.id === windowId);
            if (window.minimized) {
                window.minimized = false;
                document.getElementById(windowId).classList.remove('minimized');
                focusWindow(windowId);
            } else if (activeWindow === windowId) {
                minimizeWindow(windowId);
            } else {
                focusWindow(windowId);
            }
        }

        function focusWindow(windowId) {
            const window = windows.find(w => w.id === windowId);
            if (window && !window.minimized) {
                document.getElementById(windowId).style.zIndex = ++zIndexCounter;
                activeWindow = windowId;
                updateActiveStates();
            }
        }

        function updateActiveStates() {
            document.querySelectorAll('.taskbar-item').forEach(item => item.classList.remove('active'));
            if (activeWindow) {
                document.getElementById('taskbar-' + activeWindow)?.classList.add('active');
            }
        }

        function makeDraggable(element) {
            const header = element.querySelector('.window-header');
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;

            header.onmousedown = dragMouseDown;

            function dragMouseDown(e) {
                if (e.target.closest('.window-btn')) return;
                e.preventDefault();
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
                focusWindow(element.id);
            }

            function elementDrag(e) {
                e.preventDefault();
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                element.style.top = (element.offsetTop - pos2) + "px";
                element.style.left = (element.offsetLeft - pos1) + "px";
            }

            function closeDragElement() {
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }

        document.getElementById('desktop').addEventListener('mousedown', function(e) {
            const windowElement = e.target.closest('.window');
            if (windowElement) focusWindow(windowElement.id);
        });
    </script>
</body>
</html>
